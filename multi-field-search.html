
<!DOCTYPE HTML>
<html lang="en-us">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Multifield Search</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch: The Definitive Guide" /><link rel="up" href="search-in-depth.html" title="Search in Depth" /><link rel="prev" href="full-text-search.html" title="Full-Text Search" /><link rel="next" href="proximity-matching.html" title="Proximity Matching" />
  
 	<meta http-equiv="content-type" content="text/html; charset=utf-8" />

 	<!-- RTP tag --> 
	<script type='text/javascript' async>
	(function(c,h,a,f,i,e){c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
	 c[a].a=i;c[a].e=e;var g=h.createElement("script");g.async=true;g.type="text/javascript";
	 g.src=f+'?aid='+i;var b=h.getElementsByTagName("script")[0];b.parentNode.insertBefore(g,b);
	 })(window,document,"rtp","//sjrtp2-cdn.marketo.com/rtp-api/v1/rtp.js","elasticco");
	 
	rtp('send','view');
	rtp('get', 'campaign',true);
	</script>
	<!-- End of RTP tag -->
	
	
 	<link rel="apple-touch-icon" sizes="57x57"  href="https://www.elastic.co/apple-icon-57x57.png?change=123">
<link rel="apple-touch-icon" sizes="60x60"  href="https://www.elastic.co/apple-icon-60x60.png?change=123">
<link rel="apple-touch-icon" sizes="72x72"  href="https://www.elastic.co/apple-icon-72x72.png?change=123">
<link rel="apple-touch-icon" sizes="76x76"  href="https://www.elastic.co/apple-icon-76x76.png?change=123">
<link rel="apple-touch-icon" sizes="114x114"  href="https://www.elastic.co/apple-icon-114x114.png?change=123">
<link rel="apple-touch-icon" sizes="120x120"  href="https://www.elastic.co/apple-icon-120x120.png?change=123">
<link rel="apple-touch-icon" sizes="144x144"  href="https://www.elastic.co/apple-icon-144x144.png?change=123">
<link rel="apple-touch-icon" sizes="152x152"  href="https://www.elastic.co/apple-icon-152x152.png?change=123">
<link rel="apple-touch-icon" sizes="180x180"  href="https://www.elastic.co/apple-icon-180x180.png?change=123">
<link rel="icon" type="image/png" sizes="192x192"   href="https://www.elastic.co/android-icon-192x192.png?change=123">
<link rel="icon" type="image/png" sizes="32x32"  href="https://www.elastic.co/favicon-32x32.png?change=123">
<link rel="icon" type="image/png" sizes="96x96"  href="https://www.elastic.co/favicon-96x96.png?change=123">
<link rel="icon" type="image/png" sizes="16x16"  href="https://www.elastic.co/favicon-16x16.png?change=123">
<link rel="manifest"  href="https://www.elastic.co/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">

<!-- DC tags section -->
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" >
<link rel="schema.DCTERMS" href="http://purl.org/dc/terms/" >
<meta name="DC.title" content="Guide template" >

<!-- end DC tags -->

	<meta name="description" content="" />

	<link rel="canonical" href="" />

	<meta property="og:image" content="https://www.elastic.co/static/img/elastic-logo-200.png" />
	


	
	<link type="text/css" rel="stylesheet" href="https://static-www.elastic.co/static/css/skel.css?q=100" />
	<link type="text/css" rel="stylesheet" href="https://static-www.elastic.co/static/css/style.css?q=100" />	
	<script src="https://static-www.elastic.co/static/js/skel.min.js?q=100"></script>
	
		<script type="text/javascript">form_name = "" ; cdn_url="https://static-www.elastic.co";cdn_slug = "100"</script>
	
	<script src="https://static-www.elastic.co/static/js/init.js?q=100"></script>
	<script src="https://static-www.elastic.co/static/js/jquery.min.js?q=100"></script>
	<script src="https://static-www.elastic.co/static/js/jquery.cookie.js?q=100"></script>
	<!--<script type="text/javascript">
	    (function() {
	        var path = '//easy.myfonts.net/v2/js?sid=10336(font-family=Avenir+35+Light)&sid=10338(font-family=Avenir+55+Roman)&sid=10340(font-family=Avenir+85+Heavy)&sid=10344(font-family=Avenir+65+Medium)&key=nAD6PCOPrX',
	            protocol = ('https:' == document.location.protocol ? 'https:' : 'http:'),
	            trial = document.createElement('script');
	        trial.type = 'text/javascript';
	        trial.async = true;
	        trial.src = protocol + path;
	        var head = document.getElementsByTagName("head")[0];
	        head.appendChild(trial);
	    })();
	</script>-->

	
	<link type="text/css" rel="stylesheet"  href="https://www.elastic.co/static/css/prettify.css" />
	<script type="text/javascript"  src="https://www.elastic.co/static/js/prettify.js"></script>



<link rel="stylesheet" type="text/css" href="styles.css" />

</head>
<body >
	<!-- Google Tag Manager -->
	<script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5"
													  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-58RLH5');</script>
	<!-- End Google Tag Manager -->
	
	<div class="header-cont">
		<div id="header-wrapper">
			


	<script  src="https://www.elastic.co/static/js/jquery.tokeninput.js?change=123"></script>
	<link rel="stylesheet" type="text/css"  href="https://www.elastic.co/static/css/token-input.css">

<div class="shortcuts-wrapper">
	<div class="container">
		<!-- Shortcuts -->
		<nav id="shortcuts">
			<ul class="links">
				
					<li class="shortcut-1">
						<a href="/downloads" id="header_downloads" >
							<span class="txt">downloads</span>	
						</a>
					</li>
				
					<li class="shortcut-2">
						<a href="/guide" id="header_guide" >
							<span class="txt">docs</span>	
						</a>
					</li>
				
					<li class="shortcut-3">
						<a href="/subscriptions" id="header_subscriptions" >
							<span class="txt">support</span>	
						</a>
					</li>
				
					<li class="shortcut-4">
						<a href="https://discuss.elastic.co" id="header_discuss" target="_blank">
							<span class="txt">discuss</span>	
						</a>
					</li>
				
					<li class="shortcut-5">
						<a href="/contact" id="header_contact" >
							<span class="txt">contact</span>	
						</a>
					</li>
				
			</ul>
		</nav>
		<div class="languages-wrapper">
			<div class="global-language">
				<ul class="language">
					<!-- <li class="active-language"><a class="active" href="#">EN</a></li> -->
					
						<li><a href="#">EN</a></li>
					
				</ul>
				<ul class="all-languages">
					
						
						<li><a href="/guide_template">English</a></li>
					
						
						<li><a href="/fr/guide_template">French</a></li>
					
						
						<li><a href="/de/guide_template">German</a></li>
					
						
						<li><a href="/jp/guide_template">Japanese</a></li>
					
						
						<li><a href="/kr/guide_template">Korean</a></li>
					
				</ul>
			</div>
		</div>
	</div>
</div>
<div class="container w100">
	<div class="row 0%">
		<div class="12u">
			

<section class="first-container desktop-main-nav">
	<div class="row 0%">
		<div class="11u 6u(small) 6u(xsmall)">
			<div id="elastic">
				<h1>
					<a href="/">
						<div id="elastic-logo">
						<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 400 130" preserveAspectRatio="xMinYMin meet" enable-background="new 0 0 400 130" xml:space="preserve">
    <g>
    	<g>
    		<path fill="#FFFFFF" d="M122.5,67.8c0-10.3-6.4-19.2-15.9-22.7c0.4-2.2,0.6-4.3,0.6-6.6c0-19.1-15.5-34.6-34.6-34.6
    			c-11.1,0-21.5,5.3-28,14.4c-3.2-2.5-7.1-3.8-11.2-3.8c-10.1,0-18.4,8.2-18.4,18.4c0,2.2,0.4,4.4,1.1,6.4C6.5,42.6,0,51.8,0,62
    			c0,10.3,6.4,19.3,16,22.8c-0.4,2.1-0.6,4.3-0.6,6.6c0,19,15.5,34.5,34.5,34.5c11.2,0,21.5-5.4,28-14.4c3.2,2.5,7.2,3.9,11.3,3.9
    			c10.1,0,18.4-8.2,18.4-18.4c0-2.2-0.4-4.4-1.1-6.4C115.9,87.2,122.5,78,122.5,67.8z"/>
    		<g>
    			<path fill="#F4BD19" d="M47.9,56.3l27.3,12.5l27.6-24.2c0.4-2,0.6-4,0.6-6.1c0-17-13.8-30.8-30.8-30.8c-10.2,0-19.7,5-25.4,13.4
    				l-4.6,23.8L47.9,56.3z"/>
    		</g>
    		<g>
    			<path fill="#3CBEB1" d="M19.6,85.2c-0.4,2-0.6,4.1-0.6,6.2c0,17,13.9,30.9,30.9,30.9c10.3,0,19.8-5.1,25.6-13.5L80,85l-6.1-11.6
    				L46.5,60.9L19.6,85.2z"/>
    		</g>
    		<g>
    			<path fill="#E9478C" d="M19.4,37.9l18.7,4.4L42.3,21c-2.6-2-5.7-3-9-3c-8.1,0-14.8,6.6-14.8,14.8C18.5,34.5,18.8,36.3,19.4,37.9z
    				"/>
    		</g>
    		<g>
    			<path fill="#2C458F" d="M17.8,42.4C9.4,45.1,3.6,53.2,3.6,62c0,8.6,5.3,16.3,13.3,19.3l26.3-23.8l-4.8-10.3L17.8,42.4z"/>
    		</g>
    		<g>
    			<path fill="#95C63D" d="M80.3,108.7c2.6,2,5.7,3.1,8.9,3.1c8.1,0,14.8-6.6,14.8-14.8c0-1.8-0.3-3.5-0.9-5.1l-18.7-4.4L80.3,108.7
    				z"/>
    		</g>
    		<g>
    			<path fill="#176655" d="M84.1,82.6l20.6,4.8c8.4-2.8,14.2-10.8,14.2-19.6c0-8.6-5.3-16.2-13.3-19.3l-27,23.6L84.1,82.6z"/>
    		</g>
    	</g>
    	<path d="M162.8,76.3c0,0.1,0,0.6,0.1,1.4c0.1,0.8,0.3,1.8,0.6,3c0.3,1.1,0.8,2.4,1.4,3.7c0.6,1.3,1.4,2.5,2.5,3.6
    		c1,1.1,2.3,2,3.8,2.7c1.5,0.7,3.4,1.1,5.6,1.1c1.8,0,3.3-0.1,4.6-0.4c1.3-0.3,2.4-0.7,3.4-1.3c1-0.6,1.9-1.3,2.7-2.2
    		c0.8-0.9,1.6-1.9,2.4-3.1c0.5-0.7,1-1.2,1.6-1.5c0.6-0.3,1.2-0.4,1.8-0.4c1,0,2,0.4,2.8,1.1c0.9,0.7,1.3,1.7,1.3,2.8
    		c0,0.7-0.4,1.7-1.1,3.1c-0.7,1.4-1.9,2.8-3.6,4.1c-1.6,1.4-3.7,2.6-6.3,3.6c-2.6,1-5.7,1.5-9.5,1.5c-3.8,0-7.2-0.7-10.2-2.1
    		c-3-1.4-5.5-3.2-7.5-5.6c-2-2.3-3.6-5-4.7-8.1c-1.1-3.1-1.6-6.3-1.6-9.7c0-3.5,0.5-6.8,1.6-9.9c1.1-3.1,2.7-5.8,4.7-8.1
    		c2-2.3,4.5-4.1,7.4-5.5c2.9-1.3,6.1-2,9.6-2c3.3,0,6.3,0.5,9.2,1.5c2.8,1,5.3,2.4,7.4,4.3c2.1,1.9,3.7,4.1,5,6.8
    		c1.2,2.7,1.8,5.8,1.8,9.2c0,2.1-0.5,3.7-1.6,4.8c-1,1.1-2.2,1.6-3.6,1.6H162.8z M170.9,56.4c-1.5,0.6-2.7,1.4-3.7,2.4
    		c-1,0.9-1.8,2-2.4,3.1c-0.6,1.1-1,2.2-1.3,3.2c-0.3,1-0.5,1.8-0.5,2.5c-0.1,0.7-0.1,1.1-0.1,1.2h27.9c0-1.8-0.3-3.5-0.9-5.1
    		c-0.6-1.6-1.5-3-2.6-4.3c-1.2-1.2-2.7-2.2-4.5-3c-1.8-0.7-4-1.1-6.5-1.1C174.2,55.5,172.4,55.8,170.9,56.4z"/>
    	<path d="M214.3,94.6c0,1.3-0.4,2.3-1.3,3.2c-0.9,0.9-1.9,1.3-3.2,1.3c-1.3,0-2.3-0.4-3.2-1.3c-0.9-0.9-1.3-2-1.3-3.2V35.1
    		c0-1.3,0.4-2.3,1.3-3.2c0.9-0.9,2-1.3,3.2-1.3c1.3,0,2.3,0.4,3.2,1.3c0.9,0.9,1.3,1.9,1.3,3.2V94.6z"/>
    	<path d="M229.8,63.5c-0.6,0.3-1.2,0.5-1.9,0.5c-1.2,0-2.2-0.4-3.2-1.1c-1-0.7-1.5-1.8-1.5-3.1c0-0.5,0.1-1.1,0.4-1.9
    		c0.5-1.2,1.2-2.4,2.1-3.6c0.9-1.2,2-2.2,3.5-3.1s3.3-1.7,5.4-2.2c2.2-0.5,4.8-0.8,7.9-0.8c5.9,0,10.5,1.2,14,3.5
    		c3.5,2.3,5.2,5.8,5.2,10.3v32.8c0,1.3-0.4,2.3-1.3,3.2c-0.9,0.9-1.9,1.3-3.2,1.3c-1.3,0-2.3-0.4-3.2-1.3c-0.9-0.9-1.3-2-1.3-3.2v-2
    		c-1.2,2-4.7,4.5-7.5,5.3c-2.8,0.8-5.7,1.2-8.8,1.2c-2,0-3.9-0.3-5.9-0.8c-2-0.5-3.8-1.4-5.3-2.5c-1.6-1.1-2.9-2.6-3.8-4.3
    		c-1-1.7-1.5-3.8-1.5-6.2c0-2.8,0.5-5.7,1.6-7.5c1.1-1.9,2.6-3.4,4.4-4.6c1.8-1.2,3.9-2.1,6.3-2.8c2.4-0.6,4.9-1.1,7.5-1.4
    		c3-0.3,5.4-0.7,7.2-1.2c1.7-0.4,3-0.9,3.9-1.5c0.9-0.6,1.4-1.2,1.6-2c0.2-0.7,0.3-1.6,0.3-2.5c0-1.1-0.3-2-0.9-2.8
    		c-0.6-0.8-1.4-1.5-2.4-2c-1-0.5-2.1-0.9-3.3-1.2s-2.4-0.4-3.5-0.4c-2.1,0-3.7,0.2-5,0.5c-1.3,0.3-2.3,0.8-3.1,1.4
    		c-0.8,0.6-1.5,1.3-1.9,2.1c-0.5,0.8-0.9,1.6-1.3,2.5C230.9,62.6,230.4,63.1,229.8,63.5z M250.6,74.4c-1.1,0.3-2.4,0.6-3.8,0.8
    		c-1.5,0.2-3,0.4-4.6,0.6c-1.6,0.2-3.1,0.5-4.6,0.9c-1.5,0.3-2.8,0.8-4,1.5c-1.2,0.7-2.2,1.5-2.9,2.5c-0.7,1-1.1,3-1.1,4.6
    		c0,1.3,0.3,2.3,0.8,3.1c0.5,0.8,1.2,1.5,2.1,2c0.9,0.5,1.8,0.8,2.9,1c1.1,0.2,2.2,0.3,3.3,0.3c1.7,0,3.3-0.2,5-0.6
    		c1.7-0.4,3.2-1,4.5-1.9s2.4-2,3.3-3.5c0.8-1.4,1.2-3.8,1.2-5.9v-6.1L250.6,74.4z"/>
    	<path d="M307.6,90.9c-1.1,2-2.7,3.6-4.6,4.8s-4.1,2.1-6.6,2.7c-2.5,0.5-5.2,0.8-7.9,0.8c-3.9,0-7.2-0.6-9.9-1.8
    		c-2.7-1.2-4.9-2.6-6.5-4.1c-1.7-1.6-2.9-3.1-3.7-4.7c-0.7-1.6-1.1-2.7-1.1-3.5c0-1.3,0.5-2.4,1.4-3.2c0.9-0.8,2-1.2,3.1-1.2
    		c0.7,0,1.3,0.2,2,0.6c0.6,0.4,1.1,1,1.5,1.9c1,2.5,2.5,4.5,4.7,6.2c2.2,1.7,5.2,2.5,9.3,2.5c1.8,0,3.4-0.2,4.7-0.6
    		c1.3-0.4,2.4-1,3.2-1.7c0.8-0.7,1.4-1.5,1.9-2.4c0.4-0.9,0.6-1.8,0.6-2.8c0-2-0.8-3.4-2.3-4.4c-1.5-1-3.5-1.7-5.8-2.3
    		c-2.3-0.6-4.8-1.1-7.5-1.6c-2.7-0.5-5.2-1.2-7.5-2.2c-2.3-0.9-4.2-2.3-5.8-4c-1.6-1.8-2.3-4.2-2.3-7.3c0-4.5,1.6-8,4.9-10.5
    		c3.3-2.5,7.8-3.8,13.7-3.8c3.3,0,6,0.3,8.3,1c2.2,0.7,4.1,1.6,5.5,2.7c0.6,0.5,1.2,1,1.8,1.7c0.6,0.7,1.2,1.4,1.8,2.2
    		c0.6,0.8,1,1.5,1.4,2.3c0.4,0.7,0.6,1.4,0.6,2c0,1.3-0.5,2.4-1.6,3.1c-1,0.8-2.2,1.2-3.4,1.2c-0.7,0-1.5-0.1-2.1-0.6
    		c-0.6-0.6-1-1.3-1.3-1.8c-0.5-1.1-1.1-2-1.7-2.8c-0.5-0.8-1.2-1.5-2-2c-0.8-0.5-1.8-0.9-3-1.2c-1.2-0.3-2.7-0.4-4.4-0.4
    		c-3.5,0-6,0.6-7.6,1.7c-1.6,1.1-2.4,2.5-2.4,4.2c0,1.3,0.5,2.3,1.4,3.1c0.9,0.8,2.1,1.4,3.7,2c1.5,0.5,3.3,1,5.2,1.4
    		c2,0.4,3.9,0.8,5.9,1.3c2,0.5,4,1.1,5.9,1.7c1.9,0.7,3.7,1.6,5.2,2.7c1.5,1.1,2.7,2.5,3.7,4.1c0.9,1.6,1.4,3.6,1.4,6
    		C309.4,86.4,308.8,88.9,307.6,90.9z"/>
    	<path d="M327.4,48.8h4.7c1.1,0,2,0.4,2.8,1.2c0.8,0.8,1.2,1.7,1.2,2.8c0,1.1-0.4,2.1-1.2,2.8s-1.7,1.1-2.8,1.1h-4.7v37.9
    		c0,1.3-0.4,2.3-1.3,3.2c-0.9,0.9-2,1.3-3.2,1.3c-1.3,0-2.3-0.4-3.2-1.3c-0.9-0.9-1.3-2-1.3-3.2V56.7h-4.6c-1.1,0-2-0.4-2.8-1.1
    		c-0.8-0.7-1.2-1.7-1.2-2.8c0-1.1,0.4-2,1.2-2.8c0.8-0.8,1.7-1.2,2.8-1.2h4.6V39c0-1.3,0.4-2.3,1.3-3.2s1.9-1.3,3.2-1.3
    		c1.3,0,2.3,0.4,3.2,1.3s1.3,1.9,1.3,3.2V48.8z"/>
    	<path d="M341.5,32.1c1-1,2.2-1.5,3.7-1.5c1.4,0,2.6,0.5,3.6,1.5c1,1,1.5,2.2,1.5,3.6c0,1.4-0.5,2.6-1.5,3.6c-1,1-2.2,1.5-3.6,1.5
    		c-1.4,0-2.7-0.5-3.7-1.5c-1-1-1.5-2.2-1.5-3.6C340,34.2,340.5,33,341.5,32.1z M349.6,94.6c0,1.3-0.4,2.3-1.3,3.2
    		c-0.9,0.9-1.9,1.3-3.2,1.3c-1.3,0-2.3-0.4-3.2-1.3c-0.9-0.9-1.3-2-1.3-3.2V53.3c0-1.3,0.4-2.3,1.3-3.2c0.9-0.9,2-1.3,3.2-1.3
    		c1.3,0,2.3,0.4,3.2,1.3c0.9,0.9,1.3,2,1.3,3.2V94.6z"/>
    	<path d="M369.1,97.3c-2.9-1.2-5.4-3-7.5-5.2c-2.1-2.2-3.8-4.9-5-8.1c-1.2-3.1-1.8-6.6-1.8-10.4c0-3.8,0.6-7.3,1.8-10.5
    		c1.2-3.1,2.9-5.8,5-8.1c2.1-2.2,4.6-4,7.5-5.2c2.9-1.2,6-1.9,9.4-1.9c3.4,0,6.4,0.5,9,1.5c2.5,1,4.6,2.2,6.2,3.6
    		c1.6,1.4,3.2,2.9,4,4.4c0.5,0.9,0.9,1.5,0.9,2.6c0,1.3-0.5,2.3-1.4,3.1c-0.9,0.7-2,1.1-3.1,1.1c-0.8,0-1.6-0.2-2.2-0.6
    		c-0.7-0.4-1.2-1.3-1.8-2.1c-1-1.4-0.5-0.6-1.1-1.5c-0.7-0.9-1.5-1.6-2.5-2.3c-1-0.7-2.2-1.2-3.5-1.6c-1.4-0.4-2.8-0.6-4.4-0.6
    		c-1.8,0-3.5,0.3-5.3,1c-1.8,0.7-3.3,1.7-4.7,3.1c-1.4,1.4-2.5,3.3-3.4,5.6s-1.3,5.1-1.3,8.4c0,3.3,0.4,6.1,1.3,8.4s2,4.2,3.4,5.6
    		c1.4,1.4,3,2.5,4.7,3.1c1.8,0.7,3.5,1,5.3,1c1.6,0,3.1-0.2,4.4-0.6c1.3-0.4,2.5-0.9,3.5-1.6c1-0.7,1.8-1.5,2.5-2.3
    		c0.7-0.9,1.1-1.8,1.4-2.7c0.3-1,0.8-1.7,1.5-2.1c0.7-0.4,1.4-0.6,2.2-0.6c1.1,0,2.2,0.4,3.1,1.1c0.9,0.7,1.4,1.7,1.4,3
    		c0,0.6-0.3,1.7-0.9,3.1c-0.6,1.5-1.6,2.9-3.1,4.4c-1.5,1.5-3.5,2.8-6.2,4c-2.6,1.1-6,1.7-10,1.7C375.1,99.2,372,98.5,369.1,97.3z"
    		/>
    </g>
</svg>
						</div>
					</a>
				</h1>
			</div>
			<nav id="nav">
				<ul>
					
					<li>
						
							
						
						<a href="/products" id="nav_products"   >Products</a>
						
						<ul class="dropdown">
							
								<li><a href="/products/elasticsearch" id="nav_elasticsearch" >elasticsearch</a></li>								
							
								<li><a href="/found" id="nav_hosted-elasticsearch" >elasticsearch as a service</a></li>								
							
								<li><a href="/products/logstash" id="nav_logstash" >logstash</a></li>								
							
								<li><a href="/products/kibana" id="nav_kibana" >kibana</a></li>								
							
								<li><a href="/products/beats" id="nav_beats" >beats</a></li>								
							
								<li><a href="/products/watcher" id="nav_watcher" >watcher</a></li>								
							
								<li><a href="/products/shield" id="nav_shield" >shield</a></li>								
							
								<li><a href="/products/marvel" id="nav_marvel" >marvel</a></li>								
							
								<li><a href="/products/hadoop" id="nav_hadoop" >hadoop</a></li>								
							
								<li><a href="/downloads" id="nav_downloads" >downloads</a></li>								
								
						</ul>							
					</li>
					
					<li>
						
							
						
						<a href="/subscriptions" id="nav_subscriptions"   >Subscriptions</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						
							
						
						<a href="/learn" id="nav_learn"   >Learn</a>
						
						<ul class="dropdown">
							
								<li><a href="/guide" id="nav_guide" >docs</a></li>								
							
								<li><a href="/videos" id="nav_videos" >videos</a></li>								
							
								<li><a href="/training" id="nav_training" >training</a></li>								
							
								<li><a href="/services" id="nav_services" >services</a></li>								
							
								<li><a href="/blog" id="nav_learn_blog" >blog</a></li>								
							
								<li><a href="/elasticon" id="nav_learn_elasticon" >elastic{ON}</a></li>								
								
						</ul>							
					</li>
					
					<li>
						
							
						
						<a href="/community" id="nav_community"   >Community</a>
						
						<ul class="dropdown">
							
								<li><a href="/community/meetups" id="nav_meetups" >meetups</a></li>								
							
								<li><a href="https://discuss.elastic.co" id="nav_discuss" target="_blank">discuss</a></li>								
							
								<li><a href="/community/codeofconduct" id="nav_codeofconduct" >code of conduct</a></li>								
								
						</ul>							
					</li>
					
					<li>
						
							
						
						<a href="/use-cases" id="nav_usecases"   >Use Cases</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						
							
						
						<a href="/blog" id="nav_blog"   >Blog</a>
						
						<ul class="dropdown">
							
								<li><a href="/blog/category/news" id="blog_news" >News</a></li>								
							
								<li><a href="/blog/category/engineering" id="blog_engineering" >Engineering</a></li>								
							
								<li><a href="/blog/category/user-stories" id="blog_user-stories" >User Stories</a></li>								
							
								<li><a href="/blog/category/releases" id="blog_releases" >Releases</a></li>								
							
								<li><a href="/blog/archive" id="blog_archive" >Archive</a></li>								
								
						</ul>							
					</li>
					
					<li>
						
							
						
						<a href="/about" id="nav_about"   >About</a>
						
						<ul class="dropdown">
							
								<li><a href="/about/leadership" id="nav_leadership" >leadership</a></li>								
							
								<li><a href="/about/board" id="nav_board" >board of directors</a></li>								
							
								<li><a href="/about/careers" id="nav_careers" >careers</a></li>								
							
								<li><a href="/about/partners" id="nav_partners" >partners</a></li>								
							
								<li><a href="/about/press" id="nav_press" >press</a></li>								
								
						</ul>							
					</li>
					
				</ul>
			</nav>			
			<!-- Searchbar Input box -->
			 <!-- <form method="get" action="/search" name="searchForm" class="header-search-form" id="searchMobileFrm">
			   <input type="text" id="search-header-autocomplete" name="q" class="form-control global-input" placeholder="elastic{search}">
			</form>
			<div class="mobile-auto-complete"></div> -->  
		</div>
		<div class="1u 6u(small) 6u(xsmall)">
			<div id="searchbar">
				<a href="#" class="button icon"></a>
			</div>
			<!-- <div class="nav-auto-complete"></div> -->
		</div>
	</div>
</section>
<div class="mobile-menu-wrapper">
	<div class="row 0%">
		<div class="8u 6u(small) 6u(xsmall)">
			<div id="elastic">
				<h1>
					<a href="/">
						<div id="elastic-logo">
						<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 400 130" preserveAspectRatio="xMinYMin meet" enable-background="new 0 0 400 130" xml:space="preserve">
    <g>
    	<g>
    		<path fill="#FFFFFF" d="M122.5,67.8c0-10.3-6.4-19.2-15.9-22.7c0.4-2.2,0.6-4.3,0.6-6.6c0-19.1-15.5-34.6-34.6-34.6
    			c-11.1,0-21.5,5.3-28,14.4c-3.2-2.5-7.1-3.8-11.2-3.8c-10.1,0-18.4,8.2-18.4,18.4c0,2.2,0.4,4.4,1.1,6.4C6.5,42.6,0,51.8,0,62
    			c0,10.3,6.4,19.3,16,22.8c-0.4,2.1-0.6,4.3-0.6,6.6c0,19,15.5,34.5,34.5,34.5c11.2,0,21.5-5.4,28-14.4c3.2,2.5,7.2,3.9,11.3,3.9
    			c10.1,0,18.4-8.2,18.4-18.4c0-2.2-0.4-4.4-1.1-6.4C115.9,87.2,122.5,78,122.5,67.8z"/>
    		<g>
    			<path fill="#F4BD19" d="M47.9,56.3l27.3,12.5l27.6-24.2c0.4-2,0.6-4,0.6-6.1c0-17-13.8-30.8-30.8-30.8c-10.2,0-19.7,5-25.4,13.4
    				l-4.6,23.8L47.9,56.3z"/>
    		</g>
    		<g>
    			<path fill="#3CBEB1" d="M19.6,85.2c-0.4,2-0.6,4.1-0.6,6.2c0,17,13.9,30.9,30.9,30.9c10.3,0,19.8-5.1,25.6-13.5L80,85l-6.1-11.6
    				L46.5,60.9L19.6,85.2z"/>
    		</g>
    		<g>
    			<path fill="#E9478C" d="M19.4,37.9l18.7,4.4L42.3,21c-2.6-2-5.7-3-9-3c-8.1,0-14.8,6.6-14.8,14.8C18.5,34.5,18.8,36.3,19.4,37.9z
    				"/>
    		</g>
    		<g>
    			<path fill="#2C458F" d="M17.8,42.4C9.4,45.1,3.6,53.2,3.6,62c0,8.6,5.3,16.3,13.3,19.3l26.3-23.8l-4.8-10.3L17.8,42.4z"/>
    		</g>
    		<g>
    			<path fill="#95C63D" d="M80.3,108.7c2.6,2,5.7,3.1,8.9,3.1c8.1,0,14.8-6.6,14.8-14.8c0-1.8-0.3-3.5-0.9-5.1l-18.7-4.4L80.3,108.7
    				z"/>
    		</g>
    		<g>
    			<path fill="#176655" d="M84.1,82.6l20.6,4.8c8.4-2.8,14.2-10.8,14.2-19.6c0-8.6-5.3-16.2-13.3-19.3l-27,23.6L84.1,82.6z"/>
    		</g>
    	</g>
    	<path d="M162.8,76.3c0,0.1,0,0.6,0.1,1.4c0.1,0.8,0.3,1.8,0.6,3c0.3,1.1,0.8,2.4,1.4,3.7c0.6,1.3,1.4,2.5,2.5,3.6
    		c1,1.1,2.3,2,3.8,2.7c1.5,0.7,3.4,1.1,5.6,1.1c1.8,0,3.3-0.1,4.6-0.4c1.3-0.3,2.4-0.7,3.4-1.3c1-0.6,1.9-1.3,2.7-2.2
    		c0.8-0.9,1.6-1.9,2.4-3.1c0.5-0.7,1-1.2,1.6-1.5c0.6-0.3,1.2-0.4,1.8-0.4c1,0,2,0.4,2.8,1.1c0.9,0.7,1.3,1.7,1.3,2.8
    		c0,0.7-0.4,1.7-1.1,3.1c-0.7,1.4-1.9,2.8-3.6,4.1c-1.6,1.4-3.7,2.6-6.3,3.6c-2.6,1-5.7,1.5-9.5,1.5c-3.8,0-7.2-0.7-10.2-2.1
    		c-3-1.4-5.5-3.2-7.5-5.6c-2-2.3-3.6-5-4.7-8.1c-1.1-3.1-1.6-6.3-1.6-9.7c0-3.5,0.5-6.8,1.6-9.9c1.1-3.1,2.7-5.8,4.7-8.1
    		c2-2.3,4.5-4.1,7.4-5.5c2.9-1.3,6.1-2,9.6-2c3.3,0,6.3,0.5,9.2,1.5c2.8,1,5.3,2.4,7.4,4.3c2.1,1.9,3.7,4.1,5,6.8
    		c1.2,2.7,1.8,5.8,1.8,9.2c0,2.1-0.5,3.7-1.6,4.8c-1,1.1-2.2,1.6-3.6,1.6H162.8z M170.9,56.4c-1.5,0.6-2.7,1.4-3.7,2.4
    		c-1,0.9-1.8,2-2.4,3.1c-0.6,1.1-1,2.2-1.3,3.2c-0.3,1-0.5,1.8-0.5,2.5c-0.1,0.7-0.1,1.1-0.1,1.2h27.9c0-1.8-0.3-3.5-0.9-5.1
    		c-0.6-1.6-1.5-3-2.6-4.3c-1.2-1.2-2.7-2.2-4.5-3c-1.8-0.7-4-1.1-6.5-1.1C174.2,55.5,172.4,55.8,170.9,56.4z"/>
    	<path d="M214.3,94.6c0,1.3-0.4,2.3-1.3,3.2c-0.9,0.9-1.9,1.3-3.2,1.3c-1.3,0-2.3-0.4-3.2-1.3c-0.9-0.9-1.3-2-1.3-3.2V35.1
    		c0-1.3,0.4-2.3,1.3-3.2c0.9-0.9,2-1.3,3.2-1.3c1.3,0,2.3,0.4,3.2,1.3c0.9,0.9,1.3,1.9,1.3,3.2V94.6z"/>
    	<path d="M229.8,63.5c-0.6,0.3-1.2,0.5-1.9,0.5c-1.2,0-2.2-0.4-3.2-1.1c-1-0.7-1.5-1.8-1.5-3.1c0-0.5,0.1-1.1,0.4-1.9
    		c0.5-1.2,1.2-2.4,2.1-3.6c0.9-1.2,2-2.2,3.5-3.1s3.3-1.7,5.4-2.2c2.2-0.5,4.8-0.8,7.9-0.8c5.9,0,10.5,1.2,14,3.5
    		c3.5,2.3,5.2,5.8,5.2,10.3v32.8c0,1.3-0.4,2.3-1.3,3.2c-0.9,0.9-1.9,1.3-3.2,1.3c-1.3,0-2.3-0.4-3.2-1.3c-0.9-0.9-1.3-2-1.3-3.2v-2
    		c-1.2,2-4.7,4.5-7.5,5.3c-2.8,0.8-5.7,1.2-8.8,1.2c-2,0-3.9-0.3-5.9-0.8c-2-0.5-3.8-1.4-5.3-2.5c-1.6-1.1-2.9-2.6-3.8-4.3
    		c-1-1.7-1.5-3.8-1.5-6.2c0-2.8,0.5-5.7,1.6-7.5c1.1-1.9,2.6-3.4,4.4-4.6c1.8-1.2,3.9-2.1,6.3-2.8c2.4-0.6,4.9-1.1,7.5-1.4
    		c3-0.3,5.4-0.7,7.2-1.2c1.7-0.4,3-0.9,3.9-1.5c0.9-0.6,1.4-1.2,1.6-2c0.2-0.7,0.3-1.6,0.3-2.5c0-1.1-0.3-2-0.9-2.8
    		c-0.6-0.8-1.4-1.5-2.4-2c-1-0.5-2.1-0.9-3.3-1.2s-2.4-0.4-3.5-0.4c-2.1,0-3.7,0.2-5,0.5c-1.3,0.3-2.3,0.8-3.1,1.4
    		c-0.8,0.6-1.5,1.3-1.9,2.1c-0.5,0.8-0.9,1.6-1.3,2.5C230.9,62.6,230.4,63.1,229.8,63.5z M250.6,74.4c-1.1,0.3-2.4,0.6-3.8,0.8
    		c-1.5,0.2-3,0.4-4.6,0.6c-1.6,0.2-3.1,0.5-4.6,0.9c-1.5,0.3-2.8,0.8-4,1.5c-1.2,0.7-2.2,1.5-2.9,2.5c-0.7,1-1.1,3-1.1,4.6
    		c0,1.3,0.3,2.3,0.8,3.1c0.5,0.8,1.2,1.5,2.1,2c0.9,0.5,1.8,0.8,2.9,1c1.1,0.2,2.2,0.3,3.3,0.3c1.7,0,3.3-0.2,5-0.6
    		c1.7-0.4,3.2-1,4.5-1.9s2.4-2,3.3-3.5c0.8-1.4,1.2-3.8,1.2-5.9v-6.1L250.6,74.4z"/>
    	<path d="M307.6,90.9c-1.1,2-2.7,3.6-4.6,4.8s-4.1,2.1-6.6,2.7c-2.5,0.5-5.2,0.8-7.9,0.8c-3.9,0-7.2-0.6-9.9-1.8
    		c-2.7-1.2-4.9-2.6-6.5-4.1c-1.7-1.6-2.9-3.1-3.7-4.7c-0.7-1.6-1.1-2.7-1.1-3.5c0-1.3,0.5-2.4,1.4-3.2c0.9-0.8,2-1.2,3.1-1.2
    		c0.7,0,1.3,0.2,2,0.6c0.6,0.4,1.1,1,1.5,1.9c1,2.5,2.5,4.5,4.7,6.2c2.2,1.7,5.2,2.5,9.3,2.5c1.8,0,3.4-0.2,4.7-0.6
    		c1.3-0.4,2.4-1,3.2-1.7c0.8-0.7,1.4-1.5,1.9-2.4c0.4-0.9,0.6-1.8,0.6-2.8c0-2-0.8-3.4-2.3-4.4c-1.5-1-3.5-1.7-5.8-2.3
    		c-2.3-0.6-4.8-1.1-7.5-1.6c-2.7-0.5-5.2-1.2-7.5-2.2c-2.3-0.9-4.2-2.3-5.8-4c-1.6-1.8-2.3-4.2-2.3-7.3c0-4.5,1.6-8,4.9-10.5
    		c3.3-2.5,7.8-3.8,13.7-3.8c3.3,0,6,0.3,8.3,1c2.2,0.7,4.1,1.6,5.5,2.7c0.6,0.5,1.2,1,1.8,1.7c0.6,0.7,1.2,1.4,1.8,2.2
    		c0.6,0.8,1,1.5,1.4,2.3c0.4,0.7,0.6,1.4,0.6,2c0,1.3-0.5,2.4-1.6,3.1c-1,0.8-2.2,1.2-3.4,1.2c-0.7,0-1.5-0.1-2.1-0.6
    		c-0.6-0.6-1-1.3-1.3-1.8c-0.5-1.1-1.1-2-1.7-2.8c-0.5-0.8-1.2-1.5-2-2c-0.8-0.5-1.8-0.9-3-1.2c-1.2-0.3-2.7-0.4-4.4-0.4
    		c-3.5,0-6,0.6-7.6,1.7c-1.6,1.1-2.4,2.5-2.4,4.2c0,1.3,0.5,2.3,1.4,3.1c0.9,0.8,2.1,1.4,3.7,2c1.5,0.5,3.3,1,5.2,1.4
    		c2,0.4,3.9,0.8,5.9,1.3c2,0.5,4,1.1,5.9,1.7c1.9,0.7,3.7,1.6,5.2,2.7c1.5,1.1,2.7,2.5,3.7,4.1c0.9,1.6,1.4,3.6,1.4,6
    		C309.4,86.4,308.8,88.9,307.6,90.9z"/>
    	<path d="M327.4,48.8h4.7c1.1,0,2,0.4,2.8,1.2c0.8,0.8,1.2,1.7,1.2,2.8c0,1.1-0.4,2.1-1.2,2.8s-1.7,1.1-2.8,1.1h-4.7v37.9
    		c0,1.3-0.4,2.3-1.3,3.2c-0.9,0.9-2,1.3-3.2,1.3c-1.3,0-2.3-0.4-3.2-1.3c-0.9-0.9-1.3-2-1.3-3.2V56.7h-4.6c-1.1,0-2-0.4-2.8-1.1
    		c-0.8-0.7-1.2-1.7-1.2-2.8c0-1.1,0.4-2,1.2-2.8c0.8-0.8,1.7-1.2,2.8-1.2h4.6V39c0-1.3,0.4-2.3,1.3-3.2s1.9-1.3,3.2-1.3
    		c1.3,0,2.3,0.4,3.2,1.3s1.3,1.9,1.3,3.2V48.8z"/>
    	<path d="M341.5,32.1c1-1,2.2-1.5,3.7-1.5c1.4,0,2.6,0.5,3.6,1.5c1,1,1.5,2.2,1.5,3.6c0,1.4-0.5,2.6-1.5,3.6c-1,1-2.2,1.5-3.6,1.5
    		c-1.4,0-2.7-0.5-3.7-1.5c-1-1-1.5-2.2-1.5-3.6C340,34.2,340.5,33,341.5,32.1z M349.6,94.6c0,1.3-0.4,2.3-1.3,3.2
    		c-0.9,0.9-1.9,1.3-3.2,1.3c-1.3,0-2.3-0.4-3.2-1.3c-0.9-0.9-1.3-2-1.3-3.2V53.3c0-1.3,0.4-2.3,1.3-3.2c0.9-0.9,2-1.3,3.2-1.3
    		c1.3,0,2.3,0.4,3.2,1.3c0.9,0.9,1.3,2,1.3,3.2V94.6z"/>
    	<path d="M369.1,97.3c-2.9-1.2-5.4-3-7.5-5.2c-2.1-2.2-3.8-4.9-5-8.1c-1.2-3.1-1.8-6.6-1.8-10.4c0-3.8,0.6-7.3,1.8-10.5
    		c1.2-3.1,2.9-5.8,5-8.1c2.1-2.2,4.6-4,7.5-5.2c2.9-1.2,6-1.9,9.4-1.9c3.4,0,6.4,0.5,9,1.5c2.5,1,4.6,2.2,6.2,3.6
    		c1.6,1.4,3.2,2.9,4,4.4c0.5,0.9,0.9,1.5,0.9,2.6c0,1.3-0.5,2.3-1.4,3.1c-0.9,0.7-2,1.1-3.1,1.1c-0.8,0-1.6-0.2-2.2-0.6
    		c-0.7-0.4-1.2-1.3-1.8-2.1c-1-1.4-0.5-0.6-1.1-1.5c-0.7-0.9-1.5-1.6-2.5-2.3c-1-0.7-2.2-1.2-3.5-1.6c-1.4-0.4-2.8-0.6-4.4-0.6
    		c-1.8,0-3.5,0.3-5.3,1c-1.8,0.7-3.3,1.7-4.7,3.1c-1.4,1.4-2.5,3.3-3.4,5.6s-1.3,5.1-1.3,8.4c0,3.3,0.4,6.1,1.3,8.4s2,4.2,3.4,5.6
    		c1.4,1.4,3,2.5,4.7,3.1c1.8,0.7,3.5,1,5.3,1c1.6,0,3.1-0.2,4.4-0.6c1.3-0.4,2.5-0.9,3.5-1.6c1-0.7,1.8-1.5,2.5-2.3
    		c0.7-0.9,1.1-1.8,1.4-2.7c0.3-1,0.8-1.7,1.5-2.1c0.7-0.4,1.4-0.6,2.2-0.6c1.1,0,2.2,0.4,3.1,1.1c0.9,0.7,1.4,1.7,1.4,3
    		c0,0.6-0.3,1.7-0.9,3.1c-0.6,1.5-1.6,2.9-3.1,4.4c-1.5,1.5-3.5,2.8-6.2,4c-2.6,1.1-6,1.7-10,1.7C375.1,99.2,372,98.5,369.1,97.3z"
    		/>
    </g>
</svg>
						</div>
					</a>
				</h1>
			</div>
		</div>
		<div class="4u 6u(small) 6u(xsmall) text-right">
			<!-- <div class="mobile-menu-wrapper"> -->
				<ul class="m-shortcuts">
					
					<li><a href="#" class="m-search" id="header-search"></a></li>
					
					<li><a href="/guide" class="m-docs" id="mobile-docs"></a></li>
					
					<li><a href="/contact" class="m-contact" id="mobile-contact"></a></li>
					
				</ul>	
				<nav class="nav-menu">
					<div class="menu-button">
						<span></span>
					</div>
					<div class="nav-menu-list-wrap">
						<div class="nav-menu-list">
							
								<h3><a href="/products" id="nav_products" >Products</a></h3>

								
								<ul>
									
									<li><a href="/products/elasticsearch" id="nav_elasticsearch" >elasticsearch</a></li>
									
									<li><a href="/found" id="nav_hosted-elasticsearch" >elasticsearch as a service</a></li>
									
									<li><a href="/products/logstash" id="nav_logstash" >logstash</a></li>
									
									<li><a href="/products/kibana" id="nav_kibana" >kibana</a></li>
									
									<li><a href="/products/beats" id="nav_beats" >beats</a></li>
									
									<li><a href="/products/watcher" id="nav_watcher" >watcher</a></li>
									
									<li><a href="/products/shield" id="nav_shield" >shield</a></li>
									
									<li><a href="/products/marvel" id="nav_marvel" >marvel</a></li>
									
									<li><a href="/products/hadoop" id="nav_hadoop" >hadoop</a></li>
									
									<li><a href="/downloads" id="nav_downloads" >downloads</a></li>
									
								</ul>
								
							
								<h3><a href="/subscriptions" id="nav_subscriptions" >Subscriptions</a></h3>

								
							
								<h3><a href="/learn" id="nav_learn" >Learn</a></h3>

								
								<ul>
									
									<li><a href="/guide" id="nav_guide" >docs</a></li>
									
									<li><a href="/videos" id="nav_videos" >videos</a></li>
									
									<li><a href="/training" id="nav_training" >training</a></li>
									
									<li><a href="/services" id="nav_services" >services</a></li>
									
									<li><a href="/blog" id="nav_learn_blog" >blog</a></li>
									
									<li><a href="/elasticon" id="nav_learn_elasticon" >elastic{ON}</a></li>
									
								</ul>
								
							
								<h3><a href="/community" id="nav_community" >Community</a></h3>

								
								<ul>
									
									<li><a href="/community/meetups" id="nav_meetups" >meetups</a></li>
									
									<li><a href="/https:/discuss.elastic.co" id="nav_discuss" target="_blank">discuss</a></li>
									
									<li><a href="/community/codeofconduct" id="nav_codeofconduct" >code of conduct</a></li>
									
								</ul>
								
							
								<h3><a href="/use-cases" id="nav_usecases" >Use Cases</a></h3>

								
							
								<h3><a href="/blog" id="nav_blog" >Blog</a></h3>

								
								<ul>
									
									<li><a href="/blog/category/news" id="blog_news" >News</a></li>
									
									<li><a href="/blog/category/engineering" id="blog_engineering" >Engineering</a></li>
									
									<li><a href="/blog/category/user-stories" id="blog_user-stories" >User Stories</a></li>
									
									<li><a href="/blog/category/releases" id="blog_releases" >Releases</a></li>
									
									<li><a href="/blog/archive" id="blog_archive" >Archive</a></li>
									
								</ul>
								
							
								<h3><a href="/about" id="nav_about" >About</a></h3>

								
								<ul>
									
									<li><a href="/about/leadership" id="nav_leadership" >leadership</a></li>
									
									<li><a href="/about/board" id="nav_board" >board of directors</a></li>
									
									<li><a href="/about/careers" id="nav_careers" >careers</a></li>
									
									<li><a href="/about/partners" id="nav_partners" >partners</a></li>
									
									<li><a href="/about/press" id="nav_press" >press</a></li>
									
								</ul>
								
							
						</div>
					</div>
				</nav>
			<!-- </div> -->
		</div>
	</div>
</div>
<!-- Mobile Menu -->


		</div>
	</div>
</div>
<div class="header-search-wrapper">	
	<div class="container">
		<div class="big-search">
			<i class="big-search-icon"></i>
			<form method="get" action="/search" autocomplete="on" name="searchForm" id="searchfrm">
				<ul class="tags-wrapper">
					<li class="search-field"><input type="text" class="form-control global-input" id="autocomplete" name="q"></li>
				</ul>
			</form>
			<a href="#" class="header-search-cancel"></a>
		</div>
		<div class="nav-auto-complete"></div>
	</div>
</div>
<style>	
	
	
		.m-shortcuts li a.m-search {
			background: url("https://static-www.elastic.co/assets/blt174b13be89ff803c/m-search-icon.png?q=100") no-repeat scroll center center rgba(0, 0, 0, 0);
			background-size: contain;}
	
		.m-shortcuts li a.m-docs {
			background: url("https://static-www.elastic.co/assets/blt5ba03f594a7d610a/m-guide-icon.png?q=100") no-repeat scroll center center rgba(0, 0, 0, 0);
			background-size: contain;}
	
		.m-shortcuts li a.m-contact {
			background: url("https://static-www.elastic.co/assets/blt38c3e853c4b1174d/m-contact-icon.png?q=100") no-repeat scroll center center rgba(0, 0, 0, 0);
			background-size: contain;}
		
</style>
		</div>
	</div>
  	<div id="content">
  		
  			
            <div id="pageheader">
    <div class="container">
        <header>
            <h1><a href="/learn" title="Learn">Learn</a> |</h1>
            <h2><a href="/guide" title="Docs">Docs</a></h2>
        </header>
    </div>
</div>
<section id="guide">

            <!-- start body -->
<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch: The Definitive Guide</a></span> » <span class="breadcrumb-link"><a href="search-in-depth.html">Search in Depth </a></span> » <span class="breadcrumb-node">Multifield Search</span></div><div class="navheader"><span class="prev"><a href="full-text-search.html">
              « 
              Full-Text Search</a>
           
        </span><span class="next">
           
          <a href="proximity-matching.html">Proximity Matching
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="multi-field-search"></a>Multifield Search</h2></div></div></div><p>Queries are seldom simple one-clause <code class="literal">match</code> queries. <a id="id-1.5.5.2.2" class="indexterm"></a> We frequently need to
search for the same or different query strings in one or more fields, which
means that we need to be able to combine multiple query clauses and their
relevance scores in a way that makes sense.</p><p>Perhaps we’re looking for a book called <span class="emphasis"><em>War and Peace</em></span> by an author called
Leo Tolstoy. Perhaps we’re searching the Elasticsearch documentation
for “minimum should match,” which might be in the title or the body of a
page. Or perhaps we’re searching for users with first name John and last
name Smith.</p><p>In this chapter, we present the available tools for constructing multiclause
searches and how to figure out which solution you should apply to your
particular use case.</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="multi-query-strings"></a>Multiple Query Strings</h2></div></div></div><p>The simplest multifield query to deal with is the <a id="id-1.5.5.5.2.1" class="indexterm"></a>
<a id="id-1.5.5.5.2.2" class="indexterm"></a>one where we can <span class="emphasis"><em>map
search terms to specific fields</em></span>. If we know that <span class="emphasis"><em>War and Peace</em></span> is the
title, and Leo Tolstoy is the author, it is easy to write each of these
conditions as a <code class="literal">match</code> clause <a id="id-1.5.5.5.2.6" class="indexterm"></a><a id="id-1.5.5.5.2.7" class="indexterm"></a>
<a id="id-1.5.5.5.2.8" class="indexterm"></a>and to combine them with a <a class="link" href="full-text-search.html#bool-query" title="Combining Queries"><code class="literal">bool</code> query</a>:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">GET /_search
{
  "query": {
    "bool": {
      "should": [
        { "match": { "title":  "War and Peace" }},
        { "match": { "author": "Leo Tolstoy"   }}
      ]
    }
  }
}</pre></div><div class="sense_widget" data-snippet="snippets/110_Multi_Field_Search/05_Multiple_query_strings.json"></div><p>The <code class="literal">bool</code> query takes a <span class="emphasis"><em>more-matches-is-better</em></span> approach, so the score from
each <code class="literal">match</code> clause will be added together to provide the final <code class="literal">_score</code> for
each document. Documents that match both clauses will score higher than
documents that match just one clause.</p><p>Of course, you’re not restricted to using just <code class="literal">match</code> clauses: the <code class="literal">bool</code>
query can wrap any other query type, <a id="id-1.5.5.5.6.3" class="indexterm"></a>
<a id="id-1.5.5.5.6.4" class="indexterm"></a>including other <code class="literal">bool</code> queries.  We could
add a clause to specify that we prefer to see versions of the book that have
been translated by specific translators:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">GET /_search
{
  "query": {
    "bool": {
      "should": [
        { "match": { "title":  "War and Peace" }},
        { "match": { "author": "Leo Tolstoy"   }},
        { "bool":  {
          "should": [
            { "match": { "translator": "Constance Garnett" }},
            { "match": { "translator": "Louise Maude"      }}
          ]
        }}
      ]
    }
  }
}</pre></div><div class="sense_widget" data-snippet="snippets/110_Multi_Field_Search/05_Multiple_query_strings.json"></div><p>Why did we put the translator clauses inside a separate <code class="literal">bool</code> query?  All four
<code class="literal">match</code> queries are <code class="literal">should</code> clauses, so why didn’t we just put the translator
clauses at the same level as the title and author clauses?</p><p>The answer lies in how the score is calculated.<a id="id-1.5.5.5.10.1" class="indexterm"></a>
<a id="id-1.5.5.5.10.2" class="indexterm"></a>  The <code class="literal">bool</code> query runs each
<code class="literal">match</code> query, adds their scores together, then multiplies by the number of
matching clauses, and divides by the total number of clauses. Each clause at
the same level has the same weight. In the preceding query, the <code class="literal">bool</code> query
containing the translator clauses counts for one-third of the total score. If we had
put the translator clauses at the same level as title and author, they
would have reduced the contribution of the title and author clauses to one-quarter each.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="prioritising-clauses"></a>Prioritizing Clauses</h3></div></div></div><p>It is likely that an even one-third split between clauses is not what we need for
the preceding query. <a id="id-1.5.5.5.11.2.1" class="indexterm"></a>
<a id="id-1.5.5.5.11.2.2" class="indexterm"></a>
<a id="id-1.5.5.5.11.2.3" class="indexterm"></a><a id="id-1.5.5.5.11.2.4" class="indexterm"></a>
<a id="id-1.5.5.5.11.2.5" class="indexterm"></a> Probably we’re more interested in the title and author
clauses then we are in the translator clauses. We need to tune the query to
make the title and author clauses relatively more important.</p><p>The simplest weapon in our tuning arsenal is the <code class="literal">boost</code> parameter. To
increase the weight of the <code class="literal">title</code> and <code class="literal">author</code> fields, give <a id="id-1.5.5.5.11.3.4" class="indexterm"></a>
<a id="id-1.5.5.5.11.3.5" class="indexterm"></a><a id="id-1.5.5.5.11.3.6" class="indexterm"></a>
<a id="id-1.5.5.5.11.3.7" class="indexterm"></a>them a <code class="literal">boost</code>
value higher than <code class="literal">1</code>:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">GET /_search
{
  "query": {
    "bool": {
      "should": [
        { "match": { <a id="CO67-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
            "title":  {
              "query": "War and Peace",
              "boost": 2
        }}},
        { "match": { <a id="CO67-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
            "author":  {
              "query": "Leo Tolstoy",
              "boost": 2
        }}},
        { "bool":  { <a id="CO67-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
            "should": [
              { "match": { "translator": "Constance Garnett" }},
              { "match": { "translator": "Louise Maude"      }}
            ]
        }}
      ]
    }
  }
}</pre></div><div class="sense_widget" data-snippet="snippets/110_Multi_Field_Search/05_Multiple_query_strings.json"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO67-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> <a href="#CO67-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">title</code> and <code class="literal">author</code> clauses have a <code class="literal">boost</code> value of <code class="literal">2</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO67-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The nested <code class="literal">bool</code> clause has the default <code class="literal">boost</code> of <code class="literal">1</code>.
</p></td></tr></table></div><p>The “best” value for the <code class="literal">boost</code> parameter is most easily determined by
trial and error: set a <code class="literal">boost</code> value, run test queries, repeat. A reasonable
range for <code class="literal">boost</code> lies between <code class="literal">1</code> and <code class="literal">10</code>, maybe <code class="literal">15</code>. Boosts higher than
that have little more impact because scores are
<a class="link" href="full-text-search.html#boost-normalization" title="Note">normalized</a>.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_single_query_string"></a>Single Query String</h2></div></div></div><p>The <code class="literal">bool</code> query is the mainstay of multiclause queries.<a id="id-1.5.5.6.2.2" class="indexterm"></a>
<a id="id-1.5.5.6.2.3" class="indexterm"></a> It works well
for many cases, especially when you are able to map different query strings to
individual fields.</p><p>The problem is that, these days, users expect to be able to type all of their
search terms into a single field, and expect that the application will figure out how
to give them the right results.  It is ironic that the multifield search form
is known as <span class="emphasis"><em>Advanced Search</em></span>—it may appear advanced to the user, but it is
much simpler to implement.</p><p>There is no simple <span class="emphasis"><em>one-size-fits-all</em></span> approach to multiword, multifield
queries.  To get the best results, you have to <span class="emphasis"><em>know your data</em></span> and know how
to use the appropriate tools.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="know-your-data"></a>Know Your Data</h3></div></div></div><p>When your only user input is a single query string, you will encounter three scenarios frequently:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
Best fields
</span></dt><dd>
When searching for words that represent a concept, such as “brown fox,” the
words mean more together than they do individually. Fields like the <code class="literal">title</code>
and <code class="literal">body</code>, while related, can be considered to be in competition with each
other. Documents should have as many words as possible in <span class="emphasis"><em>the same field</em></span>,
and the score should come from the <span class="emphasis"><em>best-matching field</em></span>.
</dd><dt><span class="term">
Most fields
</span></dt><dd><p class="simpara">A common technique for fine-tuning relevance is to index the same data into
multiple fields, each with its own analysis chain.</p><p class="simpara">The main field may contain words in their stemmed form, synonyms, and words
stripped of their <span class="emphasis"><em>diacritics</em></span>, or accents. It is used to match as many
documents as possible.</p><p class="simpara">The same text could then be indexed in other fields to provide more-precise
matching.  One field may contain the unstemmed version, another the original
word with accents, and a third might use <span class="emphasis"><em>shingles</em></span> to provide information
about <a class="link" href="proximity-matching.html" title="Proximity Matching">word proximity</a>.</p><p class="simpara">These other fields act as <span class="emphasis"><em>signals</em></span> to increase the relevance score of each
matching document. The <span class="emphasis"><em>more fields that match</em></span>, the better.</p></dd><dt><span class="term">
Cross fields
</span></dt><dd><p class="simpara">For some entities, the identifying information is spread across multiple
fields, each of which contains just a part of the whole:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Person: <code class="literal">first_name</code> and <code class="literal">last_name</code>
</li><li class="listitem">
Book: <code class="literal">title</code>, <code class="literal">author</code>, and <code class="literal">description</code>
</li><li class="listitem">
Address:  <code class="literal">street</code>, <code class="literal">city</code>, <code class="literal">country</code>, and <code class="literal">postcode</code>
</li></ul></div><p class="simpara">In this case, we want to find as many words as possible in <span class="emphasis"><em>any</em></span> of the listed
fields. We need to search across multiple fields as if they were one big
field.</p></dd></dl></div><p>All of these are multiword, multifield queries, but each requires a
different strategy. We will examine each strategy in turn in the rest of this
chapter.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_best_fields"></a>Best Fields</h2></div></div></div><p>Imagine that we have a website that allows <a id="id-1.5.5.7.2.1" class="indexterm"></a>
<a id="id-1.5.5.7.2.2" class="indexterm"></a><a id="id-1.5.5.7.2.3" class="indexterm"></a>users to search blog posts, such
as these two documents:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT /my_index/my_type/1
{
    "title": "Quick brown rabbits",
    "body":  "Brown rabbits are commonly seen."
}

PUT /my_index/my_type/2
{
    "title": "Keeping pets healthy",
    "body":  "My quick brown fox eats rabbits on a regular basis."
}</pre></div><div class="sense_widget" data-snippet="snippets/110_Multi_Field_Search/15_Best_fields.json"></div><p>The user types in the words “Brown fox” and clicks Search.   We don’t
know ahead of time if the user’s search terms will be found in the <code class="literal">title</code> or
the <code class="literal">body</code> field of the post, but it is likely that the user is searching for
related words.  To our eyes, document 2 appears to be the better match, as it
contains both words that we are looking for.</p><p>Now we run the following <code class="literal">bool</code> query:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
    "query": {
        "bool": {
            "should": [
                { "match": { "title": "Brown fox" }},
                { "match": { "body":  "Brown fox" }}
            ]
        }
    }
}</pre></div><div class="sense_widget" data-snippet="snippets/110_Multi_Field_Search/15_Best_fields.json"></div><p>And we find that this query gives document 1 the higher score:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "hits": [
     {
        "_id":      "1",
        "_score":   0.14809652,
        "_source": {
           "title": "Quick brown rabbits",
           "body":  "Brown rabbits are commonly seen."
        }
     },
     {
        "_id":      "2",
        "_score":   0.09256032,
        "_source": {
           "title": "Keeping pets healthy",
           "body":  "My quick brown fox eats rabbits on a regular basis."
        }
     }
  ]
}</pre></div><p>To understand why, think about how the <code class="literal">bool</code> query <a id="id-1.5.5.7.11.2" class="indexterm"></a>
<a id="id-1.5.5.7.11.3" class="indexterm"></a><a id="id-1.5.5.7.11.4" class="indexterm"></a>
<a id="id-1.5.5.7.11.5" class="indexterm"></a>calculates its score:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
It runs both of the queries in the <code class="literal">should</code> clause.
</li><li class="listitem">
It adds their scores together.
</li><li class="listitem">
It multiplies the total by the number of matching clauses.
</li><li class="listitem">
It divides the result by the total number of clauses (two).
</li></ol></div><p>Document 1 contains the word <code class="literal">brown</code> in both fields, so both <code class="literal">match</code> clauses
are successful and have a score.  Document 2 contains both <code class="literal">brown</code> and
<code class="literal">fox</code> in the <code class="literal">body</code> field but neither word in the <code class="literal">title</code> field. The high
score from the <code class="literal">body</code> query is added to the zero score from the <code class="literal">title</code> query,
and multiplied by one-half, resulting in a lower overall score than for document 1.</p><p>In this example, the <code class="literal">title</code> and <code class="literal">body</code> fields are competing with each other.
We want to find the single <span class="emphasis"><em>best-matching</em></span> field.</p><p>What if, instead of combining the scores from each field, we used the score
from the <span class="emphasis"><em>best-matching</em></span> field as the overall score for the query?  This would
give preference to a single field that contains <span class="emphasis"><em>both</em></span> of the words we are
looking for, rather than the same word repeated in different fields.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="dis-max-query"></a>dis_max Query</h3></div></div></div><p>Instead of the <code class="literal">bool</code> query, we can use the  <code class="literal">dis_max</code> or <span class="emphasis"><em>Disjunction Max
Query</em></span>.  Disjunction means <span class="emphasis"><em>or</em></span><a id="id-1.5.5.7.16.2.5" class="indexterm"></a> (while conjunction means <span class="emphasis"><em>and</em></span>) so the
Disjunction Max Query simply means <span class="emphasis"><em>return documents that match any of these
queries, and return the score of the best matching query</em></span>:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
    "query": {
        "dis_max": {
            "queries": [
                { "match": { "title": "Brown fox" }},
                { "match": { "body":  "Brown fox" }}
            ]
        }
    }
}</pre></div><div class="sense_widget" data-snippet="snippets/110_Multi_Field_Search/15_Best_fields.json"></div><p>This produces the results that we want:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "hits": [
     {
        "_id":      "2",
        "_score":   0.21509302,
        "_source": {
           "title": "Keeping pets healthy",
           "body":  "My quick brown fox eats rabbits on a regular basis."
        }
     },
     {
        "_id":      "1",
        "_score":   0.12713557,
        "_source": {
           "title": "Quick brown rabbits",
           "body":  "Brown rabbits are commonly seen."
        }
     }
  ]
}</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_tuning_best_fields_queries"></a>Tuning Best Fields Queries</h2></div></div></div><p>What would happen if the user<a id="id-1.5.5.8.2.1" class="indexterm"></a>
<a id="id-1.5.5.8.2.2" class="indexterm"></a>
<a id="id-1.5.5.8.2.3" class="indexterm"></a><a id="id-1.5.5.8.2.4" class="indexterm"></a>
<a id="id-1.5.5.8.2.5" class="indexterm"></a> had searched instead for “quick pets”?  Both
documents contain the word <code class="literal">quick</code>, but only document 2 contains the word
<code class="literal">pets</code>. Neither document contains <span class="emphasis"><em>both words</em></span> in the <span class="emphasis"><em>same field</em></span>.</p><p>A simple <code class="literal">dis_max</code> query like the following would <a id="id-1.5.5.8.3.2" class="indexterm"></a><a id="id-1.5.5.8.3.3" class="indexterm"></a>
<a id="id-1.5.5.8.3.4" class="indexterm"></a>choose the single best
matching field, and ignore the other:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
    "query": {
        "dis_max": {
            "queries": [
                { "match": { "title": "Quick pets" }},
                { "match": { "body":  "Quick pets" }}
            ]
        }
    }
}</pre></div><div class="sense_widget" data-snippet="snippets/110_Multi_Field_Search/15_Best_fields.json"></div><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "hits": [
     {
        "_id": "1",
        "_score": 0.12713557, <a id="CO68-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
        "_source": {
           "title": "Quick brown rabbits",
           "body": "Brown rabbits are commonly seen."
        }
     },
     {
        "_id": "2",
        "_score": 0.12713557, <a id="CO68-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
        "_source": {
           "title": "Keeping pets healthy",
           "body": "My quick brown fox eats rabbits on a regular basis."
        }
     }
   ]
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO68-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> <a href="#CO68-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Note that the scores are exactly the same.
</p></td></tr></table></div><p>We would probably expect documents that match on both the <code class="literal">title</code> field and
the <code class="literal">body</code> field to rank higher than documents that match on just one field,
but this isn’t the case. Remember: the <code class="literal">dis_max</code> query simply uses the
<code class="literal">_score</code> from the <span class="emphasis"><em>single</em></span> best-matching clause.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_tie_breaker"></a>tie_breaker</h3></div></div></div><p>It is possible, however, to<a id="id-1.5.5.8.9.2.1" class="indexterm"></a>
<a id="id-1.5.5.8.9.2.2" class="indexterm"></a><a id="id-1.5.5.8.9.2.3" class="indexterm"></a>
<a id="id-1.5.5.8.9.2.4" class="indexterm"></a>
<a id="id-1.5.5.8.9.2.5" class="indexterm"></a> also take the <code class="literal">_score</code> from the other matching
clauses into account, by specifying <a id="id-1.5.5.8.9.2.7" class="indexterm"></a>the <code class="literal">tie_breaker</code> parameter:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
    "query": {
        "dis_max": {
            "queries": [
                { "match": { "title": "Quick pets" }},
                { "match": { "body":  "Quick pets" }}
            ],
            "tie_breaker": 0.3
        }
    }
}</pre></div><div class="sense_widget" data-snippet="snippets/110_Multi_Field_Search/15_Best_fields.json"></div><p>This gives us the following results:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "hits": [
     {
        "_id": "2",
        "_score": 0.14757764, <a id="CO69-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
        "_source": {
           "title": "Keeping pets healthy",
           "body": "My quick brown fox eats rabbits on a regular basis."
        }
     },
     {
        "_id": "1",
        "_score": 0.124275915, <a id="CO69-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
        "_source": {
           "title": "Quick brown rabbits",
           "body": "Brown rabbits are commonly seen."
        }
     }
   ]
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO69-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> <a href="#CO69-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Document 2 now has a small lead over document 1.
</p></td></tr></table></div><p>The <code class="literal">tie_breaker</code> parameter makes the <code class="literal">dis_max</code> query behave more like a
halfway house between <code class="literal">dis_max</code> and <code class="literal">bool</code>. It changes the score calculation
as follows:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
Take the <code class="literal">_score</code> of the best-matching clause.
</li><li class="listitem">
Multiply the score of each of the other matching clauses by the <code class="literal">tie_breaker</code>.
</li><li class="listitem">
Add them all together and normalize.
</li></ol></div><p>With the <code class="literal">tie_breaker</code>, all matching clauses count, but the best-matching
clause counts most.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>The <code class="literal">tie_breaker</code> can be a floating-point value between <code class="literal">0</code> and <code class="literal">1</code>, where <code class="literal">0</code>
uses just the best-matching clause<a id="id-1.5.5.8.9.11.1.5" class="indexterm"></a>
<a id="id-1.5.5.8.9.11.1.6" class="indexterm"></a> and <code class="literal">1</code> counts all matching clauses
equally.  The exact value can be tuned based on your data and queries, but a
reasonable value should be close to zero, (for example, <code class="literal">0.1 - 0.4</code>), in order not to
overwhelm the best-matching nature of <code class="literal">dis_max</code>.</p></div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="multi-match-query"></a>multi_match Query</h2></div></div></div><p>The <code class="literal">multi_match</code> query provides <a id="id-1.5.5.9.2.2" class="indexterm"></a>
<a id="id-1.5.5.9.2.3" class="indexterm"></a><a id="id-1.5.5.9.2.4" class="indexterm"></a><a id="id-1.5.5.9.2.5" class="indexterm"></a>
<a id="id-1.5.5.9.2.6" class="indexterm"></a> a convenient shorthand way of running
the same query against multiple fields.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>There are several types of <code class="literal">multi_match</code> query, three of which just
happen to coincide with the three scenarios that we listed in
<a class="xref" href="multi-field-search.html#know-your-data" title="Know Your Data">Know Your Data</a>:  <code class="literal">best_fields</code>, <code class="literal">most_fields</code>, and <code class="literal">cross_fields</code>.</p></div></div><p>By default, this query runs as type <code class="literal">best_fields</code>, which means<a id="id-1.5.5.9.4.2" class="indexterm"></a>
<a id="id-1.5.5.9.4.3" class="indexterm"></a><a id="id-1.5.5.9.4.4" class="indexterm"></a>
<a id="id-1.5.5.9.4.5" class="indexterm"></a> that it generates a
<code class="literal">match</code> query for each field and wraps them in a <code class="literal">dis_max</code> query. This
<code class="literal">dis_max</code> query</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "dis_max": {
    "queries":  [
      {
        "match": {
          "title": {
            "query": "Quick brown fox",
            "minimum_should_match": "30%"
          }
        }
      },
      {
        "match": {
          "body": {
            "query": "Quick brown fox",
            "minimum_should_match": "30%"
          }
        }
      },
    ],
    "tie_breaker": 0.3
  }
}</pre></div><p>could be rewritten more concisely with <code class="literal">multi_match</code> as follows:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
    "multi_match": {
        "query":                "Quick brown fox",
        "type":                 "best_fields", <a id="CO70-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
        "fields":               [ "title", "body" ],
        "tie_breaker":          0.3,
        "minimum_should_match": "30%" <a id="CO70-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
    }
}</pre></div><div class="sense_widget" data-snippet="snippets/110_Multi_Field_Search/25_Best_fields.json"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO70-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">best_fields</code> type is the default and can be left out.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO70-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Parameters like <code class="literal">minimum_should_match</code> or <code class="literal">operator</code> are passed through to
    the generated <code class="literal">match</code> queries.
</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_using_wildcards_in_field_names"></a>Using Wildcards in Field Names</h3></div></div></div><p>Field names can be specified with wildcards: any field that matches the
wildcard pattern<a id="id-1.5.5.9.10.2.1" class="indexterm"></a>
<a id="id-1.5.5.9.10.2.2" class="indexterm"></a><a id="id-1.5.5.9.10.2.3" class="indexterm"></a><a id="id-1.5.5.9.10.2.4" class="indexterm"></a>
<a id="id-1.5.5.9.10.2.5" class="indexterm"></a> will be included in the search. You could match on the
<code class="literal">book_title</code>, <code class="literal">chapter_title</code>, and <code class="literal">section_title</code> fields, with the following:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
    "multi_match": {
        "query":  "Quick brown fox",
        "fields": "*_title"
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_boosting_individual_fields"></a>Boosting Individual Fields</h3></div></div></div><p>Individual fields can be boosted by using the caret (<code class="literal">^</code>) syntax: just add
<code class="literal">^boost</code> after the field<a id="id-1.5.5.9.11.2.3" class="indexterm"></a>
<a id="id-1.5.5.9.11.2.4" class="indexterm"></a><a id="id-1.5.5.9.11.2.5" class="indexterm"></a>
<a id="id-1.5.5.9.11.2.6" class="indexterm"></a> name, where <code class="literal">boost</code> is a floating-point number:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
    "multi_match": {
        "query":  "Quick brown fox",
        "fields": [ "*_title", "chapter_title^2" ] <a id="CO71-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO71-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">chapter_title</code> field has a <code class="literal">boost</code> of <code class="literal">2</code>, while the <code class="literal">book_title</code> and
    <code class="literal">section_title</code> fields have a default boost of <code class="literal">1</code>.
</p></td></tr></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="most-fields"></a>Most Fields</h2></div></div></div><p>Full-text search is a battle between <span class="emphasis"><em>recall</em></span>—returning all the
documents that are <a id="id-1.5.5.10.2.2" class="indexterm"></a><a id="id-1.5.5.10.2.3" class="indexterm"></a>
<a id="id-1.5.5.10.2.4" class="indexterm"></a>relevant—and <span class="emphasis"><em>precision</em></span>—not returning irrelevant
documents.  The goal is to present the user with the most relevant documents
on the first page of results.</p><p>To improve recall, we cast<a id="id-1.5.5.10.3.1" class="indexterm"></a>
<a id="id-1.5.5.10.3.2" class="indexterm"></a> the net wide—we include not only
documents that match the user’s search terms exactly, but also
documents that we believe to be pertinent to the query.  If a user searches
for “quick brown fox,” a document that contains <code class="literal">fast foxes</code> may well be
a reasonable result to return.</p><p>If the only pertinent document that we have is the one containing <code class="literal">fast
foxes</code>, it will appear at the top of the results list.  But of course, if
we have 100 documents that contain the words <code class="literal">quick brown fox</code>, then the
<code class="literal">fast foxes</code> document may be considered less relevant, and we would want to
push it further down the list.  After including many potential matches, we
need to ensure that the best ones rise to the top.</p><p>A common technique for fine-tuning full-text relevance<a id="id-1.5.5.10.5.1" class="indexterm"></a>
<a id="id-1.5.5.10.5.2" class="indexterm"></a> is to index the same
text in multiple ways, each of which provides a different relevance <span class="emphasis"><em>signal</em></span>. The main field would contain terms in their broadest-matching form to match as
many documents as possible.  For instance, we could do the following:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Use a stemmer to index <code class="literal">jumps</code>, <code class="literal">jumping</code>, and <code class="literal">jumped</code> as their root
    form: <code class="literal">jump</code>.  Then it doesn’t matter if the user searches for
    <code class="literal">jumped</code>; we could still match documents containing <code class="literal">jumping</code>.
</li><li class="listitem">
Include synonyms like <code class="literal">jump</code>, <code class="literal">leap</code>, and <code class="literal">hop</code>.
</li><li class="listitem">
Remove diacritics, or accents: for example, <code class="literal">ésta</code>, <code class="literal">está</code>, and <code class="literal">esta</code> would
    all be indexed without accents as <code class="literal">esta</code>.
</li></ul></div><p>However, if we have two documents, one of which contains <code class="literal">jumped</code> and the
other <code class="literal">jumping</code>, the user would probably expect the first document to rank
higher, as it contains exactly what was typed in.</p><p>We can achieve this by indexing the same text in other fields to provide more-precise matching.  One field may contain the unstemmed version, another the
original word with diacritics, and a third might use <span class="emphasis"><em>shingles</em></span> to provide
information about <a class="link" href="proximity-matching.html" title="Proximity Matching">word proximity</a>. These other fields
act as <span class="emphasis"><em>signals</em></span> that increase the relevance score of each matching document.
The more fields that match, the better.</p><p>A document is included in the results list if it matches the broad-matching
main field. If it also matches the <span class="emphasis"><em>signal</em></span> fields, it gets extra
points and is pushed up the results list.</p><p>We discuss synonyms, word proximity, partial-matching and other potential
signals later in the book, but we will use the simple example of stemmed and
unstemmed fields to illustrate this technique.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_multifield_mapping"></a>Multifield Mapping</h3></div></div></div><p>The first thing to do is to set up our <a id="id-1.5.5.10.11.2.1" class="indexterm"></a>
<a id="id-1.5.5.10.11.2.2" class="indexterm"></a><a id="id-1.5.5.10.11.2.3" class="indexterm"></a>
<a id="id-1.5.5.10.11.2.4" class="indexterm"></a>field to be indexed twice: once in a
stemmed form and once in an unstemmed form.  To do this, we will use
<span class="emphasis"><em>multifields</em></span>, which we introduced in <a class="xref" href="sorting.html#multi-fields" title="문자열 정렬과 다중 field">문자열 정렬과 다중 field</a>:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">DELETE /my_index

PUT /my_index
{
    "settings": { "number_of_shards": 1 }, <a id="CO72-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
    "mappings": {
        "my_type": {
            "properties": {
                "title": { <a id="CO72-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
                    "type":     "string",
                    "analyzer": "english",
                    "fields": {
                        "std":   { <a id="CO72-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
                            "type":     "string",
                            "analyzer": "standard"
                        }
                    }
                }
            }
        }
    }
}</pre></div><div class="sense_widget" data-snippet="snippets/110_Multi_Field_Search/30_Most_fields.json"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO72-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
See <a class="xref" href="full-text-search.html#relevance-is-broken" title="Relevance Is Broken!">Relevance Is Broken!</a>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO72-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">title</code> field is stemmed by the <code class="literal">english</code> analyzer.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO72-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">title.std</code> field uses the <code class="literal">standard</code> analyzer and so is not stemmed.
</p></td></tr></table></div><p>Next we index some documents:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT /my_index/my_type/1
{ "title": "My rabbit jumps" }

PUT /my_index/my_type/2
{ "title": "Jumping jack rabbits" }</pre></div><div class="sense_widget" data-snippet="snippets/110_Multi_Field_Search/30_Most_fields.json"></div><p>Here is a simple <code class="literal">match</code> query on the <code class="literal">title</code> field for <code class="literal">jumping rabbits</code>:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">GET /my_index/_search
{
   "query": {
        "match": {
            "title": "jumping rabbits"
        }
    }
}</pre></div><div class="sense_widget" data-snippet="snippets/110_Multi_Field_Search/30_Most_fields.json"></div><p>This becomes a query for the two stemmed terms <code class="literal">jump</code> and <code class="literal">rabbit</code>, thanks to the
<code class="literal">english</code> analyzer. The <code class="literal">title</code> field of both documents contains both of those
terms, so both documents receive the same score:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "hits": [
     {
        "_id": "1",
        "_score": 0.42039964,
        "_source": {
           "title": "My rabbit jumps"
        }
     },
     {
        "_id": "2",
        "_score": 0.42039964,
        "_source": {
           "title": "Jumping jack rabbits"
        }
     }
  ]
}</pre></div><p>If we were to query just the <code class="literal">title.std</code> field, then only document 2 would
match.  However, if we were to query both fields and to <span class="emphasis"><em>combine</em></span> their scores
by using the <code class="literal">bool</code> query, then both documents would match (thanks to the <code class="literal">title</code>
field) and document 2 would score higher (thanks to the <code class="literal">title.std</code> field):</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">GET /my_index/_search
{
   "query": {
        "multi_match": {
            "query":  "jumping rabbits",
            "type":   "most_fields", <a id="CO73-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
            "fields": [ "title", "title.std" ]
        }
    }
}</pre></div><div class="sense_widget" data-snippet="snippets/110_Multi_Field_Search/30_Most_fields.json"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO73-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
We want to combine the scores from all matching fields, so we use the
     <code class="literal">most_fields</code> type.  This causes the <code class="literal">multi_match</code> query to wrap the two
     field-clauses in a <code class="literal">bool</code> query instead of a <code class="literal">dis_max</code> query.
</p></td></tr></table></div><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "hits": [
     {
        "_id": "2",
        "_score": 0.8226396, <a id="CO74-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
        "_source": {
           "title": "Jumping jack rabbits"
        }
     },
     {
        "_id": "1",
        "_score": 0.10741998, <a id="CO74-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
        "_source": {
           "title": "My rabbit jumps"
        }
     }
  ]
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO74-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> <a href="#CO74-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Document 2 now scores much higher than document 1.
</p></td></tr></table></div><p>We are using the broad-matching <code class="literal">title</code> field to include as many documents as
possible—to increase recall—but we use the <code class="literal">title.std</code> field as a
<span class="emphasis"><em>signal</em></span> to push the most relevant results to the top.</p><p>The contribution of each field to the final score can be controlled by
specifying custom <code class="literal">boost</code> values. For instance, we could boost the <code class="literal">title</code>
field to make it the most important field, thus reducing the effect of any
other signal fields:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">GET /my_index/_search
{
   "query": {
        "multi_match": {
            "query":       "jumping rabbits",
            "type":        "most_fields",
            "fields":      [ "title^10", "title.std" ] <a id="CO75-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
        }
    }
}</pre></div><div class="sense_widget" data-snippet="snippets/110_Multi_Field_Search/30_Most_fields.json"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO75-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">boost</code> value of <code class="literal">10</code> on the <code class="literal">title</code> field makes that field relatively
    much more important than the <code class="literal">title.std</code> field.
</p></td></tr></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_cross_fields_entity_search"></a>Cross-fields Entity Search</h2></div></div></div><p>Now we come to a common pattern: cross-fields entity search. <a id="id-1.5.5.11.2.1" class="indexterm"></a><a id="id-1.5.5.11.2.2" class="indexterm"></a>
<a id="id-1.5.5.11.2.3" class="indexterm"></a> With entities
like <code class="literal">person</code>, <code class="literal">product</code>, or <code class="literal">address</code>, the identifying information is spread
across several fields.  We may have a <code class="literal">person</code> indexed as follows:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
    "firstname":  "Peter",
    "lastname":   "Smith"
}</pre></div><p>Or an address like this:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
    "street":   "5 Poland Street",
    "city":     "London",
    "country":  "United Kingdom",
    "postcode": "W1V 3DG"
}</pre></div><p>This sounds a lot like the example we described in <a class="xref" href="multi-field-search.html#multi-query-strings" title="Multiple Query Strings">Multiple Query Strings</a>,
but there is a big difference between these two scenarios.  In
<a class="xref" href="multi-field-search.html#multi-query-strings" title="Multiple Query Strings">Multiple Query Strings</a>, we used a separate query string for each field. In
this scenario, we want to search across multiple fields with a <span class="emphasis"><em>single</em></span> query
string.</p><p>Our user might search for the person “Peter Smith” or for the address
“Poland Street W1V.” Each of those words appears in a different field, so
using a <code class="literal">dis_max</code> / <code class="literal">best_fields</code> query to find the <span class="emphasis"><em>single</em></span> best-matching
field is clearly the wrong approach.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_a_naive_approach"></a>A Naive Approach</h3></div></div></div><p>Really, we want to query each field in turn and add up the scores of every
field that matches, which sounds like a job for the <code class="literal">bool</code> query:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "query": {
    "bool": {
      "should": [
        { "match": { "street":    "Poland Street W1V" }},
        { "match": { "city":      "Poland Street W1V" }},
        { "match": { "country":   "Poland Street W1V" }},
        { "match": { "postcode":  "Poland Street W1V" }}
      ]
    }
  }
}</pre></div><p>Repeating the query string for every field soon becomes tedious. We can use
the <code class="literal">multi_match</code> query instead, <a id="id-1.5.5.11.8.4.2" class="indexterm"></a>
<a id="id-1.5.5.11.8.4.3" class="indexterm"></a><a id="id-1.5.5.11.8.4.4" class="indexterm"></a>
<a id="id-1.5.5.11.8.4.5" class="indexterm"></a>and set the <code class="literal">type</code> to <code class="literal">most_fields</code> to tell it to
combine the scores of all matching fields:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "query": {
    "multi_match": {
      "query":       "Poland Street W1V",
      "type":        "most_fields",
      "fields":      [ "street", "city", "country", "postcode" ]
    }
  }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_problems_with_the_most_fields_approach"></a>Problems with the most_fields Approach</h3></div></div></div><p>The <code class="literal">most_fields</code> approach to entity search has some problems that are not
immediately obvious:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
It is designed to find the most fields matching <span class="emphasis"><em>any</em></span> words, rather than to
  find the most matching words <span class="emphasis"><em>across all fields</em></span>.
</li><li class="listitem">
It can’t use the <code class="literal">operator</code> or <code class="literal">minimum_should_match</code> parameters
  to reduce the long tail of less-relevant results.
</li><li class="listitem">
Term frequencies are different in each field and could interfere with each
  other to produce badly ordered results.
</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="field-centric"></a>Field-Centric Queries</h2></div></div></div><p>All three of the preceding problems stem from  <a id="id-1.5.5.12.2.1" class="indexterm"></a><a id="id-1.5.5.12.2.2" class="indexterm"></a>
<a id="id-1.5.5.12.2.3" class="indexterm"></a><a id="id-1.5.5.12.2.4" class="indexterm"></a>
<a id="id-1.5.5.12.2.5" class="indexterm"></a><code class="literal">most_fields</code> being
<span class="emphasis"><em>field-centric</em></span> rather than <span class="emphasis"><em>term-centric</em></span>: it looks for the  most matching
<span class="emphasis"><em>fields</em></span>, when really what we’re interested is the most matching <span class="emphasis"><em>terms</em></span>.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>The <code class="literal">best_fields</code> type is also field-centric<a id="id-1.5.5.12.3.1.2" class="indexterm"></a>
<a id="id-1.5.5.12.3.1.3" class="indexterm"></a> and suffers from similar problems.</p></div></div><p>First we’ll look at why these problems exist, and then how we can combat them.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_problem_1_matching_the_same_word_in_multiple_fields"></a>Problem 1: Matching the Same Word in Multiple Fields</h3></div></div></div><p>Think about how the <code class="literal">most_fields</code> query is executed: Elasticsearch generates a
separate <code class="literal">match</code> query for each field and then wraps these match queries in an outer <code class="literal">bool</code> query.</p><p>We can see this by passing our query through the <code class="literal">validate-query</code> API:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">GET /_validate/query?explain
{
  "query": {
    "multi_match": {
      "query":   "Poland Street W1V",
      "type":    "most_fields",
      "fields":  [ "street", "city", "country", "postcode" ]
    }
  }
}</pre></div><div class="sense_widget" data-snippet="snippets/110_Multi_Field_Search/40_Entity_search_problems.json"></div><p>which yields this <code class="literal">explanation</code>:</p><pre class="literallayout">(street:poland   street:street   street:w1v)
(city:poland     city:street     city:w1v)
(country:poland  country:street  country:w1v)
(postcode:poland postcode:street postcode:w1v)</pre><p>You can see that a document matching just the word <code class="literal">poland</code> in <span class="emphasis"><em>two</em></span> fields
could score higher than a document matching <code class="literal">poland</code> and <code class="literal">street</code> in one
field.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_problem_2_trimming_the_long_tail"></a>Problem 2: Trimming the Long Tail</h3></div></div></div><p>In <a class="xref" href="full-text-search.html#match-precision" title="Controlling Precision">Controlling Precision</a>, we talked about<a id="id-1.5.5.12.6.2.2" class="indexterm"></a>
<a id="id-1.5.5.12.6.2.3" class="indexterm"></a><a id="id-1.5.5.12.6.2.4" class="indexterm"></a>
<a id="id-1.5.5.12.6.2.5" class="indexterm"></a> using the <code class="literal">and</code> operator or the
<code class="literal">minimum_should_match</code> parameter to trim the long tail of almost irrelevant
results. Perhaps we could try this:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
    "query": {
        "multi_match": {
            "query":       "Poland Street W1V",
            "type":        "most_fields",
            "operator":    "and", <a id="CO76-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
            "fields":      [ "street", "city", "country", "postcode" ]
        }
    }
}</pre></div><div class="sense_widget" data-snippet="snippets/110_Multi_Field_Search/40_Entity_search_problems.json"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO76-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
All terms must be present.
</p></td></tr></table></div><p>However, with <code class="literal">best_fields</code> or <code class="literal">most_fields</code>, these parameters are passed down
to the generated <code class="literal">match</code> queries. The <code class="literal">explanation</code> for this query shows the
following:</p><pre class="literallayout">(+street:poland   +street:street   +street:w1v)
(+city:poland     +city:street     +city:w1v)
(+country:poland  +country:street  +country:w1v)
(+postcode:poland +postcode:street +postcode:w1v)</pre><p>In other words, using the <code class="literal">and</code> operator means that all words must exist <span class="emphasis"><em>in
the same field</em></span>, which is clearly wrong! It is unlikely that any documents
would match this query.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_problem_3_term_frequencies"></a>Problem 3: Term Frequencies</h3></div></div></div><p>In <a class="xref" href="sorting.html#relevance-intro" title="Relevance가 무엇인가?">Relevance가 무엇인가?</a>, we explained that the default similarity algorithm
used to calculate the relevance score <a id="id-1.5.5.12.7.2.2" class="indexterm"></a>
<a id="id-1.5.5.12.7.2.3" class="indexterm"></a>for each term is TF/IDF:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
Term frequency
</span></dt><dd>
    The more often a term appears in a field in a single document, the more
    relevant the document.
</dd><dt><span class="term">
Inverse document frequency
</span></dt><dd>
    The more often a term appears in a field in all documents in the index,
    the less relevant is that term.
</dd></dl></div><p>When searching against multiple fields, TF/IDF can<a id="id-1.5.5.12.7.4.1" class="indexterm"></a>
<a id="id-1.5.5.12.7.4.2" class="indexterm"></a> introduce some surprising
results.</p><p>Consider our example of searching for “Peter Smith” using the <code class="literal">first_name</code>
and <code class="literal">last_name</code> fields.<a id="id-1.5.5.12.7.5.3" class="indexterm"></a>
<a id="id-1.5.5.12.7.5.4" class="indexterm"></a>  Peter is a common first name and Smith is a common
last name—both will have low IDFs.  But what if we have another person in
the index whose name is Smith Williams?  Smith as a first name is very
uncommon and so will have a high IDF!</p><p>A simple query like the following may well return Smith Williams above
Peter Smith in spite of the fact that the second person is a better match
than the first.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
    "query": {
        "multi_match": {
            "query":       "Peter Smith",
            "type":        "most_fields",
            "fields":      [ "*_name" ]
        }
    }
}</pre></div><div class="sense_widget" data-snippet="snippets/110_Multi_Field_Search/40_Bad_frequencies.json"></div><p>The high IDF of <code class="literal">smith</code> in the first name field can overwhelm the two low IDFs
of <code class="literal">peter</code> as a first name and <code class="literal">smith</code> as a last name.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_solution"></a>Solution</h3></div></div></div><p>These problems only exist because we are dealing with multiple fields. If we
were to combine all of these fields into a single field, the problems would
vanish. We could achieve this by adding a <code class="literal">full_name</code> field to our <code class="literal">person</code>
document:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
    "first_name":  "Peter",
    "last_name":   "Smith",
    "full_name":   "Peter Smith"
}</pre></div><p>When querying just the <code class="literal">full_name</code> field:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Documents with more matching words would trump documents with the same word
  repeated.
</li><li class="listitem">
The <code class="literal">minimum_should_match</code> and <code class="literal">operator</code> parameters would function as
  expected.
</li><li class="listitem">
The inverse document frequencies for first and last names would be combined
  so it wouldn’t matter whether Smith were a first or last name anymore.
</li></ul></div><p>While this would work, we don’t like having to store redundant data.  Instead,
Elasticsearch offers us two solutions—one at index time and one at search
time—which we discuss next.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="custom-all"></a>Custom _all Fields</h2></div></div></div><p>In <a class="xref" href="index-management.html#all-field" title="Metadata: _all Field">Metadata: _all Field</a>, we explained that the special <code class="literal">_all</code> field indexes the values
from all other fields as one big string.<a id="id-1.5.5.13.2.3" class="indexterm"></a><a id="id-1.5.5.13.2.4" class="indexterm"></a>
<a id="id-1.5.5.13.2.5" class="indexterm"></a> Having all fields indexed into one
field is not terribly flexible, though.  It would be nice to have one custom
<code class="literal">_all</code> field for the person’s name, and another custom <code class="literal">_all</code> field for the
address.</p><p>Elasticsearch provides us with this functionality via the <code class="literal">copy_to</code> parameter
in a field <a id="id-1.5.5.13.3.2" class="indexterm"></a><a id="id-1.5.5.13.3.3" class="indexterm"></a>
<a id="id-1.5.5.13.3.4" class="indexterm"></a>mapping:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT /my_index
{
    "mappings": {
        "person": {
            "properties": {
                "first_name": {
                    "type":     "string",
                    "copy_to":  "full_name" <a id="CO77-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
                },
                "last_name": {
                    "type":     "string",
                    "copy_to":  "full_name" <a id="CO77-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
                },
                "full_name": {
                    "type":     "string"
                }
            }
        }
    }
}</pre></div><div class="sense_widget" data-snippet="snippets/110_Multi_Field_Search/45_Custom_all.json"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO77-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> <a href="#CO77-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The values in the <code class="literal">first_name</code> and <code class="literal">last_name</code> fields
    are also copied to the <code class="literal">full_name</code> field.
</p></td></tr></table></div><p>With this mapping in place, we can query the <code class="literal">first_name</code> field for first
names, the <code class="literal">last_name</code> field for last name, or the <code class="literal">full_name</code> field for first
and last names.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Mappings of the <code class="literal">first_name</code> and <code class="literal">last_name</code> fields have no bearing
on how the <code class="literal">full_name</code> field is indexed. The <code class="literal">full_name</code> field copies the
string values from the other two fields, then indexes them according to the
mapping of the <code class="literal">full_name</code> field only.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_cross_fields_queries"></a>cross-fields Queries</h2></div></div></div><p>The custom <code class="literal">_all</code> approach is a good solution, as long as you thought
about setting it up before you indexed your<a id="id-1.5.5.14.2.2" class="indexterm"></a>
<a id="id-1.5.5.14.2.3" class="indexterm"></a><a id="id-1.5.5.14.2.4" class="indexterm"></a> documents. However, Elasticsearch
also provides a search-time solution to the problem: the <code class="literal">multi_match</code> query
with type <code class="literal">cross_fields</code>.<a id="id-1.5.5.14.2.7" class="indexterm"></a>
<a id="id-1.5.5.14.2.8" class="indexterm"></a>
The <code class="literal">cross_fields</code> type takes a term-centric approach, quite different from the
field-centric approach taken by <code class="literal">best_fields</code> and <code class="literal">most_fields</code>. It treats all
of the fields as one big field, and looks for <span class="emphasis"><em>each term</em></span> in <span class="emphasis"><em>any field</em></span>.</p><p>To illustrate the difference between field-centric and term-centric queries,
look at <a id="id-1.5.5.14.3.1" class="indexterm"></a>
<a id="id-1.5.5.14.3.2" class="indexterm"></a><a id="id-1.5.5.14.3.3" class="indexterm"></a>
<a id="id-1.5.5.14.3.4" class="indexterm"></a>the <code class="literal">explanation</code> for this field-centric <code class="literal">most_fields</code> query:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">GET /_validate/query?explain
{
    "query": {
        "multi_match": {
            "query":       "peter smith",
            "type":        "most_fields",
            "operator":    "and", <a id="CO78-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
            "fields":      [ "first_name", "last_name" ]
        }
    }
}</pre></div><div class="sense_widget" data-snippet="snippets/110_Multi_Field_Search/50_Cross_field.json"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO78-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
All terms are required.
</p></td></tr></table></div><p>For a document to match, both <code class="literal">peter</code> and <code class="literal">smith</code> must appear in the same
field, either the <code class="literal">first_name</code> field or the <code class="literal">last_name</code> field:</p><pre class="literallayout">(+first_name:peter +first_name:smith)
(+last_name:peter  +last_name:smith)</pre><p>A <span class="emphasis"><em>term-centric</em></span> approach would use this logic instead:</p><pre class="literallayout">+(first_name:peter last_name:peter)
+(first_name:smith last_name:smith)</pre><p>In other words, the term <code class="literal">peter</code> must appear in either field, and the term
<code class="literal">smith</code> must appear in either field.</p><p>The <code class="literal">cross_fields</code> type first analyzes the query string to produce a list of
terms, and then it searches for each term in any field. That difference alone
solves two of the three problems that we listed in <a class="xref" href="multi-field-search.html#field-centric" title="Field-Centric Queries">Field-Centric Queries</a>, leaving
us just with the issue of differing inverse document frequencies.</p><p>Fortunately, the <code class="literal">cross_fields</code> type solves this too, as can be seen from this
<code class="literal">validate-query</code> request:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">GET /_validate/query?explain
{
    "query": {
        "multi_match": {
            "query":       "peter smith",
            "type":        "cross_fields", <a id="CO79-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
            "operator":    "and",
            "fields":      [ "first_name", "last_name" ]
        }
    }
}</pre></div><div class="sense_widget" data-snippet="snippets/110_Multi_Field_Search/50_Cross_field.json"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO79-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Use <code class="literal">cross_fields</code> term-centric matching.
</p></td></tr></table></div><p>It solves the term-frequency problem by <span class="emphasis"><em>blending</em></span> inverse document
frequencies across fields: <a id="id-1.5.5.14.17.2" class="indexterm"></a>
<a id="id-1.5.5.14.17.3" class="indexterm"></a><a id="id-1.5.5.14.17.4" class="indexterm"></a>
<a id="id-1.5.5.14.17.5" class="indexterm"></a></p><pre class="literallayout">+blended("peter", fields: [first_name, last_name])
+blended("smith", fields: [first_name, last_name])</pre><p>In other words, it looks up the IDF of <code class="literal">smith</code> in both the <code class="literal">first_name</code> and
the <code class="literal">last_name</code> fields and uses the minimum of the two as the IDF for both
fields.  The fact that <code class="literal">smith</code> is a common last name means that it will be
treated as a common first name too.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>For the <code class="literal">cross_fields</code> query type to work optimally, all fields should have
the same analyzer.<a id="id-1.5.5.14.20.1.2" class="indexterm"></a>
<a id="id-1.5.5.14.20.1.3" class="indexterm"></a><a id="id-1.5.5.14.20.1.4" class="indexterm"></a>
<a id="id-1.5.5.14.20.1.5" class="indexterm"></a>  Fields that share an analyzer are grouped together as
blended fields.</p><p>If you include fields with a different analysis chain, they will be  added to
the query in the same way as for <code class="literal">best_fields</code>.  For instance, if we added the
<code class="literal">title</code> field to the preceding query (assuming it uses a different analyzer), the
explanation would be as follows:</p><pre class="literallayout">(+title:peter +title:smith)
(
  +blended("peter", fields: [first_name, last_name])
  +blended("smith", fields: [first_name, last_name])
)</pre><p>This is particularly important when using the <code class="literal">minimum_should_match</code> and
<code class="literal">operator</code> parameters.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_per_field_boosting"></a>Per-Field Boosting</h3></div></div></div><p>One of the advantages of using the <code class="literal">cross_fields</code> query over
<a class="link" href="multi-field-search.html#custom-all" title="Custom _all Fields">custom <code class="literal">_all</code> fields</a> is that you <a id="id-1.5.5.14.21.2.3" class="indexterm"></a>
<a id="id-1.5.5.14.21.2.4" class="indexterm"></a><a id="id-1.5.5.14.21.2.5" class="indexterm"></a>
<a id="id-1.5.5.14.21.2.6" class="indexterm"></a>can boost individual
fields at query time.</p><p>For fields of equal value like <code class="literal">first_name</code> and <code class="literal">last_name</code>, this generally
isn’t required, but if you were searching for books using the <code class="literal">title</code> and
<code class="literal">description</code> fields, you might want to give more weight to the <code class="literal">title</code> field.
This can be done as described before with the caret (<code class="literal">^</code>) syntax:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">GET /books/_search
{
    "query": {
        "multi_match": {
            "query":       "peter smith",
            "type":        "cross_fields",
            "fields":      [ "title^2", "description" ] <a id="CO80-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO80-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">title</code> field has a boost of <code class="literal">2</code>, while the <code class="literal">description</code> field
    has the default boost of <code class="literal">1</code>.
</p></td></tr></table></div><p>The advantage of being able to boost individual fields should be weighed
against the cost of querying multiple fields instead of querying a single
custom <code class="literal">_all</code> field. Use whichever of the two solutions that delivers the most
bang for your buck.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_exact_value_fields"></a>Exact-Value Fields</h2></div></div></div><p>The final topic that we should touch on before leaving multifield queries is
that of exact-value <code class="literal">not_analyzed</code> fields. <a id="id-1.5.5.15.2.2" class="indexterm"></a>
<a id="id-1.5.5.15.2.3" class="indexterm"></a><a id="id-1.5.5.15.2.4" class="indexterm"></a>
<a id="id-1.5.5.15.2.5" class="indexterm"></a><a id="id-1.5.5.15.2.6" class="indexterm"></a>
<a id="id-1.5.5.15.2.7" class="indexterm"></a><a id="id-1.5.5.15.2.8" class="indexterm"></a>
<a id="id-1.5.5.15.2.9" class="indexterm"></a> It is not useful to mix
<code class="literal">not_analyzed</code> fields with <code class="literal">analyzed</code> fields in <code class="literal">multi_match</code> queries.</p><p>The reason for this can be demonstrated easily by looking at a query
explanation.  Imagine that we have set the <code class="literal">title</code> field to be <code class="literal">not_analyzed</code>:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">GET /_validate/query?explain
{
    "query": {
        "multi_match": {
            "query":       "peter smith",
            "type":        "cross_fields",
            "fields":      [ "title", "first_name", "last_name" ]
        }
    }
}</pre></div><div class="sense_widget" data-snippet="snippets/110_Multi_Field_Search/55_Not_analyzed.json"></div><p>Because the <code class="literal">title</code> field is not analyzed, it searches that field for a single
term consisting of the whole query string!</p><pre class="literallayout">title:peter smith
(
    blended("peter", fields: [first_name, last_name])
    blended("smith", fields: [first_name, last_name])
)</pre><p>That term clearly does not exist in the inverted index of the <code class="literal">title</code> field,
and can never be found. Avoid using <code class="literal">not_analyzed</code> fields in <code class="literal">multi_match</code>
queries.</p></div></div><div class="navfooter"><span class="prev"><a href="full-text-search.html">
              « 
              Full-Text Search</a>
           
        </span><span class="next">
           
          <a href="proximity-matching.html">Proximity Matching
               »
            </a></span></div>
<!-- end body -->

            </section>

            <div id="rtpcontainer"
        >
	<h3>Top Videos</h3>
	<ul class="lists">
		<li><a href="https://www.elastic.co/webinars/get-started-with-elasticsearch/?baymax=default&elektra=docs&storm=top-video">Getting Started</a></li>
		<li><a href="http://www.elastic.co/webinars/elasticsearch-performance-optimization-tale-two-tickets/?elektra=docs">Scaling</a></li>
		<li><a href="http://www.elastic.co/webinars/shield-securing-your-data-in-elasticsearch/?elektra=docs">Security</a></li>
	</ul>
</div>


	  	




<script src="//app-lon02.marketo.com/js/forms2/js/forms2.min.js"></script>
	<!-- subscribe-newsletter -->
	<div id="subscribe-newsletter">
		<div class="container">
			<div class="row">
				<div class="12u">
					<div class="subscribe-wrapper" id="rtp-newsletter">
						<header>
							<h3>Subscribe to our newsletter</h3>
						</header>
						<div class="subscribe-form">
							<form id="mktoForm_1398" class="container"></form>
							<div class="form_thanks hide">
								
									<p>Thanks for subscribing! We'll keep you updated with new releases.</p>
								
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

  	<!-- Footer -->
	<div id="footer-wrapper">
		<section id="footer" class="container">
			<div class="row">
				<div class="12u">
					<!-- Copyright -->
					<div id="copyright">
	<p>
		© 2016. All Rights Reserved - Elasticsearch
	</p>
	<ul class="links">
		<li>Elasticsearch is a trademark of Elasticsearch BV, registered in the U.S. and in other countries</li>
		<li><a href="/legal/trademarks" id="footer_trademarks">Trademarks</a></li>
		<li><a href="/legal/terms-of-use" id="footer_terms">Terms</a></li>
		<li><a href="/legal/privacy-policy" id="footer_privacy">Privacy</a></li>
	</ul>
	<p>
		Apache, Apache Lucene, Apache Hadoop, Hadoop, HDFS and the yellow elephant logo are trademarks of the <a href="http://www.apache.org/" target="_blank">Apache Software Foundation</a> in the United States and/or other&nbsp;countries.
	</p>
</div><!--<div class="row">
{replace4}
</div>-->
				</div>
			</div>					
		</section>
	</div>
			
	<!-- Social Media -->
	<div id="socialmedia-wrapper">
		<section id="socialmedia" class="container">
			<!-- social icons -->
			<div id="social">
				<ul class="links">
					
						<li class="facebook grayscale"><a href="http://www.facebook.com/elastic.co" target="_blank" id="footer_facebook"></a></li>
					
						<li class="twitter grayscale"><a href="https://www.twitter.com/elastic" target="_blank" id="footer_twitter"></a></li>
					
						<li class="linkedin grayscale"><a href="https://www.linkedin.com/company/elastic-co" target="_blank" id="footer_linkedin"></a></li>
					
						<li class="xing grayscale"><a href="https://www.xing.com/companies/elastic.co" target="_blank" id="footer_xing"></a></li>
					
						<li class="youtube grayscale"><a href="https://www.youtube.com/user/elasticsearch" target="_blank" id="footer_youtube"></a></li>
					
				</ul>
			</div>
		</section>
	</div>


<style type="text/css">
	
		.facebook{background:url("https://static-www.elastic.co/assets/bltda40eebd7c7cae9a/facebook.svg?q=100") no-repeat;}		
	
		.twitter{background:url("https://static-www.elastic.co/assets/bltfd3b1511512f4632/twitter.svg?q=100") no-repeat;}		
	
		.linkedin{background:url("https://static-www.elastic.co/assets/blt6b4f6f8d6b96f814/linkedin.svg?q=100") no-repeat;}		
	
		.xing{background:url("https://static-www.elastic.co/assets/blta76b2ae2b2f10a98/xing.svg?q=100") no-repeat;}		
	
		.youtube{background:url("https://static-www.elastic.co/assets/blt5761648c9581fb53/youtube.svg?q=100") no-repeat;}		
	
</style>

<script>
MktoForms2.loadForm("//app-lon02.marketo.com", "813-MAM-392", 1398,function(form){
	form.onSuccess(function(form){
		$('#mktoForm_1398').css('display','none');
		$('#subscribe-newsletter header').hide();
		$('#mktoForm_1398').siblings('.form_thanks').removeClass('hide')
		dataLayer.push({'event': 'mktoFormSubmit'});
	    return false;
  	});
});
</script>	

  	</div>
  	<!-- <div class="preloader">
    	<div class="status"></div>
	</div> -->
  	<style></style>
   	<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";	
</script>
<script src="https://static-www.elastic.co/static/js/jquery.autocomplete.js?q=100"></script>
<script src="https://static-www.elastic.co/static/js/script.js?q=100"></script>


   	
   	
   	
   	<script type="application/ld+json">
	
		
	
	{
	  	"@context": "http://schema.org",
	  	"@type": "Organization",
	  	"name" : "Elastic",
	  	"url": "https://www.elastic.co/",
	  	"logo": "https://www.elastic.co/static/img/elastic-logo-200.png",
		"sameAs" : [ "https://www.facebook.com/elastic.co",
			"https://twitter.com/elastic",
			"https://plus.google.com/105178019064686397293",
			"https://www.youtube.com/user/elasticsearch",
			"https://www.linkedin.com/company/elasticsearch"
		],
	  	"potentialAction": {
	    	"@type": "SearchAction",
	    	"target": "https://www.elastic.co/search?q={query_string}",
	    	"query-input": "required name=query_string"
	  	}
	}
</script>	

            <script type="text/javascript" src="docs.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script type='text/javascript' src='https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js'></script>

            </body>
        

