
<!DOCTYPE HTML>
<html lang="en-us">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Controlling Relevance</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch: The Definitive Guide" /><link rel="up" href="search-in-depth.html" title="Search in Depth" /><link rel="prev" href="partial-matching.html" title="Partial Matching" /><link rel="next" href="languages.html" title="인간의 언어를 다루어보자" />
  
 	<meta http-equiv="content-type" content="text/html; charset=utf-8" />

 	<!-- RTP tag --> 
	<script type='text/javascript' async>
	(function(c,h,a,f,i,e){c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
	 c[a].a=i;c[a].e=e;var g=h.createElement("script");g.async=true;g.type="text/javascript";
	 g.src=f+'?aid='+i;var b=h.getElementsByTagName("script")[0];b.parentNode.insertBefore(g,b);
	 })(window,document,"rtp","//sjrtp2-cdn.marketo.com/rtp-api/v1/rtp.js","elasticco");
	 
	rtp('send','view');
	rtp('get', 'campaign',true);
	</script>
	<!-- End of RTP tag -->
	
	
 	<link rel="apple-touch-icon" sizes="57x57"  href="https://www.elastic.co/apple-icon-57x57.png?change=123">
<link rel="apple-touch-icon" sizes="60x60"  href="https://www.elastic.co/apple-icon-60x60.png?change=123">
<link rel="apple-touch-icon" sizes="72x72"  href="https://www.elastic.co/apple-icon-72x72.png?change=123">
<link rel="apple-touch-icon" sizes="76x76"  href="https://www.elastic.co/apple-icon-76x76.png?change=123">
<link rel="apple-touch-icon" sizes="114x114"  href="https://www.elastic.co/apple-icon-114x114.png?change=123">
<link rel="apple-touch-icon" sizes="120x120"  href="https://www.elastic.co/apple-icon-120x120.png?change=123">
<link rel="apple-touch-icon" sizes="144x144"  href="https://www.elastic.co/apple-icon-144x144.png?change=123">
<link rel="apple-touch-icon" sizes="152x152"  href="https://www.elastic.co/apple-icon-152x152.png?change=123">
<link rel="apple-touch-icon" sizes="180x180"  href="https://www.elastic.co/apple-icon-180x180.png?change=123">
<link rel="icon" type="image/png" sizes="192x192"   href="https://www.elastic.co/android-icon-192x192.png?change=123">
<link rel="icon" type="image/png" sizes="32x32"  href="https://www.elastic.co/favicon-32x32.png?change=123">
<link rel="icon" type="image/png" sizes="96x96"  href="https://www.elastic.co/favicon-96x96.png?change=123">
<link rel="icon" type="image/png" sizes="16x16"  href="https://www.elastic.co/favicon-16x16.png?change=123">
<link rel="manifest"  href="https://www.elastic.co/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">

<!-- DC tags section -->
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" >
<link rel="schema.DCTERMS" href="http://purl.org/dc/terms/" >
<meta name="DC.title" content="Guide template" >

<!-- end DC tags -->

	<meta name="description" content="" />

	<link rel="canonical" href="" />

	<meta property="og:image" content="https://www.elastic.co/static/img/elastic-logo-200.png" />
	


	
	<link type="text/css" rel="stylesheet" href="https://static-www.elastic.co/static/css/skel.css?q=100" />
	<link type="text/css" rel="stylesheet" href="https://static-www.elastic.co/static/css/style.css?q=100" />	
	<script src="https://static-www.elastic.co/static/js/skel.min.js?q=100"></script>
	
		<script type="text/javascript">form_name = "" ; cdn_url="https://static-www.elastic.co";cdn_slug = "100"</script>
	
	<script src="https://static-www.elastic.co/static/js/init.js?q=100"></script>
	<script src="https://static-www.elastic.co/static/js/jquery.min.js?q=100"></script>
	<script src="https://static-www.elastic.co/static/js/jquery.cookie.js?q=100"></script>
	<!--<script type="text/javascript">
	    (function() {
	        var path = '//easy.myfonts.net/v2/js?sid=10336(font-family=Avenir+35+Light)&sid=10338(font-family=Avenir+55+Roman)&sid=10340(font-family=Avenir+85+Heavy)&sid=10344(font-family=Avenir+65+Medium)&key=nAD6PCOPrX',
	            protocol = ('https:' == document.location.protocol ? 'https:' : 'http:'),
	            trial = document.createElement('script');
	        trial.type = 'text/javascript';
	        trial.async = true;
	        trial.src = protocol + path;
	        var head = document.getElementsByTagName("head")[0];
	        head.appendChild(trial);
	    })();
	</script>-->

	
	<link type="text/css" rel="stylesheet"  href="https://www.elastic.co/static/css/prettify.css" />
	<script type="text/javascript"  src="https://www.elastic.co/static/js/prettify.js"></script>



<link rel="stylesheet" type="text/css" href="styles.css" />

</head>
<body >
	<!-- Google Tag Manager -->
	<script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5"
													  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-58RLH5');</script>
	<!-- End Google Tag Manager -->
	
	<div class="header-cont">
		<div id="header-wrapper">
			


	<script  src="https://www.elastic.co/static/js/jquery.tokeninput.js?change=123"></script>
	<link rel="stylesheet" type="text/css"  href="https://www.elastic.co/static/css/token-input.css">

<div class="shortcuts-wrapper">
	<div class="container">
		<!-- Shortcuts -->
		<nav id="shortcuts">
			<ul class="links">
				
					<li class="shortcut-1">
						<a href="/downloads" id="header_downloads" >
							<span class="txt">downloads</span>	
						</a>
					</li>
				
					<li class="shortcut-2">
						<a href="/guide" id="header_guide" >
							<span class="txt">docs</span>	
						</a>
					</li>
				
					<li class="shortcut-3">
						<a href="/subscriptions" id="header_subscriptions" >
							<span class="txt">support</span>	
						</a>
					</li>
				
					<li class="shortcut-4">
						<a href="https://discuss.elastic.co" id="header_discuss" target="_blank">
							<span class="txt">discuss</span>	
						</a>
					</li>
				
					<li class="shortcut-5">
						<a href="/contact" id="header_contact" >
							<span class="txt">contact</span>	
						</a>
					</li>
				
			</ul>
		</nav>
		<div class="languages-wrapper">
			<div class="global-language">
				<ul class="language">
					<!-- <li class="active-language"><a class="active" href="#">EN</a></li> -->
					
						<li><a href="#">EN</a></li>
					
				</ul>
				<ul class="all-languages">
					
						
						<li><a href="/guide_template">English</a></li>
					
						
						<li><a href="/fr/guide_template">French</a></li>
					
						
						<li><a href="/de/guide_template">German</a></li>
					
						
						<li><a href="/jp/guide_template">Japanese</a></li>
					
						
						<li><a href="/kr/guide_template">Korean</a></li>
					
				</ul>
			</div>
		</div>
	</div>
</div>
<div class="container w100">
	<div class="row 0%">
		<div class="12u">
			

<section class="first-container desktop-main-nav">
	<div class="row 0%">
		<div class="11u 6u(small) 6u(xsmall)">
			<div id="elastic">
				<h1>
					<a href="/">
						<div id="elastic-logo">
						<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 400 130" preserveAspectRatio="xMinYMin meet" enable-background="new 0 0 400 130" xml:space="preserve">
    <g>
    	<g>
    		<path fill="#FFFFFF" d="M122.5,67.8c0-10.3-6.4-19.2-15.9-22.7c0.4-2.2,0.6-4.3,0.6-6.6c0-19.1-15.5-34.6-34.6-34.6
    			c-11.1,0-21.5,5.3-28,14.4c-3.2-2.5-7.1-3.8-11.2-3.8c-10.1,0-18.4,8.2-18.4,18.4c0,2.2,0.4,4.4,1.1,6.4C6.5,42.6,0,51.8,0,62
    			c0,10.3,6.4,19.3,16,22.8c-0.4,2.1-0.6,4.3-0.6,6.6c0,19,15.5,34.5,34.5,34.5c11.2,0,21.5-5.4,28-14.4c3.2,2.5,7.2,3.9,11.3,3.9
    			c10.1,0,18.4-8.2,18.4-18.4c0-2.2-0.4-4.4-1.1-6.4C115.9,87.2,122.5,78,122.5,67.8z"/>
    		<g>
    			<path fill="#F4BD19" d="M47.9,56.3l27.3,12.5l27.6-24.2c0.4-2,0.6-4,0.6-6.1c0-17-13.8-30.8-30.8-30.8c-10.2,0-19.7,5-25.4,13.4
    				l-4.6,23.8L47.9,56.3z"/>
    		</g>
    		<g>
    			<path fill="#3CBEB1" d="M19.6,85.2c-0.4,2-0.6,4.1-0.6,6.2c0,17,13.9,30.9,30.9,30.9c10.3,0,19.8-5.1,25.6-13.5L80,85l-6.1-11.6
    				L46.5,60.9L19.6,85.2z"/>
    		</g>
    		<g>
    			<path fill="#E9478C" d="M19.4,37.9l18.7,4.4L42.3,21c-2.6-2-5.7-3-9-3c-8.1,0-14.8,6.6-14.8,14.8C18.5,34.5,18.8,36.3,19.4,37.9z
    				"/>
    		</g>
    		<g>
    			<path fill="#2C458F" d="M17.8,42.4C9.4,45.1,3.6,53.2,3.6,62c0,8.6,5.3,16.3,13.3,19.3l26.3-23.8l-4.8-10.3L17.8,42.4z"/>
    		</g>
    		<g>
    			<path fill="#95C63D" d="M80.3,108.7c2.6,2,5.7,3.1,8.9,3.1c8.1,0,14.8-6.6,14.8-14.8c0-1.8-0.3-3.5-0.9-5.1l-18.7-4.4L80.3,108.7
    				z"/>
    		</g>
    		<g>
    			<path fill="#176655" d="M84.1,82.6l20.6,4.8c8.4-2.8,14.2-10.8,14.2-19.6c0-8.6-5.3-16.2-13.3-19.3l-27,23.6L84.1,82.6z"/>
    		</g>
    	</g>
    	<path d="M162.8,76.3c0,0.1,0,0.6,0.1,1.4c0.1,0.8,0.3,1.8,0.6,3c0.3,1.1,0.8,2.4,1.4,3.7c0.6,1.3,1.4,2.5,2.5,3.6
    		c1,1.1,2.3,2,3.8,2.7c1.5,0.7,3.4,1.1,5.6,1.1c1.8,0,3.3-0.1,4.6-0.4c1.3-0.3,2.4-0.7,3.4-1.3c1-0.6,1.9-1.3,2.7-2.2
    		c0.8-0.9,1.6-1.9,2.4-3.1c0.5-0.7,1-1.2,1.6-1.5c0.6-0.3,1.2-0.4,1.8-0.4c1,0,2,0.4,2.8,1.1c0.9,0.7,1.3,1.7,1.3,2.8
    		c0,0.7-0.4,1.7-1.1,3.1c-0.7,1.4-1.9,2.8-3.6,4.1c-1.6,1.4-3.7,2.6-6.3,3.6c-2.6,1-5.7,1.5-9.5,1.5c-3.8,0-7.2-0.7-10.2-2.1
    		c-3-1.4-5.5-3.2-7.5-5.6c-2-2.3-3.6-5-4.7-8.1c-1.1-3.1-1.6-6.3-1.6-9.7c0-3.5,0.5-6.8,1.6-9.9c1.1-3.1,2.7-5.8,4.7-8.1
    		c2-2.3,4.5-4.1,7.4-5.5c2.9-1.3,6.1-2,9.6-2c3.3,0,6.3,0.5,9.2,1.5c2.8,1,5.3,2.4,7.4,4.3c2.1,1.9,3.7,4.1,5,6.8
    		c1.2,2.7,1.8,5.8,1.8,9.2c0,2.1-0.5,3.7-1.6,4.8c-1,1.1-2.2,1.6-3.6,1.6H162.8z M170.9,56.4c-1.5,0.6-2.7,1.4-3.7,2.4
    		c-1,0.9-1.8,2-2.4,3.1c-0.6,1.1-1,2.2-1.3,3.2c-0.3,1-0.5,1.8-0.5,2.5c-0.1,0.7-0.1,1.1-0.1,1.2h27.9c0-1.8-0.3-3.5-0.9-5.1
    		c-0.6-1.6-1.5-3-2.6-4.3c-1.2-1.2-2.7-2.2-4.5-3c-1.8-0.7-4-1.1-6.5-1.1C174.2,55.5,172.4,55.8,170.9,56.4z"/>
    	<path d="M214.3,94.6c0,1.3-0.4,2.3-1.3,3.2c-0.9,0.9-1.9,1.3-3.2,1.3c-1.3,0-2.3-0.4-3.2-1.3c-0.9-0.9-1.3-2-1.3-3.2V35.1
    		c0-1.3,0.4-2.3,1.3-3.2c0.9-0.9,2-1.3,3.2-1.3c1.3,0,2.3,0.4,3.2,1.3c0.9,0.9,1.3,1.9,1.3,3.2V94.6z"/>
    	<path d="M229.8,63.5c-0.6,0.3-1.2,0.5-1.9,0.5c-1.2,0-2.2-0.4-3.2-1.1c-1-0.7-1.5-1.8-1.5-3.1c0-0.5,0.1-1.1,0.4-1.9
    		c0.5-1.2,1.2-2.4,2.1-3.6c0.9-1.2,2-2.2,3.5-3.1s3.3-1.7,5.4-2.2c2.2-0.5,4.8-0.8,7.9-0.8c5.9,0,10.5,1.2,14,3.5
    		c3.5,2.3,5.2,5.8,5.2,10.3v32.8c0,1.3-0.4,2.3-1.3,3.2c-0.9,0.9-1.9,1.3-3.2,1.3c-1.3,0-2.3-0.4-3.2-1.3c-0.9-0.9-1.3-2-1.3-3.2v-2
    		c-1.2,2-4.7,4.5-7.5,5.3c-2.8,0.8-5.7,1.2-8.8,1.2c-2,0-3.9-0.3-5.9-0.8c-2-0.5-3.8-1.4-5.3-2.5c-1.6-1.1-2.9-2.6-3.8-4.3
    		c-1-1.7-1.5-3.8-1.5-6.2c0-2.8,0.5-5.7,1.6-7.5c1.1-1.9,2.6-3.4,4.4-4.6c1.8-1.2,3.9-2.1,6.3-2.8c2.4-0.6,4.9-1.1,7.5-1.4
    		c3-0.3,5.4-0.7,7.2-1.2c1.7-0.4,3-0.9,3.9-1.5c0.9-0.6,1.4-1.2,1.6-2c0.2-0.7,0.3-1.6,0.3-2.5c0-1.1-0.3-2-0.9-2.8
    		c-0.6-0.8-1.4-1.5-2.4-2c-1-0.5-2.1-0.9-3.3-1.2s-2.4-0.4-3.5-0.4c-2.1,0-3.7,0.2-5,0.5c-1.3,0.3-2.3,0.8-3.1,1.4
    		c-0.8,0.6-1.5,1.3-1.9,2.1c-0.5,0.8-0.9,1.6-1.3,2.5C230.9,62.6,230.4,63.1,229.8,63.5z M250.6,74.4c-1.1,0.3-2.4,0.6-3.8,0.8
    		c-1.5,0.2-3,0.4-4.6,0.6c-1.6,0.2-3.1,0.5-4.6,0.9c-1.5,0.3-2.8,0.8-4,1.5c-1.2,0.7-2.2,1.5-2.9,2.5c-0.7,1-1.1,3-1.1,4.6
    		c0,1.3,0.3,2.3,0.8,3.1c0.5,0.8,1.2,1.5,2.1,2c0.9,0.5,1.8,0.8,2.9,1c1.1,0.2,2.2,0.3,3.3,0.3c1.7,0,3.3-0.2,5-0.6
    		c1.7-0.4,3.2-1,4.5-1.9s2.4-2,3.3-3.5c0.8-1.4,1.2-3.8,1.2-5.9v-6.1L250.6,74.4z"/>
    	<path d="M307.6,90.9c-1.1,2-2.7,3.6-4.6,4.8s-4.1,2.1-6.6,2.7c-2.5,0.5-5.2,0.8-7.9,0.8c-3.9,0-7.2-0.6-9.9-1.8
    		c-2.7-1.2-4.9-2.6-6.5-4.1c-1.7-1.6-2.9-3.1-3.7-4.7c-0.7-1.6-1.1-2.7-1.1-3.5c0-1.3,0.5-2.4,1.4-3.2c0.9-0.8,2-1.2,3.1-1.2
    		c0.7,0,1.3,0.2,2,0.6c0.6,0.4,1.1,1,1.5,1.9c1,2.5,2.5,4.5,4.7,6.2c2.2,1.7,5.2,2.5,9.3,2.5c1.8,0,3.4-0.2,4.7-0.6
    		c1.3-0.4,2.4-1,3.2-1.7c0.8-0.7,1.4-1.5,1.9-2.4c0.4-0.9,0.6-1.8,0.6-2.8c0-2-0.8-3.4-2.3-4.4c-1.5-1-3.5-1.7-5.8-2.3
    		c-2.3-0.6-4.8-1.1-7.5-1.6c-2.7-0.5-5.2-1.2-7.5-2.2c-2.3-0.9-4.2-2.3-5.8-4c-1.6-1.8-2.3-4.2-2.3-7.3c0-4.5,1.6-8,4.9-10.5
    		c3.3-2.5,7.8-3.8,13.7-3.8c3.3,0,6,0.3,8.3,1c2.2,0.7,4.1,1.6,5.5,2.7c0.6,0.5,1.2,1,1.8,1.7c0.6,0.7,1.2,1.4,1.8,2.2
    		c0.6,0.8,1,1.5,1.4,2.3c0.4,0.7,0.6,1.4,0.6,2c0,1.3-0.5,2.4-1.6,3.1c-1,0.8-2.2,1.2-3.4,1.2c-0.7,0-1.5-0.1-2.1-0.6
    		c-0.6-0.6-1-1.3-1.3-1.8c-0.5-1.1-1.1-2-1.7-2.8c-0.5-0.8-1.2-1.5-2-2c-0.8-0.5-1.8-0.9-3-1.2c-1.2-0.3-2.7-0.4-4.4-0.4
    		c-3.5,0-6,0.6-7.6,1.7c-1.6,1.1-2.4,2.5-2.4,4.2c0,1.3,0.5,2.3,1.4,3.1c0.9,0.8,2.1,1.4,3.7,2c1.5,0.5,3.3,1,5.2,1.4
    		c2,0.4,3.9,0.8,5.9,1.3c2,0.5,4,1.1,5.9,1.7c1.9,0.7,3.7,1.6,5.2,2.7c1.5,1.1,2.7,2.5,3.7,4.1c0.9,1.6,1.4,3.6,1.4,6
    		C309.4,86.4,308.8,88.9,307.6,90.9z"/>
    	<path d="M327.4,48.8h4.7c1.1,0,2,0.4,2.8,1.2c0.8,0.8,1.2,1.7,1.2,2.8c0,1.1-0.4,2.1-1.2,2.8s-1.7,1.1-2.8,1.1h-4.7v37.9
    		c0,1.3-0.4,2.3-1.3,3.2c-0.9,0.9-2,1.3-3.2,1.3c-1.3,0-2.3-0.4-3.2-1.3c-0.9-0.9-1.3-2-1.3-3.2V56.7h-4.6c-1.1,0-2-0.4-2.8-1.1
    		c-0.8-0.7-1.2-1.7-1.2-2.8c0-1.1,0.4-2,1.2-2.8c0.8-0.8,1.7-1.2,2.8-1.2h4.6V39c0-1.3,0.4-2.3,1.3-3.2s1.9-1.3,3.2-1.3
    		c1.3,0,2.3,0.4,3.2,1.3s1.3,1.9,1.3,3.2V48.8z"/>
    	<path d="M341.5,32.1c1-1,2.2-1.5,3.7-1.5c1.4,0,2.6,0.5,3.6,1.5c1,1,1.5,2.2,1.5,3.6c0,1.4-0.5,2.6-1.5,3.6c-1,1-2.2,1.5-3.6,1.5
    		c-1.4,0-2.7-0.5-3.7-1.5c-1-1-1.5-2.2-1.5-3.6C340,34.2,340.5,33,341.5,32.1z M349.6,94.6c0,1.3-0.4,2.3-1.3,3.2
    		c-0.9,0.9-1.9,1.3-3.2,1.3c-1.3,0-2.3-0.4-3.2-1.3c-0.9-0.9-1.3-2-1.3-3.2V53.3c0-1.3,0.4-2.3,1.3-3.2c0.9-0.9,2-1.3,3.2-1.3
    		c1.3,0,2.3,0.4,3.2,1.3c0.9,0.9,1.3,2,1.3,3.2V94.6z"/>
    	<path d="M369.1,97.3c-2.9-1.2-5.4-3-7.5-5.2c-2.1-2.2-3.8-4.9-5-8.1c-1.2-3.1-1.8-6.6-1.8-10.4c0-3.8,0.6-7.3,1.8-10.5
    		c1.2-3.1,2.9-5.8,5-8.1c2.1-2.2,4.6-4,7.5-5.2c2.9-1.2,6-1.9,9.4-1.9c3.4,0,6.4,0.5,9,1.5c2.5,1,4.6,2.2,6.2,3.6
    		c1.6,1.4,3.2,2.9,4,4.4c0.5,0.9,0.9,1.5,0.9,2.6c0,1.3-0.5,2.3-1.4,3.1c-0.9,0.7-2,1.1-3.1,1.1c-0.8,0-1.6-0.2-2.2-0.6
    		c-0.7-0.4-1.2-1.3-1.8-2.1c-1-1.4-0.5-0.6-1.1-1.5c-0.7-0.9-1.5-1.6-2.5-2.3c-1-0.7-2.2-1.2-3.5-1.6c-1.4-0.4-2.8-0.6-4.4-0.6
    		c-1.8,0-3.5,0.3-5.3,1c-1.8,0.7-3.3,1.7-4.7,3.1c-1.4,1.4-2.5,3.3-3.4,5.6s-1.3,5.1-1.3,8.4c0,3.3,0.4,6.1,1.3,8.4s2,4.2,3.4,5.6
    		c1.4,1.4,3,2.5,4.7,3.1c1.8,0.7,3.5,1,5.3,1c1.6,0,3.1-0.2,4.4-0.6c1.3-0.4,2.5-0.9,3.5-1.6c1-0.7,1.8-1.5,2.5-2.3
    		c0.7-0.9,1.1-1.8,1.4-2.7c0.3-1,0.8-1.7,1.5-2.1c0.7-0.4,1.4-0.6,2.2-0.6c1.1,0,2.2,0.4,3.1,1.1c0.9,0.7,1.4,1.7,1.4,3
    		c0,0.6-0.3,1.7-0.9,3.1c-0.6,1.5-1.6,2.9-3.1,4.4c-1.5,1.5-3.5,2.8-6.2,4c-2.6,1.1-6,1.7-10,1.7C375.1,99.2,372,98.5,369.1,97.3z"
    		/>
    </g>
</svg>
						</div>
					</a>
				</h1>
			</div>
			<nav id="nav">
				<ul>
					
					<li>
						
							
						
						<a href="/products" id="nav_products"   >Products</a>
						
						<ul class="dropdown">
							
								<li><a href="/products/elasticsearch" id="nav_elasticsearch" >elasticsearch</a></li>								
							
								<li><a href="/found" id="nav_hosted-elasticsearch" >elasticsearch as a service</a></li>								
							
								<li><a href="/products/logstash" id="nav_logstash" >logstash</a></li>								
							
								<li><a href="/products/kibana" id="nav_kibana" >kibana</a></li>								
							
								<li><a href="/products/beats" id="nav_beats" >beats</a></li>								
							
								<li><a href="/products/watcher" id="nav_watcher" >watcher</a></li>								
							
								<li><a href="/products/shield" id="nav_shield" >shield</a></li>								
							
								<li><a href="/products/marvel" id="nav_marvel" >marvel</a></li>								
							
								<li><a href="/products/hadoop" id="nav_hadoop" >hadoop</a></li>								
							
								<li><a href="/downloads" id="nav_downloads" >downloads</a></li>								
								
						</ul>							
					</li>
					
					<li>
						
							
						
						<a href="/subscriptions" id="nav_subscriptions"   >Subscriptions</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						
							
						
						<a href="/learn" id="nav_learn"   >Learn</a>
						
						<ul class="dropdown">
							
								<li><a href="/guide" id="nav_guide" >docs</a></li>								
							
								<li><a href="/videos" id="nav_videos" >videos</a></li>								
							
								<li><a href="/training" id="nav_training" >training</a></li>								
							
								<li><a href="/services" id="nav_services" >services</a></li>								
							
								<li><a href="/blog" id="nav_learn_blog" >blog</a></li>								
							
								<li><a href="/elasticon" id="nav_learn_elasticon" >elastic{ON}</a></li>								
								
						</ul>							
					</li>
					
					<li>
						
							
						
						<a href="/community" id="nav_community"   >Community</a>
						
						<ul class="dropdown">
							
								<li><a href="/community/meetups" id="nav_meetups" >meetups</a></li>								
							
								<li><a href="https://discuss.elastic.co" id="nav_discuss" target="_blank">discuss</a></li>								
							
								<li><a href="/community/codeofconduct" id="nav_codeofconduct" >code of conduct</a></li>								
								
						</ul>							
					</li>
					
					<li>
						
							
						
						<a href="/use-cases" id="nav_usecases"   >Use Cases</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						
							
						
						<a href="/blog" id="nav_blog"   >Blog</a>
						
						<ul class="dropdown">
							
								<li><a href="/blog/category/news" id="blog_news" >News</a></li>								
							
								<li><a href="/blog/category/engineering" id="blog_engineering" >Engineering</a></li>								
							
								<li><a href="/blog/category/user-stories" id="blog_user-stories" >User Stories</a></li>								
							
								<li><a href="/blog/category/releases" id="blog_releases" >Releases</a></li>								
							
								<li><a href="/blog/archive" id="blog_archive" >Archive</a></li>								
								
						</ul>							
					</li>
					
					<li>
						
							
						
						<a href="/about" id="nav_about"   >About</a>
						
						<ul class="dropdown">
							
								<li><a href="/about/leadership" id="nav_leadership" >leadership</a></li>								
							
								<li><a href="/about/board" id="nav_board" >board of directors</a></li>								
							
								<li><a href="/about/careers" id="nav_careers" >careers</a></li>								
							
								<li><a href="/about/partners" id="nav_partners" >partners</a></li>								
							
								<li><a href="/about/press" id="nav_press" >press</a></li>								
								
						</ul>							
					</li>
					
				</ul>
			</nav>			
			<!-- Searchbar Input box -->
			 <!-- <form method="get" action="/search" name="searchForm" class="header-search-form" id="searchMobileFrm">
			   <input type="text" id="search-header-autocomplete" name="q" class="form-control global-input" placeholder="elastic{search}">
			</form>
			<div class="mobile-auto-complete"></div> -->  
		</div>
		<div class="1u 6u(small) 6u(xsmall)">
			<div id="searchbar">
				<a href="#" class="button icon"></a>
			</div>
			<!-- <div class="nav-auto-complete"></div> -->
		</div>
	</div>
</section>
<div class="mobile-menu-wrapper">
	<div class="row 0%">
		<div class="8u 6u(small) 6u(xsmall)">
			<div id="elastic">
				<h1>
					<a href="/">
						<div id="elastic-logo">
						<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 400 130" preserveAspectRatio="xMinYMin meet" enable-background="new 0 0 400 130" xml:space="preserve">
    <g>
    	<g>
    		<path fill="#FFFFFF" d="M122.5,67.8c0-10.3-6.4-19.2-15.9-22.7c0.4-2.2,0.6-4.3,0.6-6.6c0-19.1-15.5-34.6-34.6-34.6
    			c-11.1,0-21.5,5.3-28,14.4c-3.2-2.5-7.1-3.8-11.2-3.8c-10.1,0-18.4,8.2-18.4,18.4c0,2.2,0.4,4.4,1.1,6.4C6.5,42.6,0,51.8,0,62
    			c0,10.3,6.4,19.3,16,22.8c-0.4,2.1-0.6,4.3-0.6,6.6c0,19,15.5,34.5,34.5,34.5c11.2,0,21.5-5.4,28-14.4c3.2,2.5,7.2,3.9,11.3,3.9
    			c10.1,0,18.4-8.2,18.4-18.4c0-2.2-0.4-4.4-1.1-6.4C115.9,87.2,122.5,78,122.5,67.8z"/>
    		<g>
    			<path fill="#F4BD19" d="M47.9,56.3l27.3,12.5l27.6-24.2c0.4-2,0.6-4,0.6-6.1c0-17-13.8-30.8-30.8-30.8c-10.2,0-19.7,5-25.4,13.4
    				l-4.6,23.8L47.9,56.3z"/>
    		</g>
    		<g>
    			<path fill="#3CBEB1" d="M19.6,85.2c-0.4,2-0.6,4.1-0.6,6.2c0,17,13.9,30.9,30.9,30.9c10.3,0,19.8-5.1,25.6-13.5L80,85l-6.1-11.6
    				L46.5,60.9L19.6,85.2z"/>
    		</g>
    		<g>
    			<path fill="#E9478C" d="M19.4,37.9l18.7,4.4L42.3,21c-2.6-2-5.7-3-9-3c-8.1,0-14.8,6.6-14.8,14.8C18.5,34.5,18.8,36.3,19.4,37.9z
    				"/>
    		</g>
    		<g>
    			<path fill="#2C458F" d="M17.8,42.4C9.4,45.1,3.6,53.2,3.6,62c0,8.6,5.3,16.3,13.3,19.3l26.3-23.8l-4.8-10.3L17.8,42.4z"/>
    		</g>
    		<g>
    			<path fill="#95C63D" d="M80.3,108.7c2.6,2,5.7,3.1,8.9,3.1c8.1,0,14.8-6.6,14.8-14.8c0-1.8-0.3-3.5-0.9-5.1l-18.7-4.4L80.3,108.7
    				z"/>
    		</g>
    		<g>
    			<path fill="#176655" d="M84.1,82.6l20.6,4.8c8.4-2.8,14.2-10.8,14.2-19.6c0-8.6-5.3-16.2-13.3-19.3l-27,23.6L84.1,82.6z"/>
    		</g>
    	</g>
    	<path d="M162.8,76.3c0,0.1,0,0.6,0.1,1.4c0.1,0.8,0.3,1.8,0.6,3c0.3,1.1,0.8,2.4,1.4,3.7c0.6,1.3,1.4,2.5,2.5,3.6
    		c1,1.1,2.3,2,3.8,2.7c1.5,0.7,3.4,1.1,5.6,1.1c1.8,0,3.3-0.1,4.6-0.4c1.3-0.3,2.4-0.7,3.4-1.3c1-0.6,1.9-1.3,2.7-2.2
    		c0.8-0.9,1.6-1.9,2.4-3.1c0.5-0.7,1-1.2,1.6-1.5c0.6-0.3,1.2-0.4,1.8-0.4c1,0,2,0.4,2.8,1.1c0.9,0.7,1.3,1.7,1.3,2.8
    		c0,0.7-0.4,1.7-1.1,3.1c-0.7,1.4-1.9,2.8-3.6,4.1c-1.6,1.4-3.7,2.6-6.3,3.6c-2.6,1-5.7,1.5-9.5,1.5c-3.8,0-7.2-0.7-10.2-2.1
    		c-3-1.4-5.5-3.2-7.5-5.6c-2-2.3-3.6-5-4.7-8.1c-1.1-3.1-1.6-6.3-1.6-9.7c0-3.5,0.5-6.8,1.6-9.9c1.1-3.1,2.7-5.8,4.7-8.1
    		c2-2.3,4.5-4.1,7.4-5.5c2.9-1.3,6.1-2,9.6-2c3.3,0,6.3,0.5,9.2,1.5c2.8,1,5.3,2.4,7.4,4.3c2.1,1.9,3.7,4.1,5,6.8
    		c1.2,2.7,1.8,5.8,1.8,9.2c0,2.1-0.5,3.7-1.6,4.8c-1,1.1-2.2,1.6-3.6,1.6H162.8z M170.9,56.4c-1.5,0.6-2.7,1.4-3.7,2.4
    		c-1,0.9-1.8,2-2.4,3.1c-0.6,1.1-1,2.2-1.3,3.2c-0.3,1-0.5,1.8-0.5,2.5c-0.1,0.7-0.1,1.1-0.1,1.2h27.9c0-1.8-0.3-3.5-0.9-5.1
    		c-0.6-1.6-1.5-3-2.6-4.3c-1.2-1.2-2.7-2.2-4.5-3c-1.8-0.7-4-1.1-6.5-1.1C174.2,55.5,172.4,55.8,170.9,56.4z"/>
    	<path d="M214.3,94.6c0,1.3-0.4,2.3-1.3,3.2c-0.9,0.9-1.9,1.3-3.2,1.3c-1.3,0-2.3-0.4-3.2-1.3c-0.9-0.9-1.3-2-1.3-3.2V35.1
    		c0-1.3,0.4-2.3,1.3-3.2c0.9-0.9,2-1.3,3.2-1.3c1.3,0,2.3,0.4,3.2,1.3c0.9,0.9,1.3,1.9,1.3,3.2V94.6z"/>
    	<path d="M229.8,63.5c-0.6,0.3-1.2,0.5-1.9,0.5c-1.2,0-2.2-0.4-3.2-1.1c-1-0.7-1.5-1.8-1.5-3.1c0-0.5,0.1-1.1,0.4-1.9
    		c0.5-1.2,1.2-2.4,2.1-3.6c0.9-1.2,2-2.2,3.5-3.1s3.3-1.7,5.4-2.2c2.2-0.5,4.8-0.8,7.9-0.8c5.9,0,10.5,1.2,14,3.5
    		c3.5,2.3,5.2,5.8,5.2,10.3v32.8c0,1.3-0.4,2.3-1.3,3.2c-0.9,0.9-1.9,1.3-3.2,1.3c-1.3,0-2.3-0.4-3.2-1.3c-0.9-0.9-1.3-2-1.3-3.2v-2
    		c-1.2,2-4.7,4.5-7.5,5.3c-2.8,0.8-5.7,1.2-8.8,1.2c-2,0-3.9-0.3-5.9-0.8c-2-0.5-3.8-1.4-5.3-2.5c-1.6-1.1-2.9-2.6-3.8-4.3
    		c-1-1.7-1.5-3.8-1.5-6.2c0-2.8,0.5-5.7,1.6-7.5c1.1-1.9,2.6-3.4,4.4-4.6c1.8-1.2,3.9-2.1,6.3-2.8c2.4-0.6,4.9-1.1,7.5-1.4
    		c3-0.3,5.4-0.7,7.2-1.2c1.7-0.4,3-0.9,3.9-1.5c0.9-0.6,1.4-1.2,1.6-2c0.2-0.7,0.3-1.6,0.3-2.5c0-1.1-0.3-2-0.9-2.8
    		c-0.6-0.8-1.4-1.5-2.4-2c-1-0.5-2.1-0.9-3.3-1.2s-2.4-0.4-3.5-0.4c-2.1,0-3.7,0.2-5,0.5c-1.3,0.3-2.3,0.8-3.1,1.4
    		c-0.8,0.6-1.5,1.3-1.9,2.1c-0.5,0.8-0.9,1.6-1.3,2.5C230.9,62.6,230.4,63.1,229.8,63.5z M250.6,74.4c-1.1,0.3-2.4,0.6-3.8,0.8
    		c-1.5,0.2-3,0.4-4.6,0.6c-1.6,0.2-3.1,0.5-4.6,0.9c-1.5,0.3-2.8,0.8-4,1.5c-1.2,0.7-2.2,1.5-2.9,2.5c-0.7,1-1.1,3-1.1,4.6
    		c0,1.3,0.3,2.3,0.8,3.1c0.5,0.8,1.2,1.5,2.1,2c0.9,0.5,1.8,0.8,2.9,1c1.1,0.2,2.2,0.3,3.3,0.3c1.7,0,3.3-0.2,5-0.6
    		c1.7-0.4,3.2-1,4.5-1.9s2.4-2,3.3-3.5c0.8-1.4,1.2-3.8,1.2-5.9v-6.1L250.6,74.4z"/>
    	<path d="M307.6,90.9c-1.1,2-2.7,3.6-4.6,4.8s-4.1,2.1-6.6,2.7c-2.5,0.5-5.2,0.8-7.9,0.8c-3.9,0-7.2-0.6-9.9-1.8
    		c-2.7-1.2-4.9-2.6-6.5-4.1c-1.7-1.6-2.9-3.1-3.7-4.7c-0.7-1.6-1.1-2.7-1.1-3.5c0-1.3,0.5-2.4,1.4-3.2c0.9-0.8,2-1.2,3.1-1.2
    		c0.7,0,1.3,0.2,2,0.6c0.6,0.4,1.1,1,1.5,1.9c1,2.5,2.5,4.5,4.7,6.2c2.2,1.7,5.2,2.5,9.3,2.5c1.8,0,3.4-0.2,4.7-0.6
    		c1.3-0.4,2.4-1,3.2-1.7c0.8-0.7,1.4-1.5,1.9-2.4c0.4-0.9,0.6-1.8,0.6-2.8c0-2-0.8-3.4-2.3-4.4c-1.5-1-3.5-1.7-5.8-2.3
    		c-2.3-0.6-4.8-1.1-7.5-1.6c-2.7-0.5-5.2-1.2-7.5-2.2c-2.3-0.9-4.2-2.3-5.8-4c-1.6-1.8-2.3-4.2-2.3-7.3c0-4.5,1.6-8,4.9-10.5
    		c3.3-2.5,7.8-3.8,13.7-3.8c3.3,0,6,0.3,8.3,1c2.2,0.7,4.1,1.6,5.5,2.7c0.6,0.5,1.2,1,1.8,1.7c0.6,0.7,1.2,1.4,1.8,2.2
    		c0.6,0.8,1,1.5,1.4,2.3c0.4,0.7,0.6,1.4,0.6,2c0,1.3-0.5,2.4-1.6,3.1c-1,0.8-2.2,1.2-3.4,1.2c-0.7,0-1.5-0.1-2.1-0.6
    		c-0.6-0.6-1-1.3-1.3-1.8c-0.5-1.1-1.1-2-1.7-2.8c-0.5-0.8-1.2-1.5-2-2c-0.8-0.5-1.8-0.9-3-1.2c-1.2-0.3-2.7-0.4-4.4-0.4
    		c-3.5,0-6,0.6-7.6,1.7c-1.6,1.1-2.4,2.5-2.4,4.2c0,1.3,0.5,2.3,1.4,3.1c0.9,0.8,2.1,1.4,3.7,2c1.5,0.5,3.3,1,5.2,1.4
    		c2,0.4,3.9,0.8,5.9,1.3c2,0.5,4,1.1,5.9,1.7c1.9,0.7,3.7,1.6,5.2,2.7c1.5,1.1,2.7,2.5,3.7,4.1c0.9,1.6,1.4,3.6,1.4,6
    		C309.4,86.4,308.8,88.9,307.6,90.9z"/>
    	<path d="M327.4,48.8h4.7c1.1,0,2,0.4,2.8,1.2c0.8,0.8,1.2,1.7,1.2,2.8c0,1.1-0.4,2.1-1.2,2.8s-1.7,1.1-2.8,1.1h-4.7v37.9
    		c0,1.3-0.4,2.3-1.3,3.2c-0.9,0.9-2,1.3-3.2,1.3c-1.3,0-2.3-0.4-3.2-1.3c-0.9-0.9-1.3-2-1.3-3.2V56.7h-4.6c-1.1,0-2-0.4-2.8-1.1
    		c-0.8-0.7-1.2-1.7-1.2-2.8c0-1.1,0.4-2,1.2-2.8c0.8-0.8,1.7-1.2,2.8-1.2h4.6V39c0-1.3,0.4-2.3,1.3-3.2s1.9-1.3,3.2-1.3
    		c1.3,0,2.3,0.4,3.2,1.3s1.3,1.9,1.3,3.2V48.8z"/>
    	<path d="M341.5,32.1c1-1,2.2-1.5,3.7-1.5c1.4,0,2.6,0.5,3.6,1.5c1,1,1.5,2.2,1.5,3.6c0,1.4-0.5,2.6-1.5,3.6c-1,1-2.2,1.5-3.6,1.5
    		c-1.4,0-2.7-0.5-3.7-1.5c-1-1-1.5-2.2-1.5-3.6C340,34.2,340.5,33,341.5,32.1z M349.6,94.6c0,1.3-0.4,2.3-1.3,3.2
    		c-0.9,0.9-1.9,1.3-3.2,1.3c-1.3,0-2.3-0.4-3.2-1.3c-0.9-0.9-1.3-2-1.3-3.2V53.3c0-1.3,0.4-2.3,1.3-3.2c0.9-0.9,2-1.3,3.2-1.3
    		c1.3,0,2.3,0.4,3.2,1.3c0.9,0.9,1.3,2,1.3,3.2V94.6z"/>
    	<path d="M369.1,97.3c-2.9-1.2-5.4-3-7.5-5.2c-2.1-2.2-3.8-4.9-5-8.1c-1.2-3.1-1.8-6.6-1.8-10.4c0-3.8,0.6-7.3,1.8-10.5
    		c1.2-3.1,2.9-5.8,5-8.1c2.1-2.2,4.6-4,7.5-5.2c2.9-1.2,6-1.9,9.4-1.9c3.4,0,6.4,0.5,9,1.5c2.5,1,4.6,2.2,6.2,3.6
    		c1.6,1.4,3.2,2.9,4,4.4c0.5,0.9,0.9,1.5,0.9,2.6c0,1.3-0.5,2.3-1.4,3.1c-0.9,0.7-2,1.1-3.1,1.1c-0.8,0-1.6-0.2-2.2-0.6
    		c-0.7-0.4-1.2-1.3-1.8-2.1c-1-1.4-0.5-0.6-1.1-1.5c-0.7-0.9-1.5-1.6-2.5-2.3c-1-0.7-2.2-1.2-3.5-1.6c-1.4-0.4-2.8-0.6-4.4-0.6
    		c-1.8,0-3.5,0.3-5.3,1c-1.8,0.7-3.3,1.7-4.7,3.1c-1.4,1.4-2.5,3.3-3.4,5.6s-1.3,5.1-1.3,8.4c0,3.3,0.4,6.1,1.3,8.4s2,4.2,3.4,5.6
    		c1.4,1.4,3,2.5,4.7,3.1c1.8,0.7,3.5,1,5.3,1c1.6,0,3.1-0.2,4.4-0.6c1.3-0.4,2.5-0.9,3.5-1.6c1-0.7,1.8-1.5,2.5-2.3
    		c0.7-0.9,1.1-1.8,1.4-2.7c0.3-1,0.8-1.7,1.5-2.1c0.7-0.4,1.4-0.6,2.2-0.6c1.1,0,2.2,0.4,3.1,1.1c0.9,0.7,1.4,1.7,1.4,3
    		c0,0.6-0.3,1.7-0.9,3.1c-0.6,1.5-1.6,2.9-3.1,4.4c-1.5,1.5-3.5,2.8-6.2,4c-2.6,1.1-6,1.7-10,1.7C375.1,99.2,372,98.5,369.1,97.3z"
    		/>
    </g>
</svg>
						</div>
					</a>
				</h1>
			</div>
		</div>
		<div class="4u 6u(small) 6u(xsmall) text-right">
			<!-- <div class="mobile-menu-wrapper"> -->
				<ul class="m-shortcuts">
					
					<li><a href="#" class="m-search" id="header-search"></a></li>
					
					<li><a href="/guide" class="m-docs" id="mobile-docs"></a></li>
					
					<li><a href="/contact" class="m-contact" id="mobile-contact"></a></li>
					
				</ul>	
				<nav class="nav-menu">
					<div class="menu-button">
						<span></span>
					</div>
					<div class="nav-menu-list-wrap">
						<div class="nav-menu-list">
							
								<h3><a href="/products" id="nav_products" >Products</a></h3>

								
								<ul>
									
									<li><a href="/products/elasticsearch" id="nav_elasticsearch" >elasticsearch</a></li>
									
									<li><a href="/found" id="nav_hosted-elasticsearch" >elasticsearch as a service</a></li>
									
									<li><a href="/products/logstash" id="nav_logstash" >logstash</a></li>
									
									<li><a href="/products/kibana" id="nav_kibana" >kibana</a></li>
									
									<li><a href="/products/beats" id="nav_beats" >beats</a></li>
									
									<li><a href="/products/watcher" id="nav_watcher" >watcher</a></li>
									
									<li><a href="/products/shield" id="nav_shield" >shield</a></li>
									
									<li><a href="/products/marvel" id="nav_marvel" >marvel</a></li>
									
									<li><a href="/products/hadoop" id="nav_hadoop" >hadoop</a></li>
									
									<li><a href="/downloads" id="nav_downloads" >downloads</a></li>
									
								</ul>
								
							
								<h3><a href="/subscriptions" id="nav_subscriptions" >Subscriptions</a></h3>

								
							
								<h3><a href="/learn" id="nav_learn" >Learn</a></h3>

								
								<ul>
									
									<li><a href="/guide" id="nav_guide" >docs</a></li>
									
									<li><a href="/videos" id="nav_videos" >videos</a></li>
									
									<li><a href="/training" id="nav_training" >training</a></li>
									
									<li><a href="/services" id="nav_services" >services</a></li>
									
									<li><a href="/blog" id="nav_learn_blog" >blog</a></li>
									
									<li><a href="/elasticon" id="nav_learn_elasticon" >elastic{ON}</a></li>
									
								</ul>
								
							
								<h3><a href="/community" id="nav_community" >Community</a></h3>

								
								<ul>
									
									<li><a href="/community/meetups" id="nav_meetups" >meetups</a></li>
									
									<li><a href="/https:/discuss.elastic.co" id="nav_discuss" target="_blank">discuss</a></li>
									
									<li><a href="/community/codeofconduct" id="nav_codeofconduct" >code of conduct</a></li>
									
								</ul>
								
							
								<h3><a href="/use-cases" id="nav_usecases" >Use Cases</a></h3>

								
							
								<h3><a href="/blog" id="nav_blog" >Blog</a></h3>

								
								<ul>
									
									<li><a href="/blog/category/news" id="blog_news" >News</a></li>
									
									<li><a href="/blog/category/engineering" id="blog_engineering" >Engineering</a></li>
									
									<li><a href="/blog/category/user-stories" id="blog_user-stories" >User Stories</a></li>
									
									<li><a href="/blog/category/releases" id="blog_releases" >Releases</a></li>
									
									<li><a href="/blog/archive" id="blog_archive" >Archive</a></li>
									
								</ul>
								
							
								<h3><a href="/about" id="nav_about" >About</a></h3>

								
								<ul>
									
									<li><a href="/about/leadership" id="nav_leadership" >leadership</a></li>
									
									<li><a href="/about/board" id="nav_board" >board of directors</a></li>
									
									<li><a href="/about/careers" id="nav_careers" >careers</a></li>
									
									<li><a href="/about/partners" id="nav_partners" >partners</a></li>
									
									<li><a href="/about/press" id="nav_press" >press</a></li>
									
								</ul>
								
							
						</div>
					</div>
				</nav>
			<!-- </div> -->
		</div>
	</div>
</div>
<!-- Mobile Menu -->


		</div>
	</div>
</div>
<div class="header-search-wrapper">	
	<div class="container">
		<div class="big-search">
			<i class="big-search-icon"></i>
			<form method="get" action="/search" autocomplete="on" name="searchForm" id="searchfrm">
				<ul class="tags-wrapper">
					<li class="search-field"><input type="text" class="form-control global-input" id="autocomplete" name="q"></li>
				</ul>
			</form>
			<a href="#" class="header-search-cancel"></a>
		</div>
		<div class="nav-auto-complete"></div>
	</div>
</div>
<style>	
	
	
		.m-shortcuts li a.m-search {
			background: url("https://static-www.elastic.co/assets/blt174b13be89ff803c/m-search-icon.png?q=100") no-repeat scroll center center rgba(0, 0, 0, 0);
			background-size: contain;}
	
		.m-shortcuts li a.m-docs {
			background: url("https://static-www.elastic.co/assets/blt5ba03f594a7d610a/m-guide-icon.png?q=100") no-repeat scroll center center rgba(0, 0, 0, 0);
			background-size: contain;}
	
		.m-shortcuts li a.m-contact {
			background: url("https://static-www.elastic.co/assets/blt38c3e853c4b1174d/m-contact-icon.png?q=100") no-repeat scroll center center rgba(0, 0, 0, 0);
			background-size: contain;}
		
</style>
		</div>
	</div>
  	<div id="content">
  		
  			
            <div id="pageheader">
    <div class="container">
        <header>
            <h1><a href="/learn" title="Learn">Learn</a> |</h1>
            <h2><a href="/guide" title="Docs">Docs</a></h2>
        </header>
    </div>
</div>
<section id="guide">

            <!-- start body -->
<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch: The Definitive Guide</a></span> » <span class="breadcrumb-link"><a href="search-in-depth.html">Search in Depth </a></span> » <span class="breadcrumb-node">Controlling Relevance</span></div><div class="navheader"><span class="prev"><a href="partial-matching.html">
              « 
              Partial Matching</a>
           
        </span><span class="next">
           
          <a href="languages.html">인간의 언어를 다루어보자 
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="controlling-relevance"></a>Controlling Relevance</h2></div></div></div><p>Databases that deal purely in structured data (such as dates, numbers, and
string enums) have it easy: they<a id="id-1.5.8.2.1" class="indexterm"></a>
<a id="id-1.5.8.2.2" class="indexterm"></a> just have to check whether a document (or a
row, in a relational database) matches the query.</p><p>While Boolean yes/no matches are an essential part of full-text search, they
are not enough by themselves. Instead, we also  need to know how relevant each
document is to the query.  Full-text search engines have to not only find the
matching documents, but also sort them by relevance.</p><p>Full-text relevance <a id="id-1.5.8.4.1" class="indexterm"></a>formulae, or <span class="emphasis"><em>similarity algorithms</em></span>,  combine several
factors to produce a single relevance <code class="literal">_score</code> for each document.  In this
chapter, we examine the various moving parts and discuss how they can be
controlled.</p><p>Of course, relevance is not just about full-text queries; it may need to
take structured data into account as well. Perhaps we are looking for a
vacation home with particular features (air-conditioning, sea view, free
WiFi).  The more features that a property has, the more relevant it is. Or
perhaps we want to factor in sliding scales like recency, price, popularity, or
distance, while still taking the relevance of a full-text query into account.</p><p>All of this is possible thanks to the powerful scoring infrastructure
available in Elasticsearch.</p><p>We will start by looking at the theoretical side of how Lucene calculates
relevance, and then move on to practical examples of how you can control the
process.</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="scoring-theory"></a>Theory Behind Relevance Scoring</h2></div></div></div><p>Lucene (and thus Elasticsearch) uses the
<a class="ulink" href="http://en.wikipedia.org/wiki/Standard_Boolean_model" target="_top"><span class="emphasis"><em>Boolean model</em></span></a>
to find matching documents,<a id="id-1.5.8.8.2.2" class="indexterm"></a>
<a id="id-1.5.8.8.2.3" class="indexterm"></a><a id="id-1.5.8.8.2.4" class="indexterm"></a> and a formula called the
<a class="link" href="controlling-relevance.html#practical-scoring-function" title="Lucene’s Practical Scoring Function"><span class="emphasis"><em>practical scoring function</em></span></a>
to calculate relevance.  This formula borrows concepts from
<a class="ulink" href="http://en.wikipedia.org/wiki/Tfidf" target="_top"><span class="emphasis"><em>term frequency/inverse document frequency</em></span></a> and the
<a class="ulink" href="http://en.wikipedia.org/wiki/Vector_space_model" target="_top"><span class="emphasis"><em>vector space model</em></span></a>
but adds more-modern features like a coordination factor, field length
normalization, and term or query clause boosting.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Don’t be alarmed!  These concepts are not as complicated as the names make
them appear. While this section mentions algorithms, formulae, and mathematical
models, it is intended for consumption by mere humans.  Understanding the
algorithms themselves is not as important as understanding the factors that
influence the outcome.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="boolean-model"></a>Boolean Model</h3></div></div></div><p>The <span class="emphasis"><em>Boolean model</em></span> simply applies the <code class="literal">AND</code>, <code class="literal">OR</code>, and <code class="literal">NOT</code> conditions
expressed in the query to find all the documents that match.<a id="id-1.5.8.8.4.2.5" class="indexterm"></a><a id="id-1.5.8.8.4.2.6" class="indexterm"></a><a id="id-1.5.8.8.4.2.7" class="indexterm"></a> A query for</p><pre class="literallayout">full AND text AND search AND (elasticsearch OR lucene)</pre><p>will include only documents that contain all of the terms <code class="literal">full</code>, <code class="literal">text</code>, and
<code class="literal">search</code>, and either <code class="literal">elasticsearch</code> or <code class="literal">lucene</code>.</p><p>This process is simple and fast.  It is used to exclude any documents that
cannot possibly match the query.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="tfidf"></a>Term Frequency/Inverse Document Frequency (TF/IDF)</h3></div></div></div><p>Once we have a list of matching documents, they need to be ranked by
relevance.<a id="id-1.5.8.8.5.2.1" class="indexterm"></a> Not all documents will contain all the terms, and some terms are
more important than others. The relevance score of the whole document
depends (in part) on the <span class="emphasis"><em>weight</em></span> of each query term that appears in
that document.</p><p>The weight of a term is determined by three factors, which we already
introduced in <a class="xref" href="sorting.html#relevance-intro" title="Relevance가 무엇인가?">Relevance가 무엇인가?</a>. The formulae are included for interest’s
sake, but you are not required to remember them.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="tf"></a>Term frequency</h4></div></div></div><p>How often does the term appear in this document?<a id="id-1.5.8.8.5.4.2.1" class="indexterm"></a>
<a id="id-1.5.8.8.5.4.2.2" class="indexterm"></a> The more often, the
<span class="emphasis"><em>higher</em></span> the weight.  A field containing five mentions of the same term is
more likely to be relevant than a field containing just one mention.
The term frequency is calculated as follows:</p><pre class="literallayout">tf(t in d) = √frequency <a id="CO101-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO101-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The term frequency (<code class="literal">tf</code>) for term <code class="literal">t</code> in document <code class="literal">d</code> is the square root
    of the number of times the term appears in the document.
</p></td></tr></table></div><p>If you don’t care about how often a term appears in a field, and all you care
about is that the term is present, then you can disable term frequencies in
the field mapping:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">PUT /my_index
{
  "mappings": {
    "doc": {
      "properties": {
        "text": {
          "type":          "string",
          "index_options": "docs" <a id="CO102-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
        }
      }
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO102-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Setting <code class="literal">index_options</code> to <code class="literal">docs</code> will disable term frequencies and term
    positions. A field with this mapping will not count how many times a term
    appears, and will not be usable for phrase or proximity queries.
    Exact-value <code class="literal">not_analyzed</code> string fields use this setting by default.
</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idf"></a>Inverse document frequency</h4></div></div></div><p>How often does the term appear in all documents in the collection?  The more
often, the <span class="emphasis"><em>lower</em></span> the weight.<a id="id-1.5.8.8.5.5.2.2" class="indexterm"></a><a id="id-1.5.8.8.5.5.2.3" class="indexterm"></a>
<a id="id-1.5.8.8.5.5.2.4" class="indexterm"></a> Common terms like <code class="literal">and</code> or <code class="literal">the</code> contribute
little to relevance, as they appear in most documents, while uncommon terms
like <code class="literal">elastic</code> or <code class="literal">hippopotamus</code> help us zoom in on the most interesting
documents. The inverse document frequency is calculated as follows:</p><pre class="literallayout">idf(t) = 1 + log ( numDocs / (docFreq + 1)) <a id="CO103-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO103-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The inverse document frequency (<code class="literal">idf</code>) of term <code class="literal">t</code> is the
    logarithm of the number of documents in the index, divided by
    the number of documents that contain the term.
</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="field-norm"></a>Field-length norm</h4></div></div></div><p>How long is the field?  <a id="id-1.5.8.8.5.6.2.1" class="indexterm"></a>
<a id="id-1.5.8.8.5.6.2.2" class="indexterm"></a><a id="id-1.5.8.8.5.6.2.3" class="indexterm"></a>The shorter the field, the <span class="emphasis"><em>higher</em></span> the weight. If a
term appears in a short field, such as a <code class="literal">title</code> field, it is more likely that
the content of that field is <span class="emphasis"><em>about</em></span> the term than if the same term appears
in a much bigger <code class="literal">body</code> field. The field length norm is calculated as follows:</p><pre class="literallayout">norm(d) = 1 / √numTerms <a id="CO104-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO104-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The field-length norm (<code class="literal">norm</code>) is the inverse square root of the number of terms
    in the field.
</p></td></tr></table></div><p>While the field-length <a id="id-1.5.8.8.5.6.5.1" class="indexterm"></a>
<a id="id-1.5.8.8.5.6.5.2" class="indexterm"></a>norm is important for full-text search, many other
fields don’t need norms. Norms consume approximately 1 byte per <code class="literal">string</code> field
per document in the index, whether or not a document contains the field.  Exact-value <code class="literal">not_analyzed</code> string fields have norms disabled by default,
but you can use the field mapping to disable norms on <code class="literal">analyzed</code> fields as
well:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">PUT /my_index
{
  "mappings": {
    "doc": {
      "properties": {
        "text": {
          "type": "string",
          "norms": { "enabled": false } <a id="CO105-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
        }
      }
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO105-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
This field will not take the field-length norm into account.  A long field
    and a short field will be scored as if they were the same length.
</p></td></tr></table></div><p>For use cases such as logging, norms are not useful.  All you care about is
whether a field contains a particular error code or a particular browser
identifier. The length of the field does not affect the outcome.  Disabling
norms can save a significant amount of memory.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_putting_it_together"></a>Putting it together</h4></div></div></div><p>These three factors—term frequency, inverse document frequency, and field-length norm—are calculated and stored at index time.<a id="id-1.5.8.8.5.7.2.1" class="indexterm"></a>
<a id="id-1.5.8.8.5.7.2.2" class="indexterm"></a>  Together, they are
used to calculate the <span class="emphasis"><em>weight</em></span> of a single term in a particular document.</p><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>When we refer to <span class="emphasis"><em>documents</em></span> in the preceding formulae, we are actually talking about
a field within a document.  Each field has its own inverted index and thus,
for TF/IDF purposes, the value of the field is the value of the document.</p></div></div><p>When we run a simple <code class="literal">term</code> query with <code class="literal">explain</code> set to <code class="literal">true</code> (see
<a class="xref" href="sorting.html#explain" title="Score를 이해하자">Score를 이해하자</a>), you will see that the only factors involved in calculating the
score are the ones explained in the preceding sections:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">PUT /my_index/doc/1
{ "text" : "quick brown fox" }

GET /my_index/doc/_search?explain
{
  "query": {
    "term": {
      "text": "fox"
    }
  }
}</pre></div><p>The (abbreviated) <code class="literal">explanation</code> from the preceding request is as follows:</p><pre class="literallayout">weight(text:fox in 0) [PerFieldSimilarity]:  0.15342641 <a id="CO106-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
result of:
    fieldWeight in 0                         0.15342641
    product of:
        tf(freq=1.0), with freq of 1:        1.0 <a id="CO106-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
        idf(docFreq=1, maxDocs=1):           0.30685282 <a id="CO106-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
        fieldNorm(doc=0):                    0.5 <a id="CO106-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO106-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The final <code class="literal">score</code> for term <code class="literal">fox</code> in field <code class="literal">text</code> in the document with internal
    Lucene doc ID <code class="literal">0</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO106-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The term <code class="literal">fox</code> appears once in the <code class="literal">text</code> field in this document.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO106-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The inverse document frequency of <code class="literal">fox</code> in the <code class="literal">text</code> field in all
    documents in this index.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO106-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The field-length normalization factor for this field.
</p></td></tr></table></div><p>Of course, queries usually consist of more than one term, so we need a
way of combining the weights of multiple terms.  For this, we turn to the
vector space model.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="vector-space-model"></a>Vector Space Model</h3></div></div></div><p>The <span class="emphasis"><em>vector space model</em></span> provides a way of <a id="id-1.5.8.8.6.2.2" class="indexterm"></a>comparing a multiterm query
against a document. The output is a single score that represents how well the
document matches the query.  In order to do this, the model represents both the document
and the query as <span class="emphasis"><em>vectors</em></span>.</p><p>A vector is really just a one-dimensional array containing numbers, for example:</p><pre class="literallayout">[1,2,5,22,3,8]</pre><p>In the vector space<a id="id-1.5.8.8.6.5.1" class="indexterm"></a>
<a id="id-1.5.8.8.6.5.2" class="indexterm"></a> model, each number in the vector is<a id="id-1.5.8.8.6.5.3" class="indexterm"></a>
<a id="id-1.5.8.8.6.5.4" class="indexterm"></a>
<a id="id-1.5.8.8.6.5.5" class="indexterm"></a> the <span class="emphasis"><em>weight</em></span> of a term,
as calculated with <a class="link" href="controlling-relevance.html#tfidf" title="Term Frequency/Inverse Document Frequency (TF/IDF)">term frequency/inverse document frequency</a>.</p><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>While TF/IDF is the default way of calculating term weights for the vector
space model, it is not the only way.  Other models like Okapi-BM25 exist and
are available in Elasticsearch.  TF/IDF is the default because it is a
simple, efficient algorithm that produces high-quality search results and
has stood the test of time.</p></div></div><p>Imagine that we have a query for “happy hippopotamus.”  A common word like
<code class="literal">happy</code> will have a low weight, while an uncommon term like <code class="literal">hippopotamus</code>
will have a high weight. Let’s assume that <code class="literal">happy</code> has a weight of 2 and
<code class="literal">hippopotamus</code> has a weight of 5.  We can plot this simple two-dimensional
vector—<code class="literal">[2,5]</code>—as a line on a graph starting at point (0,0) and
ending at point (2,5), as shown in <a class="xref" href="controlling-relevance.html#img-vector-query" title="Figure 27. A two-dimensional query vector for “happy hippopotamus” represented">Figure 27, “A two-dimensional query vector for “happy hippopotamus” represented”</a>.</p><div class="figure"><a id="img-vector-query"></a><p class="title"><strong>Figure 27. A two-dimensional query vector for “happy hippopotamus” represented</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/elas_17in01.png" alt="The query vector plotted on a graph" /></div></div></div><br class="figure-break" /><p>Now, imagine we have three documents:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
I am <span class="emphasis"><em>happy</em></span> in summer.
</li><li class="listitem">
After Christmas I’m a <span class="emphasis"><em>hippopotamus</em></span>.
</li><li class="listitem">
The <span class="emphasis"><em>happy hippopotamus</em></span> helped Harry.
</li></ol></div><p>We can create a similar vector for each document, consisting of the weight of
each query term—<code class="literal">happy</code> and <code class="literal">hippopotamus</code>—that appears in the
document, and plot these vectors on the same graph, as shown in <a class="xref" href="controlling-relevance.html#img-vector-docs" title="Figure 28. Query and document vectors for “happy hippopotamus”">Figure 28, “Query and document vectors for “happy hippopotamus””</a>:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Document 1: <code class="literal">(happy,____________)</code>—<code class="literal">[2,0]</code>
</li><li class="listitem">
Document 2: <code class="literal">( ___ ,hippopotamus)</code>—<code class="literal">[0,5]</code>
</li><li class="listitem">
Document 3: <code class="literal">(happy,hippopotamus)</code>—<code class="literal">[2,5]</code>
</li></ul></div><div class="figure"><a id="img-vector-docs"></a><p class="title"><strong>Figure 28. Query and document vectors for “happy hippopotamus”</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/elas_17in02.png" alt="The query and document vectors plotted on a graph" /></div></div></div><br class="figure-break" /><p>The nice thing about vectors is that they can be compared. By measuring the
angle between the query vector and the document vector, it is possible to
assign a relevance score to each document. The angle between document 1 and
the query is large, so it is of low relevance.  Document 2 is closer to the
query, meaning that it is reasonably relevant, and document 3 is a perfect
match.</p><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>In practice, only two-dimensional vectors (queries with two terms) can  be
plotted easily on a graph. Fortunately, <span class="emphasis"><em>linear algebra</em></span>—the branch of
mathematics that deals with vectors—provides tools to compare the
angle between multidimensional vectors, which means that we can apply the
same principles explained above to queries that consist of many terms.</p><p>You can read more about how to compare two vectors by using <a class="ulink" href="http://en.wikipedia.org/wiki/Cosine_similarity" target="_top"><span class="emphasis"><em>cosine similarity</em></span></a>.</p></div></div><p>Now that we have talked about the theoretical basis of scoring, we can move on
to see how scoring is implemented in Lucene.<a id="id-1.5.8.8.6.16.1" class="indexterm"></a>
<a id="id-1.5.8.8.6.16.2" class="indexterm"></a></p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="practical-scoring-function"></a>Lucene’s Practical Scoring Function</h2></div></div></div><p>For multiterm queries, Lucene takes<a id="id-1.5.8.9.2.1" class="indexterm"></a>
<a id="id-1.5.8.9.2.2" class="indexterm"></a>
<a id="id-1.5.8.9.2.3" class="indexterm"></a><a id="id-1.5.8.9.2.4" class="indexterm"></a> the <a class="link" href="controlling-relevance.html#boolean-model" title="Boolean Model">Boolean model</a>,
<a class="link" href="controlling-relevance.html#tfidf" title="Term Frequency/Inverse Document Frequency (TF/IDF)">TF/IDF</a>, and the <a class="link" href="controlling-relevance.html#vector-space-model" title="Vector Space Model">vector space model</a> and
combines <a id="id-1.5.8.9.2.8" class="indexterm"></a><a id="id-1.5.8.9.2.9" class="indexterm"></a> them in a single efficient package that collects matching
documents and scores them as it goes.</p><p>A multiterm query like</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">GET /my_index/doc/_search
{
  "query": {
    "match": {
      "text": "quick fox"
    }
  }
}</pre></div><p>is rewritten internally to look like this:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">GET /my_index/doc/_search
{
  "query": {
    "bool": {
      "should": [
        {"term": { "text": "quick" }},
        {"term": { "text": "fox"   }}
      ]
    }
  }
}</pre></div><p>The <code class="literal">bool</code> query implements the Boolean model and, in this example, will
include only documents that contain either the term <code class="literal">quick</code> or the term <code class="literal">fox</code> or
both.</p><p>As soon as a document matches a query, Lucene calculates its score for that
query, combining the scores of each matching term.  The formula used for
scoring is called the <span class="emphasis"><em>practical scoring function</em></span>.<a id="id-1.5.8.9.8.2" class="indexterm"></a> It looks intimidating, but
don’t be put off—most of the components you already know. It introduces a
few new elements that we discuss next.</p><pre class="literallayout">score(q,d)  =  <a id="CO107-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
            queryNorm(q)  <a id="CO107-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
          · coord(q,d)    <a id="CO107-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
          · ∑ (           <a id="CO107-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>
                tf(t in d)   <a id="CO107-5"></a><span><img src="images/icons/callouts/5.png" alt="" /></span>
              · idf(t)²      <a id="CO107-6"></a><span><img src="images/icons/callouts/6.png" alt="" /></span>
              · t.getBoost() <a id="CO107-7"></a><span><img src="images/icons/callouts/7.png" alt="" /></span>
              · norm(t,d)    <a id="CO107-8"></a><span><img src="images/icons/callouts/8.png" alt="" /></span>
            ) (t in q)    <a id="CO107-9"></a><span><img src="images/icons/callouts/9.png" alt="" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO107-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
<code class="literal">score(q,d)</code> is the relevance score of document <code class="literal">d</code> for query <code class="literal">q</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO107-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
<code class="literal">queryNorm(q)</code> is the <a class="link" href="controlling-relevance.html#query-norm" title="Query Normalization Factor"><span class="emphasis"><em>query normalization</em></span> factor</a> (new).
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO107-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
<code class="literal">coord(q,d)</code> is the <a class="link" href="controlling-relevance.html#coord" title="Query Coordination"><span class="emphasis"><em>coordination</em></span> factor</a> (new).
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO107-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> <a href="#CO107-9"><span><img src="images/icons/callouts/9.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The sum of the weights for each term <code class="literal">t</code> in the query <code class="literal">q</code> for document <code class="literal">d</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO107-5"><span><img src="images/icons/callouts/5.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
<code class="literal">tf(t in d)</code> is the <a class="link" href="controlling-relevance.html#tf" title="Term frequency">term frequency</a> for term <code class="literal">t</code> in document <code class="literal">d</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO107-6"><span><img src="images/icons/callouts/6.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
<code class="literal">idf(t)</code> is the <a class="link" href="controlling-relevance.html#idf" title="Inverse document frequency">inverse document frequency</a> for term <code class="literal">t</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO107-7"><span><img src="images/icons/callouts/7.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
<code class="literal">t.getBoost()</code> is the <a class="link" href="controlling-relevance.html#query-time-boosting" title="Query-Time Boosting"><span class="emphasis"><em>boost</em></span></a>  that has been
    applied to the query (new).
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO107-8"><span><img src="images/icons/callouts/8.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
<code class="literal">norm(t,d)</code> is the <a class="link" href="controlling-relevance.html#field-norm" title="Field-length norm">field-length norm</a>, combined with the
    <a class="link" href="controlling-relevance.html#index-boost" title="Index-Time Field-Level Boosting">index-time field-level boost</a>, if any. (new).
</p></td></tr></table></div><p>You should recognize <code class="literal">score</code>, <code class="literal">tf</code>, and <code class="literal">idf</code>. The  <code class="literal">queryNorm</code>, <code class="literal">coord</code>,
<code class="literal">t.getBoost</code>, and <code class="literal">norm</code> are new.</p><p>We will talk more about <a class="link" href="controlling-relevance.html#query-time-boosting" title="Query-Time Boosting">query-time boosting</a>  later in
this chapter, but first let’s get query normalization, coordination, and
index-time field-level boosting out of the way.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="query-norm"></a>Query Normalization Factor</h3></div></div></div><p>The <span class="emphasis"><em>query normalization factor</em></span> (<code class="literal">queryNorm</code>) is <a id="id-1.5.8.9.13.2.3" class="indexterm"></a>
<a id="id-1.5.8.9.13.2.4" class="indexterm"></a><a id="id-1.5.8.9.13.2.5" class="indexterm"></a><a id="id-1.5.8.9.13.2.6" class="indexterm"></a>
<a id="id-1.5.8.9.13.2.7" class="indexterm"></a>an attempt to <span class="emphasis"><em>normalize</em></span> a
query so that the results from one query may be compared with the results of
another.</p><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>Even though the intent of the query norm is to make results from different
queries comparable, it doesn’t work very well. The only purpose of
the relevance <code class="literal">_score</code> is to sort the results of the current query in the
correct order. You should not try to compare the relevance scores from
different queries.</p></div></div><p>This factor is calculated at the beginning of the query. The actual
calculation depends on the queries involved, but a typical implementation is as follows:</p><pre class="literallayout">queryNorm = 1 / √sumOfSquaredWeights <a id="CO108-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO108-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">sumOfSquaredWeights</code> is calculated by adding together the IDF of each
    term in the query, squared.
</p></td></tr></table></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>The same query normalization factor is applied to every document, and you
have no way of changing it. For all intents and purposes, it can be ignored.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="coord"></a>Query Coordination</h3></div></div></div><p>The <span class="emphasis"><em>coordination factor</em></span> (<code class="literal">coord</code>) is used to<a id="id-1.5.8.9.14.2.3" class="indexterm"></a><a id="id-1.5.8.9.14.2.4" class="indexterm"></a><a id="id-1.5.8.9.14.2.5" class="indexterm"></a>
<a id="id-1.5.8.9.14.2.6" class="indexterm"></a> reward documents that contain a
higher percentage of the query terms. The more query terms that appear in
the document, the greater the chances that the document is a good match for
the query.</p><p>Imagine that we have a query for <code class="literal">quick brown fox</code>, and that the
weight for each term is 1.5.  Without the coordination factor, the score would
just be the sum of the weights of the terms in a document. For instance:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Document with <code class="literal">fox</code> → score: 1.5
</li><li class="listitem">
Document with <code class="literal">quick fox</code> → score: 3.0
</li><li class="listitem">
Document with <code class="literal">quick brown fox</code> → score: 4.5
</li></ul></div><p>The coordination factor multiplies the score by the number of matching terms
in the document, and divides it by the total number of terms in the query.
With the coordination factor, the scores would be as follows:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Document with <code class="literal">fox</code> → score: <code class="literal">1.5 * 1 / 3</code> = 0.5
</li><li class="listitem">
Document with <code class="literal">quick fox</code> → score: <code class="literal">3.0 * 2 / 3</code> = 2.0
</li><li class="listitem">
Document with <code class="literal">quick brown fox</code> → score: <code class="literal">4.5 * 3 / 3</code> = 4.5
</li></ul></div><p>The coordination factor results in the document that contains all three terms
being much more relevant than the document that contains just two of them.</p><p>Remember that the query for <code class="literal">quick brown fox</code> is rewritten into a <code class="literal">bool</code> query
like this:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">GET /_search
{
  "query": {
    "bool": {
      "should": [
        { "term": { "text": "quick" }},
        { "term": { "text": "brown" }},
        { "term": { "text": "fox"   }}
      ]
    }
  }
}</pre></div><p>The <code class="literal">bool</code> query uses query coordination by default for all <code class="literal">should</code> clauses,
but it does allow you to disable coordination.  Why might you want to do this?
Well, usually the answer is, you don’t.  Query coordination is usually a good
thing.  When you use a <code class="literal">bool</code> query to wrap several high-level queries like
the <code class="literal">match</code> query, it also makes sense to leave coordination enabled. The more
clauses that match, the higher the degree of overlap between your search
request and the documents that are returned.</p><p>However, in some advanced use cases, it might make sense to disable
coordination.  Imagine that you are looking for the synonyms <code class="literal">jump</code>, <code class="literal">leap</code>, and
<code class="literal">hop</code>.  You don’t care how many of these synonyms are present, as they all
represent the same concept. In fact, only one of the synonyms is likely to be
present.  This would be a good case for disabling the coordination factor:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">GET /_search
{
  "query": {
    "bool": {
      "disable_coord": true,
      "should": [
        { "term": { "text": "jump" }},
        { "term": { "text": "hop"  }},
        { "term": { "text": "leap" }}
      ]
    }
  }
}</pre></div><p>When you use synonyms (see <a class="xref" href="synonyms.html" title="Synonyms"><em>Synonyms</em></a>), this is exactly what
happens internally: the rewritten query disables coordination for the
synonyms. <a id="id-1.5.8.9.14.13.2" class="indexterm"></a>
<a id="id-1.5.8.9.14.13.3" class="indexterm"></a>  Most use cases for disabling coordination are handled
automatically; you don’t need to worry about it.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="index-boost"></a>Index-Time Field-Level Boosting</h3></div></div></div><p>We will talk about <span class="emphasis"><em>boosting</em></span> a field—making it <a id="id-1.5.8.9.15.2.2" class="indexterm"></a>
<a id="id-1.5.8.9.15.2.3" class="indexterm"></a><a id="id-1.5.8.9.15.2.4" class="indexterm"></a>
<a id="id-1.5.8.9.15.2.5" class="indexterm"></a><a id="id-1.5.8.9.15.2.6" class="indexterm"></a>
<a id="id-1.5.8.9.15.2.7" class="indexterm"></a>more important than other
fields—at query time in <a class="xref" href="controlling-relevance.html#query-time-boosting" title="Query-Time Boosting">Query-Time Boosting</a>.  It is also possible
to apply a boost to a field at index time.  Actually, this boost is applied to
every term in the field, rather than to the field itself.</p><p>To store this boost value in the index without using more space
than necessary, this field-level index-time boost is combined with the <a id="id-1.5.8.9.15.3.1" class="indexterm"></a>field-length norm (see  <a class="xref" href="controlling-relevance.html#field-norm" title="Field-length norm">Field-length norm</a>) and stored in the index as a single byte.
This is the value returned by <code class="literal">norm(t,d)</code> in the preceding formula.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>We strongly recommend against using field-level index-time boosts for a few
reasons:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Combining the boost with the field-length norm and storing it in a single
    byte means that the field-length norm loses precision. The result is that
    Elasticsearch is unable to distinguish between a field containing three words
    and a field containing five words.
</li><li class="listitem">
To change an index-time boost, you have to reindex all your documents.
    A query-time boost, on the other hand, can be changed with every query.
</li><li class="listitem">
If a field with an index-time boost has multiple values, the boost is
    multiplied by itself for every value, dramatically increasing
    the weight for that field.
</li></ul></div><p><a class="link" href="controlling-relevance.html#query-time-boosting" title="Query-Time Boosting">Query-time boosting</a> is a much simpler, cleaner, more
flexible option.</p></div></div><p>With query normalization, coordination, and index-time boosting out of the way,
we can now move on to the most useful tool for influencing the relevance
calculation: query-time boosting.<a id="id-1.5.8.9.15.5.1" class="indexterm"></a>
<a id="id-1.5.8.9.15.5.2" class="indexterm"></a>
<a id="id-1.5.8.9.15.5.3" class="indexterm"></a></p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-time-boosting"></a>Query-Time Boosting</h2></div></div></div><p>In <a class="link" href="multi-field-search.html#prioritising-clauses" title="Prioritizing Clauses">Prioritizing Clauses</a>, we explained <a id="id-1.5.8.10.2.2" class="indexterm"></a>
<a id="id-1.5.8.10.2.3" class="indexterm"></a>
<a id="id-1.5.8.10.2.4" class="indexterm"></a><a id="id-1.5.8.10.2.5" class="indexterm"></a>
<a id="id-1.5.8.10.2.6" class="indexterm"></a>how you could use the <code class="literal">boost</code>
parameter at search time to give one query clause more importance than
another.  For instance:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">GET /_search
{
  "query": {
    "bool": {
      "should": [
        {
          "match": {
            "title": {
              "query": "quick brown fox",
              "boost": 2 <a id="CO109-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
            }
          }
        },
        {
          "match": { <a id="CO109-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
            "content": "quick brown fox"
          }
        }
      ]
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO109-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">title</code> query clause is twice as important as the <code class="literal">content</code> query
    clause, because it has been boosted by a factor of <code class="literal">2</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO109-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
A query clause without a <code class="literal">boost</code> value has a neutral boost of <code class="literal">1</code>.
</p></td></tr></table></div><p><span class="emphasis"><em>Query-time boosting</em></span> is the main tool that you can use to tune relevance. Any
type of query accepts a <code class="literal">boost</code> parameter.<a id="id-1.5.8.10.5.3" class="indexterm"></a>
<a id="id-1.5.8.10.5.4" class="indexterm"></a>  Setting a <code class="literal">boost</code> of <code class="literal">2</code> doesn’t
simply double the final <code class="literal">_score</code>; the actual boost value that is applied
goes through normalization and some internal optimization.  However, it does
imply that a clause with a boost of <code class="literal">2</code> is twice as important as a clause with
a boost of <code class="literal">1</code>.</p><p>Practically, there is no simple formula for deciding on the “correct” boost
value for a particular query clause.  It’s a matter of try-it-and-see.
Remember that <code class="literal">boost</code> is just one of the factors involved in the relevance
score; it has to compete with the other factors.  For instance, in the preceding
example, the <code class="literal">title</code> field will probably already have a “natural” boost over
the <code class="literal">content</code> field thanks <a id="id-1.5.8.10.6.4" class="indexterm"></a>to the <a class="link" href="controlling-relevance.html#field-norm" title="Field-length norm">field-length norm</a> (titles
are usually shorter than the related content), so don’t blindly boost fields
just because you think they should be boosted.  Apply a boost and check the
results. Change the boost and check again.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_boosting_an_index"></a>Boosting an Index</h3></div></div></div><p>When searching across multiple indices, you<a id="id-1.5.8.10.7.2.1" class="indexterm"></a>
<a id="id-1.5.8.10.7.2.2" class="indexterm"></a>
<a id="id-1.5.8.10.7.2.3" class="indexterm"></a><a id="id-1.5.8.10.7.2.4" class="indexterm"></a>
<a id="id-1.5.8.10.7.2.5" class="indexterm"></a> can boost an entire index over
the others with the <code class="literal">indices_boost</code> parameter.<a id="id-1.5.8.10.7.2.7" class="indexterm"></a>  This could be used, as in the
next example, to give more weight to documents from a more recent index:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">GET /docs_2014_*/_search <a id="CO110-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
{
  "indices_boost": { <a id="CO110-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
    "docs_2014_10": 3,
    "docs_2014_09": 2
  },
  "query": {
    "match": {
      "text": "quick brown fox"
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO110-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
This multi-index search covers all indices beginning with
    <code class="literal">docs_2014_</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO110-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Documents in the <code class="literal">docs_2014_10</code> index will be boosted by <code class="literal">3</code>, those
    in <code class="literal">docs_2014_09</code> by <code class="literal">2</code>, and any other matching indices will have
    a neutral boost of <code class="literal">1</code>.
</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_t_getboost"></a>t.getBoost()</h3></div></div></div><p>These boost values are represented in the <a class="xref" href="controlling-relevance.html#practical-scoring-function" title="Lucene’s Practical Scoring Function">Lucene’s Practical Scoring Function</a> by
the <code class="literal">t.getBoost()</code> element.<a id="id-1.5.8.10.8.2.3" class="indexterm"></a>
<a id="id-1.5.8.10.8.2.4" class="indexterm"></a><a id="id-1.5.8.10.8.2.5" class="indexterm"></a>
<a id="id-1.5.8.10.8.2.6" class="indexterm"></a>
<a id="id-1.5.8.10.8.2.7" class="indexterm"></a><a id="id-1.5.8.10.8.2.8" class="indexterm"></a> Boosts are not applied at the level that they
appear in the query DSL.  Instead, any boost values are combined and passsed
down to the individual terms.  The <code class="literal">t.getBoost()</code> method returns any <code class="literal">boost</code>
value applied to the term itself or to any of the queries higher up the chain.</p><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>In fact, reading the <a class="link" href="sorting.html#explain" title="Score를 이해하자"><code class="literal">explain</code></a> output is a little more complex
than that. You won’t see the <code class="literal">boost</code> value or <code class="literal">t.getBoost()</code> mentioned in the
<code class="literal">explanation</code> at all.  Instead, the boost is rolled into the
<a class="link" href="controlling-relevance.html#query-norm" title="Query Normalization Factor"><code class="literal">queryNorm</code></a> that is applied to a particular term. Although we said that
the <code class="literal">queryNorm</code> is the  same for every term, you will see that the <code class="literal">queryNorm</code>
for a boosted term is higher than the <code class="literal">queryNorm</code> for an unboosted term.</p></div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-scoring"></a>Manipulating Relevance with Query Structure</h2></div></div></div><p>The Elasticsearch query DSL is immensely flexible.<a id="id-1.5.8.11.2.1" class="indexterm"></a>
<a id="id-1.5.8.11.2.2" class="indexterm"></a>
<a id="id-1.5.8.11.2.3" class="indexterm"></a><a id="id-1.5.8.11.2.4" class="indexterm"></a>
<a id="id-1.5.8.11.2.5" class="indexterm"></a>  You can move individual
query clauses up and down the query hierarchy to make a clause more or less
important.  For instance, imagine the following query:</p><pre class="literallayout">quick OR brown OR red OR fox</pre><p>We could write this as a <code class="literal">bool</code> query with <a id="id-1.5.8.11.4.2" class="indexterm"></a>
<a id="id-1.5.8.11.4.3" class="indexterm"></a>all terms at the same level:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">GET /_search
{
  "query": {
    "bool": {
      "should": [
        { "term": { "text": "quick" }},
        { "term": { "text": "brown" }},
        { "term": { "text": "red"   }},
        { "term": { "text": "fox"   }}
      ]
    }
  }
}</pre></div><p>But this query might score a document that contains <code class="literal">quick</code>, <code class="literal">red</code>, and
<code class="literal">brown</code> the same as another document that contains <code class="literal">quick</code>, <code class="literal">red</code>, and <code class="literal">fox</code>.
<span class="emphasis"><em>Red</em></span> and <span class="emphasis"><em>brown</em></span> are synonyms and we probably only need one of them to match.
Perhaps we really want to express the query as follows:</p><pre class="literallayout">quick OR (brown OR red) OR fox</pre><p>According to standard Boolean logic, this is exactly the same as the original
query, but as we have already seen in <a class="link" href="full-text-search.html#bool-query" title="Combining Queries">Combining Queries</a>, a <code class="literal">bool</code> query does not concern itself only with whether a document matches, but also with how
<span class="emphasis"><em>well</em></span> it matches.</p><p>A better way to write this query is as follows:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">GET /_search
{
  "query": {
    "bool": {
      "should": [
        { "term": { "text": "quick" }},
        { "term": { "text": "fox"   }},
        {
          "bool": {
            "should": [
              { "term": { "text": "brown" }},
              { "term": { "text": "red"   }}
            ]
          }
        }
      ]
    }
  }
}</pre></div><p>Now, <code class="literal">red</code> and <code class="literal">brown</code> compete with each other at their own level, and <code class="literal">quick</code>,
<code class="literal">fox</code>, and <code class="literal">red OR brown</code> are the top-level competitive terms.</p><p>We have already discussed how the <a class="link" href="full-text-search.html#match-query" title="The match Query"><code class="literal">match</code></a>,
<a class="link" href="multi-field-search.html#multi-match-query" title="multi_match Query"><code class="literal">multi_match</code></a>, <a class="link" href="full-text-search.html#term-vs-full-text" title="Term-Based Versus Full-Text"><code class="literal">term</code></a>,
<a class="link" href="full-text-search.html#bool-query" title="Combining Queries"><code class="literal">bool</code></a>, and  <a class="link" href="multi-field-search.html#dis-max-query" title="dis_max Query"><code class="literal">dis_max</code></a> queries can be used
to manipulate scoring. In the rest of this chapter, we present
three other scoring-related queries: the <code class="literal">boosting</code> query, the
<code class="literal">constant_score</code> query, and the <code class="literal">function_score</code> query.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="not-quite-not"></a>Not Quite Not</h2></div></div></div><p>A search on the Internet for “Apple” is likely to return results about the
company, the fruit, <a id="id-1.5.8.12.2.1" class="indexterm"></a>
<a id="id-1.5.8.12.2.2" class="indexterm"></a>
<a id="id-1.5.8.12.2.3" class="indexterm"></a><a id="id-1.5.8.12.2.4" class="indexterm"></a>
<a id="id-1.5.8.12.2.5" class="indexterm"></a>and various recipes.  We could try to narrow it down to
just the company by excluding words like <code class="literal">pie</code>, <code class="literal">tart</code>, <code class="literal">crumble</code>, and <code class="literal">tree</code>,
using a <code class="literal">must_not</code> clause in a <code class="literal">bool</code> query:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">GET /_search
{
  "query": {
    "bool": {
      "must": {
        "match": {
          "text": "apple"
        }
      },
      "must_not": {
        "match": {
          "text": "pie tart fruit crumble tree"
        }
      }
    }
  }
}</pre></div><p>But who is to say that we wouldn’t miss a very relevant document about Apple
the company by excluding <code class="literal">tree</code> or <code class="literal">crumble</code>?  Sometimes, <code class="literal">must_not</code> can be
too strict.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="boosting-query"></a>boosting Query</h3></div></div></div><p>The  <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-boosting-query.html" target="_top"><code class="literal">boosting</code> query</a> solves<a id="id-1.5.8.12.5.2.2" class="indexterm"></a><a id="id-1.5.8.12.5.2.3" class="indexterm"></a>
<a id="id-1.5.8.12.5.2.4" class="indexterm"></a>
<a id="id-1.5.8.12.5.2.5" class="indexterm"></a> this problem.
It allows us to still include results that appear to be about the fruit or
the pastries, but to downgrade them—to rank them lower than they would
otherwise be:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">GET /_search
{
  "query": {
    "boosting": {
      "positive": {
        "match": {
          "text": "apple"
        }
      },
      "negative": {
        "match": {
          "text": "pie tart fruit crumble tree"
        }
      },
      "negative_boost": 0.5
    }
  }
}</pre></div><p>It accepts a <code class="literal">positive</code> query and a <code class="literal">negative</code> query.<a id="id-1.5.8.12.5.4.3" class="indexterm"></a>  Only documents that
match the <code class="literal">positive</code> query will be included in the results list, but documents
that also match the <code class="literal">negative</code> query will be downgraded by multiplying the
original <code class="literal">_score</code> of<a id="id-1.5.8.12.5.4.7" class="indexterm"></a> the document with the <code class="literal">negative_boost</code>.</p><p>For this to work, the <code class="literal">negative_boost</code> must be less than <code class="literal">1.0</code>.  In this
example, any documents that contain any of the negative terms will have their
<code class="literal">_score</code> cut in half.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ignoring-tfidf"></a>Ignoring TF/IDF</h2></div></div></div><p>Sometimes we just don’t care about TF/IDF.<a id="id-1.5.8.13.2.1" class="indexterm"></a>
<a id="id-1.5.8.13.2.2" class="indexterm"></a>
<a id="id-1.5.8.13.2.3" class="indexterm"></a><a id="id-1.5.8.13.2.4" class="indexterm"></a>
<a id="id-1.5.8.13.2.5" class="indexterm"></a>  All we want to know is that a certain
word appears in a field. Perhaps we are searching for a vacation home and we
want to find houses that have as many of these features as possible:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
WiFi
</li><li class="listitem">
Garden
</li><li class="listitem">
Pool
</li></ul></div><p>The vacation home documents look something like this:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">{ "description": "A delightful four-bedroomed house with ... " }</pre></div><p>We could use a simple <code class="literal">match</code> query:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">GET /_search
{
  "query": {
    "match": {
      "description": "wifi garden pool"
    }
  }
}</pre></div><p>However, this isn’t really <span class="emphasis"><em>full-text search</em></span>. In this case, TF/IDF just gets
in the way.  We don’t care whether <code class="literal">wifi</code> is a common term, or how often it
appears in the document.  All we care about is that it does appear.
In fact, we just want to rank houses by the number of features they have—the more, the better. If a feature is present, it should score <code class="literal">1</code>, and if it
isn’t, <code class="literal">0</code>.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="constant-score-query"></a>constant_score Query</h3></div></div></div><p>Enter the <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-constant-score-query.html" target="_top"><code class="literal">constant_score</code></a> query.
This <a id="id-1.5.8.13.9.2.2" class="indexterm"></a>query can wrap either a query or a filter, and assigns a score of
<code class="literal">1</code> to any documents that match, regardless of TF/IDF:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">GET /_search
{
  "query": {
    "bool": {
      "should": [
        { "constant_score": {
          "query": { "match": { "description": "wifi" }}
        }},
        { "constant_score": {
          "query": { "match": { "description": "garden" }}
        }},
        { "constant_score": {
          "query": { "match": { "description": "pool" }}
        }}
      ]
    }
  }
}</pre></div><p>Perhaps not all features are equally important—some have more value to
the user than others. If the most important feature is the pool, we could
boost that clause to make it count for more:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">GET /_search
{
  "query": {
    "bool": {
      "should": [
        { "constant_score": {
          "query": { "match": { "description": "wifi" }}
        }},
        { "constant_score": {
          "query": { "match": { "description": "garden" }}
        }},
        { "constant_score": {
          "boost":   2 <a id="CO111-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
          "query": { "match": { "description": "pool" }}
        }}
      ]
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO111-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
A matching <code class="literal">pool</code> clause would add a score of <code class="literal">2</code>, while
    the other clauses would add a score of only <code class="literal">1</code> each.
</p></td></tr></table></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>The final score for each result is not simply the sum of the scores of
all matching clauses.  The <a class="link" href="controlling-relevance.html#coord" title="Query Coordination">coordination factor</a> and
<a class="link" href="controlling-relevance.html#query-norm" title="Query Normalization Factor">query normalization factor</a> are still taken into account.</p></div></div><p>We could improve our vacation home documents by adding a <code class="literal">not_analyzed</code>
<code class="literal">features</code> field to our vacation homes:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">{ "features": [ "wifi", "pool", "garden" ] }</pre></div><p>By default, a <code class="literal">not_analyzed</code> field has <a class="link" href="controlling-relevance.html#field-norm" title="Field-length norm">field-length norms</a>
disabled <a id="id-1.5.8.13.9.10.3" class="indexterm"></a>
<a id="id-1.5.8.13.9.10.4" class="indexterm"></a>and has <code class="literal">index_options</code> set to <code class="literal">docs</code>, disabling
<a class="link" href="controlling-relevance.html#tf" title="Term frequency">term frequencies</a>, but the problem remains: the
<a class="link" href="controlling-relevance.html#idf" title="Inverse document frequency">inverse document frequency</a> of each term is still taken into account.</p><p>We could use the same approach that we used previously, with the <code class="literal">constant_score</code>
query:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">GET /_search
{
  "query": {
    "bool": {
      "should": [
        { "constant_score": {
          "query": { "match": { "features": "wifi" }}
        }},
        { "constant_score": {
          "query": { "match": { "features": "garden" }}
        }},
        { "constant_score": {
          "boost":   2
          "query": { "match": { "features": "pool" }}
        }}
      ]
    }
  }
}</pre></div><p>Really, though, each of these features should be treated like a filter.  A
vacation home either has the feature or it doesn’t—a filter seems like it
would be a natural fit.  On top of that, if we use filters, we can
benefit from filter caching.</p><p>The problem is this: filters don’t score. What we need is a way of bridging
the gap between filters and queries. The <code class="literal">function_score</code> query does this
and a whole lot more.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="function-score-query"></a>function_score Query</h2></div></div></div><p>The <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-function-score-query.html" target="_top"><code class="literal">function_score</code> query</a> is the
ultimate tool for taking control of the scoring process.<a id="id-1.5.8.14.2.2" class="indexterm"></a><a id="id-1.5.8.14.2.3" class="indexterm"></a>
<a id="id-1.5.8.14.2.4" class="indexterm"></a>
<a id="id-1.5.8.14.2.5" class="indexterm"></a>  It allows you to
apply a function to each document that matches the main query in order to
alter or completely replace the original query <code class="literal">_score</code>.</p><p>In fact, you can apply different functions to <span class="emphasis"><em>subsets</em></span> of the main result set by
using filters, which gives you the best of both worlds: efficient scoring with
cacheable filters.</p><p>It supports several predefined functions out of the box:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">weight</code>
</span></dt><dd>
    Apply a simple boost to each document without the boost being
    normalized: a <code class="literal">weight</code> of <code class="literal">2</code> results in <code class="literal">2 * _score</code>.
</dd><dt><span class="term">
<code class="literal">field_value_factor</code>
</span></dt><dd>
    Use the value of a field in the document to alter the <code class="literal">_score</code>,  such as
    factoring in a <code class="literal">popularity</code> count or number of <code class="literal">votes</code>.
</dd><dt><span class="term">
<code class="literal">random_score</code>
</span></dt><dd>
    Use consistently random scoring to sort results differently for every user,
    while maintaining the same sort order for a single user.
</dd><dt><span class="term">
<span class="emphasis"><em>Decay functions</em></span>—<code class="literal">linear</code>, <code class="literal">exp</code>, <code class="literal">gauss</code>
</span></dt><dd>
    Incorporate sliding-scale values like <code class="literal">publish_date</code>, <code class="literal">geo_location</code>, or
    <code class="literal">price</code> into the <code class="literal">_score</code> to prefer recently published documents, documents
    near a latitude/longitude (lat/lon) point, or documents near a specified price point.
</dd><dt><span class="term">
<code class="literal">script_score</code>
</span></dt><dd>
    Use a custom script to take complete control of the scoring logic. If your
    needs extend beyond those of the functions in this list, write a custom
    script to implement the logic that you need.
</dd></dl></div><p>Without the <code class="literal">function_score</code> query, we would not be able to combine the score
from a full-text query with a factor like recency. We would have to sort
either by <code class="literal">_score</code> or by <code class="literal">date</code>; the effect of one would obliterate the
effect of the other. This query allows you to blend the two together: to still
sort by full-text relevance, but giving extra weight to recently published
documents, or popular documents, or products that are near the user’s price
point. As you can imagine, a query that supports all of this can look fairly
complex.  We’ll start with a simple use case and work our way up the
complexity ladder.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="boosting-by-popularity"></a>Boosting by Popularity</h2></div></div></div><p>Imagine that we have a website that hosts blog posts and enables users to vote for the
blog posts that they like.<a id="id-1.5.8.15.2.1" class="indexterm"></a>
<a id="id-1.5.8.15.2.2" class="indexterm"></a>
<a id="id-1.5.8.15.2.3" class="indexterm"></a><a id="id-1.5.8.15.2.4" class="indexterm"></a>
<a id="id-1.5.8.15.2.5" class="indexterm"></a><a id="id-1.5.8.15.2.6" class="indexterm"></a>
<a id="id-1.5.8.15.2.7" class="indexterm"></a> We would like more-popular posts to appear higher in the
results list, but still have the full-text score as the main relevance driver.
We can do this easily by storing the number of votes with each blog post:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">PUT /blogposts/post/1
{
  "title":   "About popularity",
  "content": "In this post we will talk about...",
  "votes":   6
}</pre></div><p>At search time, we can use the <code class="literal">function_score</code> query <a id="id-1.5.8.15.4.2" class="indexterm"></a>
<a id="id-1.5.8.15.4.3" class="indexterm"></a><a id="id-1.5.8.15.4.4" class="indexterm"></a>with the
<code class="literal">field_value_factor</code> function to combine the number of votes with the full-text relevance score:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">GET /blogposts/post/_search
{
  "query": {
    "function_score": { <a id="CO112-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
      "query": { <a id="CO112-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
        "multi_match": {
          "query":    "popularity",
          "fields": [ "title", "content" ]
        }
      },
      "field_value_factor": { <a id="CO112-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
        "field": "votes" <a id="CO112-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>
      }
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO112-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">function_score</code> query wraps the main query and the function we would
    like to apply.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO112-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The main query is executed first.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO112-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">field_value_factor</code> function is applied to every document matching
    the main <code class="literal">query</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO112-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Every document <span class="emphasis"><em>must</em></span> have a number in the <code class="literal">votes</code> field for
    the <code class="literal">function_score</code> to work.
</p></td></tr></table></div><p>In the preceding example, the final <code class="literal">_score</code> for each document has been altered as
follows:</p><pre class="literallayout">new_score = old_score * number_of_votes</pre><p>This will not give us great results.  The full-text <code class="literal">_score</code> range
usually falls somewhere between 0 and 10. As can be seen in <a class="xref" href="controlling-relevance.html#img-popularity-linear" title="Figure 29. Linear popularity based on an original _score of 2.0">Figure 29, “Linear popularity based on an original <code class="literal">_score</code> of <code class="literal">2.0</code>”</a>, a blog post with 10 votes will
completely swamp the effect of the full-text score, and a blog post with 0
votes will reset the score to zero.</p><div class="figure"><a id="img-popularity-linear"></a><p class="title"><strong>Figure 29. Linear popularity based on an original <code class="literal">_score</code> of <code class="literal">2.0</code></strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/elas_1701.png" alt="Linear popularity based on an original `_score` of `2.0`" /></div></div></div><br class="figure-break" /><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_modifier"></a>modifier</h3></div></div></div><p>A better way to incorporate popularity is to smooth out the <code class="literal">votes</code> value
with some <code class="literal">modifier</code>.  <a id="id-1.5.8.15.11.2.3" class="indexterm"></a><a id="id-1.5.8.15.11.2.4" class="indexterm"></a>
<a id="id-1.5.8.15.11.2.5" class="indexterm"></a>In other words, we want the first few votes to count a
lot, but for each subsequent vote to count less.  The difference between 0
votes and 1 vote should be much bigger than the difference between 10 votes
and 11 votes.</p><p>A typical <code class="literal">modifier</code> for this use case is <code class="literal">log1p</code>, which changes the formula
to the following:</p><pre class="literallayout">new_score = old_score * log(1 + number_of_votes)</pre><p>The <code class="literal">log</code> function smooths out the effect of the <code class="literal">votes</code> field to provide a
curve like the one in <a class="xref" href="controlling-relevance.html#img-popularity-log" title="Figure 30. Logarithmic popularity based on an original _score of 2.0">Figure 30, “Logarithmic popularity based on an original <code class="literal">_score</code> of <code class="literal">2.0</code>”</a>.</p><div class="figure"><a id="img-popularity-log"></a><p class="title"><strong>Figure 30. Logarithmic popularity based on an original <code class="literal">_score</code> of <code class="literal">2.0</code></strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/elas_1702.png" alt="Logarithmic popularity based on an original `_score` of `2.0`" /></div></div></div><br class="figure-break" /><p>The request with the <code class="literal">modifier</code> parameter looks like the following:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">GET /blogposts/post/_search
{
  "query": {
    "function_score": {
      "query": {
        "multi_match": {
          "query":    "popularity",
          "fields": [ "title", "content" ]
        }
      },
      "field_value_factor": {
        "field":    "votes",
        "modifier": "log1p" <a id="CO113-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
      }
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO113-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Set the <code class="literal">modifier</code> to <code class="literal">log1p</code>.
</p></td></tr></table></div><p class="pagebreak-before">The available modifiers are <code class="literal">none</code> (the default), <code class="literal">log</code>, <code class="literal">log1p</code>, <code class="literal">log2p</code>,
<code class="literal">ln</code>, <code class="literal">ln1p</code>, <code class="literal">ln2p</code>, <code class="literal">square</code>, <code class="literal">sqrt</code>,  and <code class="literal">reciprocal</code>.  You can read more
about them in the
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-function-score-query.html#function-field-value-factor" target="_top"><code class="literal">field_value_factor</code> documentation</a>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_factor"></a>factor</h3></div></div></div><p>The strength of the popularity effect can be increased or decreased by
multiplying the value<a id="id-1.5.8.15.12.2.1" class="indexterm"></a><a id="id-1.5.8.15.12.2.2" class="indexterm"></a>
<a id="id-1.5.8.15.12.2.3" class="indexterm"></a> in the <code class="literal">votes</code> field by some number, called the
<code class="literal">factor</code>:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">GET /blogposts/post/_search
{
  "query": {
    "function_score": {
      "query": {
        "multi_match": {
          "query":    "popularity",
          "fields": [ "title", "content" ]
        }
      },
      "field_value_factor": {
        "field":    "votes",
        "modifier": "log1p",
        "factor":   2 <a id="CO114-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
      }
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO114-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Doubles the popularity effect
</p></td></tr></table></div><p>Adding in a <code class="literal">factor</code> changes the formula to this:</p><pre class="literallayout">new_score = old_score * log(1 + factor * number_of_votes)</pre><p>A <code class="literal">factor</code> greater than <code class="literal">1</code> increases the effect, and a <code class="literal">factor</code> less than <code class="literal">1</code>
decreases the effect, as shown in <a class="xref" href="controlling-relevance.html#img-popularity-factor" title="Figure 31. Logarithmic popularity with different factors">Figure 31, “Logarithmic popularity with different factors”</a>.</p><div class="figure"><a id="img-popularity-factor"></a><p class="title"><strong>Figure 31. Logarithmic popularity with different factors</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/elas_1703.png" alt="Logarithmic popularity with different factors" /></div></div></div><br class="figure-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_boost_mode"></a>boost_mode</h3></div></div></div><p>Perhaps multiplying the full-text score by the result of the
<code class="literal">field_value_factor</code> function <a id="id-1.5.8.15.13.2.2" class="indexterm"></a>
<a id="id-1.5.8.15.13.2.3" class="indexterm"></a><a id="id-1.5.8.15.13.2.4" class="indexterm"></a>still has too large an effect.  We can control
how the result of a function is combined with the <code class="literal">_score</code> from the query by
using the <code class="literal">boost_mode</code> parameter, which accepts the following values:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">multiply</code>
</span></dt><dd>
      Multiply the <code class="literal">_score</code> with the function result (default)
</dd><dt><span class="term">
<code class="literal">sum</code>
</span></dt><dd>
      Add the function result to the <code class="literal">_score</code>
</dd><dt><span class="term">
<code class="literal">min</code>
</span></dt><dd>
      The lower of the <code class="literal">_score</code> and the function result
</dd><dt><span class="term">
<code class="literal">max</code>
</span></dt><dd>
      The higher of the <code class="literal">_score</code> and the function result
</dd><dt><span class="term">
<code class="literal">replace</code>
</span></dt><dd>
      Replace the <code class="literal">_score</code> with the function result
</dd></dl></div><p>If, instead of multiplying, we add the function result to the <code class="literal">_score</code>, we can
achieve a much smaller effect, especially if we use a low <code class="literal">factor</code>:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">GET /blogposts/post/_search
{
  "query": {
    "function_score": {
      "query": {
        "multi_match": {
          "query":    "popularity",
          "fields": [ "title", "content" ]
        }
      },
      "field_value_factor": {
        "field":    "votes",
        "modifier": "log1p",
        "factor":   0.1
      },
      "boost_mode": "sum" <a id="CO115-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO115-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Add the function result to the <code class="literal">_score</code>.
</p></td></tr></table></div><p>The formula for the preceding request now looks like this (see <a class="xref" href="controlling-relevance.html#img-popularity-sum" title="Figure 32. Combining popularity with sum">Figure 32, “Combining popularity with <code class="literal">sum</code>”</a>):</p><pre class="literallayout">new_score = old_score + log(1 + 0.1 * number_of_votes)</pre><div class="figure"><a id="img-popularity-sum"></a><p class="title"><strong>Figure 32. Combining popularity with <code class="literal">sum</code></strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/elas_1704.png" alt="Combining popularity with `sum`" /></div></div></div><br class="figure-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_max_boost"></a>max_boost</h3></div></div></div><p>Finally, we can cap the maximum effect<a id="id-1.5.8.15.14.2.1" class="indexterm"></a>
<a id="id-1.5.8.15.14.2.2" class="indexterm"></a><a id="id-1.5.8.15.14.2.3" class="indexterm"></a> that the function can have by using the
<code class="literal">max_boost</code> parameter:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">GET /blogposts/post/_search
{
  "query": {
    "function_score": {
      "query": {
        "multi_match": {
          "query":    "popularity",
          "fields": [ "title", "content" ]
        }
      },
      "field_value_factor": {
        "field":    "votes",
        "modifier": "log1p",
        "factor":   0.1
      },
      "boost_mode": "sum",
      "max_boost":  1.5 <a id="CO116-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO116-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Whatever the result of the <code class="literal">field_value_factor</code> function, it will never be
    greater than <code class="literal">1.5</code>.
</p></td></tr></table></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>The <code class="literal">max_boost</code> applies a limit to the result of the function only, not
to the final <code class="literal">_score</code>.</p></div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="function-score-filters"></a>Boosting Filtered Subsets</h2></div></div></div><p>Let’s return to the problem that we were dealing with in <a class="xref" href="controlling-relevance.html#ignoring-tfidf" title="Ignoring TF/IDF">Ignoring TF/IDF</a>,
where we wanted to score<a id="id-1.5.8.16.2.2" class="indexterm"></a>
<a id="id-1.5.8.16.2.3" class="indexterm"></a><a id="id-1.5.8.16.2.4" class="indexterm"></a>
<a id="id-1.5.8.16.2.5" class="indexterm"></a>
<a id="id-1.5.8.16.2.6" class="indexterm"></a> vacation homes by the number of features that each
home possesses.  We ended that section by wishing for a way to use cached
filters to affect the score, and with the <code class="literal">function_score</code> query we can do
just that.<a id="id-1.5.8.16.2.8" class="indexterm"></a>
<a id="id-1.5.8.16.2.9" class="indexterm"></a></p><p>The examples we have shown thus far have used a single function for all
documents.  Now we want to divide the results into subsets by using filters (one
filter per feature), and apply a different function to each subset.</p><p>The function that we will use in this example is <a id="id-1.5.8.16.4.1" class="indexterm"></a>the <code class="literal">weight</code>, which is
similar to the <code class="literal">boost</code> parameter accepted by any query.  The difference is
that the <code class="literal">weight</code> is not normalized by Lucene into some obscure floating-point
number; it is used as is.</p><p>The structure of the query has to change somewhat to incorporate multiple
functions:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">GET /_search
{
  "query": {
    "function_score": {
      "filter": { <a id="CO117-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
        "term": { "city": "Barcelona" }
      },
      "functions": [ <a id="CO117-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
        {
          "filter": { "term": { "features": "wifi" }}, <a id="CO117-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
          "weight": 1
        },
        {
          "filter": { "term": { "features": "garden" }}, <a id="CO117-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>
          "weight": 1
        },
        {
          "filter": { "term": { "features": "pool" }}, <a id="CO117-5"></a><span><img src="images/icons/callouts/5.png" alt="" /></span>
          "weight": 2 <a id="CO117-6"></a><span><img src="images/icons/callouts/6.png" alt="" /></span>
        }
      ],
      "score_mode": "sum", <a id="CO117-7"></a><span><img src="images/icons/callouts/7.png" alt="" /></span>
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO117-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
This <code class="literal">function_score</code> query has a <code class="literal">filter</code> instead of a <code class="literal">query</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO117-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">functions</code> key holds a list of functions that should be applied.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO117-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> <a href="#CO117-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> <a href="#CO117-5"><span><img src="images/icons/callouts/5.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The function is applied only if the document matches the (optional) <code class="literal">filter</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO117-6"><span><img src="images/icons/callouts/6.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">pool</code> feature is more important than the others so it has a higher <code class="literal">weight</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO117-7"><span><img src="images/icons/callouts/7.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">score_mode</code> specifies how the values from each function should be combined.
</p></td></tr></table></div><p>The new features to note in this example are explained in the following sections.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_filter_versus_query"></a>filter Versus query</h3></div></div></div><p>The first thing to note is that  we have specified a <code class="literal">filter</code> instead <a id="id-1.5.8.16.9.2.2" class="indexterm"></a>
<a id="id-1.5.8.16.9.2.3" class="indexterm"></a>of a
<code class="literal">query</code>. In this example, we do not need full-text search. We just want to
return all documents that have <code class="literal">Barcelona</code> in the <code class="literal">city</code> field, logic that is
better expressed as a filter instead of a query.  All documents returned by
the filter will have a <code class="literal">_score</code> of <code class="literal">1</code>.  The <code class="literal">function_score</code> query accepts
either a <code class="literal">query</code> or a <code class="literal">filter</code>. If neither is specified, it will default to
using the <code class="literal">match_all</code> query.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_functions"></a>functions</h3></div></div></div><p>The <code class="literal">functions</code> key holds an array of functions to apply.<a id="id-1.5.8.16.10.2.2" class="indexterm"></a>
<a id="id-1.5.8.16.10.2.3" class="indexterm"></a>  Each entry in the
array may also optionally specify a <code class="literal">filter</code>, in which case the function will be applied only to documents that match that filter.  In this example, we
apply a <code class="literal">weight</code> of <code class="literal">1</code> (or <code class="literal">2</code> in the case of <code class="literal">pool</code>) to any document
that matches the filter.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_score_mode"></a>score_mode</h3></div></div></div><p>Each function returns a result, and we need a way of reducing these multiple
results to a single value that can be combined with the original <code class="literal">_score</code>.
This is the role <a id="id-1.5.8.16.11.2.2" class="indexterm"></a>
<a id="id-1.5.8.16.11.2.3" class="indexterm"></a><a id="id-1.5.8.16.11.2.4" class="indexterm"></a>of the <code class="literal">score_mode</code> parameter, which accepts the following
values:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">multiply</code>
</span></dt><dd>
      Function results are multiplied together (default).
</dd><dt><span class="term">
<code class="literal">sum</code>
</span></dt><dd>
      Function results are added up.
</dd><dt><span class="term">
<code class="literal">avg</code>
</span></dt><dd>
      The average of all the function results.
</dd><dt><span class="term">
<code class="literal">max</code>
</span></dt><dd>
      The highest function result is used.
</dd><dt><span class="term">
<code class="literal">min</code>
</span></dt><dd>
      The lowest function result is used.
</dd><dt><span class="term">
<code class="literal">first</code>
</span></dt><dd>
      Uses only the result from the first function that either doesn’t have a filter or that has a filter matching the document.
</dd></dl></div><p>In this case, we want to add the <code class="literal">weight</code> results from each matching
filter together to produce the final score, so we have used the <code class="literal">sum</code> score
mode.</p><p>Documents that don’t match any of the filters will keep their original
<code class="literal">_score</code> of <code class="literal">1</code>.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="random-scoring"></a>Random Scoring</h2></div></div></div><p>You may have been wondering what <span class="emphasis"><em>consistently random scoring</em></span> is, or why
you would ever want to use it.<a id="id-1.5.8.17.2.2" class="indexterm"></a><a id="id-1.5.8.17.2.3" class="indexterm"></a>
<a id="id-1.5.8.17.2.4" class="indexterm"></a>
<a id="id-1.5.8.17.2.5" class="indexterm"></a>  The previous example provides a good use case.
All results from the previous example would receive a final <code class="literal">_score</code> of 1, 2,
3, 4, or 5. Maybe there are only a few homes that score 5, but presumably
there would be a lot of homes scoring 2 or 3.</p><p>As the owner of the website, you want to give your advertisers as much
exposure as possible.  With the current query, results with the same <code class="literal">_score</code>
would be returned in the same order every time.  It would be good to introduce
some randomness here, to ensure that all documents in a single score level
get a similar amount of exposure.</p><p>We want every user to see a different random order, but we want the same user
to see the same order when clicking on page 2, 3, and so forth.  This is what is
meant by <span class="emphasis"><em>consistently random</em></span>.</p><p>The <code class="literal">random_score</code> function, which<a id="id-1.5.8.17.5.2" class="indexterm"></a>
<a id="id-1.5.8.17.5.3" class="indexterm"></a><a id="id-1.5.8.17.5.4" class="indexterm"></a> outputs a number between 0 and 1, will
produce consistently random results when it is provided with the same <code class="literal">seed</code>
value, such as a user’s session ID:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">GET /_search
{
  "query": {
    "function_score": {
      "filter": {
        "term": { "city": "Barcelona" }
      },
      "functions": [
        {
          "filter": { "term": { "features": "wifi" }},
          "weight": 1
        },
        {
          "filter": { "term": { "features": "garden" }},
          "weight": 1
        },
        {
          "filter": { "term": { "features": "pool" }},
          "weight": 2
        },
        {
          "random_score": { <a id="CO118-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
            "seed":  "the users session id" <a id="CO118-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
          }
        }
      ],
      "score_mode": "sum",
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO118-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">random_score</code> clause doesn’t have any <code class="literal">filter</code>, so it will
    be applied to all documents.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO118-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Pass the user’s session ID as the <code class="literal">seed</code>, to make randomization
    consistent for that user. The same <code class="literal">seed</code> will result in the
    same randomization.
</p></td></tr></table></div><p>Of course, if you index new documents that match the query, the order of
results will change regardless of whether you use consistent randomization or
not.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="decay-functions"></a>The Closer, The Better</h2></div></div></div><p>Many variables could influence the user’s choice of vacation
home.<a id="id-1.5.8.18.2.1" class="indexterm"></a>
<a id="id-1.5.8.18.2.2" class="indexterm"></a>
<a id="id-1.5.8.18.2.3" class="indexterm"></a>  Maybe she would like to be close to the center of town, but perhaps
would be willing to settle for a place that is a bit farther from the
center if the price is low enough.  Perhaps the reverse is true: she would be
willing to pay more for the best location.</p><p>If we were to add a filter that excluded any vacation homes farther than 1
kilometer from the center, or any vacation homes that cost more than £100 a
night, we might exclude results that the user would consider to be a good
compromise.</p><p>The <code class="literal">function_score</code> query gives <a id="id-1.5.8.18.4.2" class="indexterm"></a>
<a id="id-1.5.8.18.4.3" class="indexterm"></a><a id="id-1.5.8.18.4.4" class="indexterm"></a>us the ability to trade off one sliding scale
(like location) against another sliding scale (like price), with a group of
functions known as the <span class="emphasis"><em>decay functions</em></span>.</p><p>The three decay functions—called <code class="literal">linear</code>, <code class="literal">exp</code>, and <code class="literal">gauss</code>—operate on numeric fields, date fields, or lat/lon geo-points.<a id="id-1.5.8.18.5.4" class="indexterm"></a><a id="id-1.5.8.18.5.5" class="indexterm"></a><a id="id-1.5.8.18.5.6" class="indexterm"></a>  All three take
the same parameters:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">origin</code>
</span></dt><dd>
    The <span class="emphasis"><em>central point</em></span>, or the best possible value for the field.
    Documents that fall at the <code class="literal">origin</code> will get a full <code class="literal">_score</code> of <code class="literal">1.0</code>.
</dd><dt><span class="term">
<code class="literal">scale</code>
</span></dt><dd>
    The rate of decay—how quickly the <code class="literal">_score</code> should drop the further from
    the <code class="literal">origin</code> that a document lies (for example, every £10 or every 100 meters).
</dd><dt><span class="term">
<code class="literal">decay</code>
</span></dt><dd>
    The <code class="literal">_score</code> that a document at <code class="literal">scale</code> distance from the <code class="literal">origin</code> should
    receive. Defaults to <code class="literal">0.5</code>.
</dd><dt><span class="term">
<code class="literal">offset</code>
</span></dt><dd>
    Setting a nonzero <code class="literal">offset</code> expands the central point to cover a range
    of values instead of just the single point specified by the <code class="literal">origin</code>. All
    values in the range <code class="literal">-offset &lt;= origin &lt;= +offset</code> will receive the full
    <code class="literal">_score</code> of <code class="literal">1.0</code>.
</dd></dl></div><p>The only difference between these three functions is the shape of the decay
curve. The difference is most easily illustrated with a graph (see <a class="xref" href="controlling-relevance.html#img-decay-functions" title="Figure 33. Decay function curves">Figure 33, “Decay function curves”</a>).</p><div class="figure"><a id="img-decay-functions"></a><p class="title"><strong>Figure 33. Decay function curves</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/elas_1705.png" alt="The curves of the decay functions" /></div></div></div><br class="figure-break" /><p>The curves shown in <a class="xref" href="controlling-relevance.html#img-decay-functions" title="Figure 33. Decay function curves">Figure 33, “Decay function curves”</a> all have their <code class="literal">origin</code>—the
central point—set to <code class="literal">40</code>.  The <code class="literal">offset</code> is <code class="literal">5</code>, meaning that all values in
the range <code class="literal">40 - 5 &lt;= value &lt;= 40 + 5</code> are treated as though they were at the
<code class="literal">origin</code>—they all get the full score of <code class="literal">1.0</code>.</p><p>Outside this range, the score starts to decay.  The rate of decay is
determined by the <code class="literal">scale</code> (which in this example is set to <code class="literal">5</code>), and the
<code class="literal">decay</code> (which is set to the default of <code class="literal">0.5</code>). The result is that all three
curves return a score of <code class="literal">0.5</code> at <code class="literal">origin +/- (offset + scale)</code>, or at points
<code class="literal">30</code> and <code class="literal">50</code>.</p><p>The difference between <code class="literal">linear</code>, <code class="literal">exp</code>, and <code class="literal">gauss</code> is the shape of the curve at other points in the range:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
The <code class="literal">linear</code> funtion is just a straight line. Once the line hits zero,
  all values outside the line will return a score of <code class="literal">0.0</code>.
</li><li class="listitem">
The <code class="literal">exp</code> (exponential) function decays rapidly, then slows down.
</li><li class="listitem">
The <code class="literal">gauss</code> (Gaussian) function is bell-shaped—it decays slowly, then
  rapidly, then slows down again.
</li></ul></div><p>Which curve you choose depends entirely on how quickly you want the <code class="literal">_score</code>
to decay, the further a value is from the <code class="literal">origin</code>.</p><p>To return to our example: our user would prefer to rent a vacation home close
to the center of London (<code class="literal">{ "lat": 51.50, "lon": 0.12}</code>) and to pay no more
than £100 a night, but our user considers price to be more important than
distance. <a id="id-1.5.8.18.14.2" class="indexterm"></a>
<a id="id-1.5.8.18.14.3" class="indexterm"></a>  We could write this query as follows:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">GET /_search
{
  "query": {
    "function_score": {
      "functions": [
        {
          "gauss": {
            "location": { <a id="CO119-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
              "origin": { "lat": 51.5, "lon": 0.12 },
              "offset": "2km",
              "scale":  "3km"
            }
          }
        },
        {
          "gauss": {
            "price": { <a id="CO119-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
              "origin": "50", <a id="CO119-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
              "offset": "50",
              "scale":  "20"
            }
          },
          "weight": 2 <a id="CO119-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>
        }
      ]
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO119-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">location</code> field is mapped as a <code class="literal">geo_point</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO119-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">price</code> field is numeric.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO119-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
See <a class="xref" href="controlling-relevance.html#Understanding-the-price-Clause" title="Understanding the price Clause">Understanding the price Clause</a> for the reason that <code class="literal">origin</code> is <code class="literal">50</code> instead of <code class="literal">100</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO119-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">price</code> clause has twice the weight of the <code class="literal">location</code> clause.
</p></td></tr></table></div><p>The <code class="literal">location</code> clause is<a id="id-1.5.8.18.17.2" class="indexterm"></a> easy to understand:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
We have specified an <code class="literal">origin</code> that corresponds to the center of London.
</li><li class="listitem">
Any location within <code class="literal">2km</code> of the <code class="literal">origin</code> receives the full score of <code class="literal">1.0</code>.
</li><li class="listitem">
Locations <code class="literal">5km</code> (<code class="literal">offset + scale</code>) from the centre receive a score
of <code class="literal">0.5</code>.
</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Understanding-the-price-Clause"></a>Understanding the price Clause</h2></div></div></div><p>The <code class="literal">price</code> clause is a little trickier.<a id="id-1.5.8.19.2.2" class="indexterm"></a>  The user’s preferred price is
anything up to £100, but this example sets the origin to £50.  Prices can’t be
negative, but the lower they are, the better.  Really, any price between £0 and
£100 should be considered optimal.</p><p>If we were to set the <code class="literal">origin</code> to £100, then prices below £100 would receive a
lower score. Instead, we set both the <code class="literal">origin</code> and the <code class="literal">offset</code> to £50.  That
way, the score decays only for any prices above £100 (<code class="literal">origin + offset</code>).</p><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>The <code class="literal">weight</code> parameter can be used to increase or decrease the contribution of
individual clauses. <a id="id-1.5.8.19.4.1.2" class="indexterm"></a> The <code class="literal">weight</code>, which defaults to <code class="literal">1.0</code>, is multiplied by
the score from each clause before the scores are combined with the specified
<code class="literal">score_mode</code>.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="script-score"></a>Scoring with Scripts</h2></div></div></div><p>Finally, if none of the <code class="literal">function_score</code>'s built-in functions suffice, you can
implement the logic that you need with a script, using the <code class="literal">script_score</code>
function.<a id="id-1.5.8.20.2.3" class="indexterm"></a>
<a id="id-1.5.8.20.2.4" class="indexterm"></a><a id="id-1.5.8.20.2.5" class="indexterm"></a><a id="id-1.5.8.20.2.6" class="indexterm"></a>
<a id="id-1.5.8.20.2.7" class="indexterm"></a>
<a id="id-1.5.8.20.2.8" class="indexterm"></a></p><p>For an example, let’s say that we want to factor our profit margin into the
relevance calculation.  In our business, the profit margin depends on three
factors:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
The <code class="literal">price</code> per night of the vacation home.
</li><li class="listitem">
The user’s membership level—some levels get a percentage <code class="literal">discount</code>
  above a certain price per night <code class="literal">threshold</code>.
</li><li class="listitem">
The negotiated <code class="literal">margin</code> as a percentage of the price-per-night, after user
  discounts.
</li></ul></div><p>The algorithm that we will use to calculate the profit for each home is as
follows:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-groovy">if (price &lt; threshold) {
  profit = price * margin
} else {
  profit = price * (1 - discount) * margin;
}</pre></div><p>We probably don’t want to use the absolute profit as a score; it would
overwhelm the other factors like location, popularity and features. Instead,
we can express the profit as a percentage of our <code class="literal">target</code> profit.  A profit
margin above our target will have a positive score (greater than <code class="literal">1.0</code>), and a profit margin below our target will have a negative score (less than
<code class="literal">1.0</code>):</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-groovy">if (price &lt; threshold) {
  profit = price * margin
} else {
  profit = price * (1 - discount) * margin
}
return profit / target</pre></div><p>The default scripting language in Elasticsearch is
<a class="ulink" href="http://groovy.codehaus.org/" target="_top">Groovy</a>, which for the most part looks a lot like
JavaScript.<a id="id-1.5.8.20.9.2" class="indexterm"></a>
<a id="id-1.5.8.20.9.3" class="indexterm"></a> The preceding algorithm as a Groovy script would look like this:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-groovy">price  = doc['price'].value <a id="CO120-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
margin = doc['margin'].value <a id="CO120-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>

if (price &lt; threshold) { <a id="CO120-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
  return price * margin / target
}
return price * (1 - discount) * margin / target <a id="CO120-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO120-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> <a href="#CO120-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">price</code> and <code class="literal">margin</code> variables are extracted from the <code class="literal">price</code> and
    <code class="literal">margin</code> fields in the document.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO120-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> <a href="#CO120-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">threshold</code>, <code class="literal">discount</code>, and <code class="literal">target</code> variables we will pass in as
    <code class="literal">params</code>.
</p></td></tr></table></div><p>Finally, we can add our <code class="literal">script_score</code> function to the list of other functions
that we are already using:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">GET /_search
{
  "function_score": {
    "functions": [
      { ...location clause... }, <a id="CO121-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
      { ...price clause... }, <a id="CO121-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
      {
        "script_score": {
          "params": { <a id="CO121-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
            "threshold": 80,
            "discount": 0.1,
            "target": 10
          },
          "script": "price  = doc['price'].value; margin = doc['margin'].value;
          if (price &lt; threshold) { return price * margin / target };
          return price * (1 - discount) * margin / target;" <a id="CO121-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>
        }
      }
    ]
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO121-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> <a href="#CO121-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">location</code> and <code class="literal">price</code> clauses refer to the example explained in
    <a class="xref" href="controlling-relevance.html#decay-functions" title="The Closer, The Better">The Closer, The Better</a>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO121-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
By passing in these variables as <code class="literal">params</code>, we can change their values
    every time we run this query without having to recompile the script.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO121-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
JSON cannot include embedded newline characters.  Newline characters in
    the script should  either be escaped as <code class="literal">\n</code> or replaced with semicolons.
</p></td></tr></table></div><p>This query would return the documents that best satisfy the user’s
requirements for location and price, while still factoring in our need to make
a profit.</p><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>The <code class="literal">script_score</code> function provides enormous flexibility.<a id="id-1.5.8.20.16.1.2" class="indexterm"></a>
<a id="id-1.5.8.20.16.1.3" class="indexterm"></a>  Within a script,
you have access to the fields of the document, to the current <code class="literal">_score</code>, and
even to the term frequencies, inverse document frequencies, and field length
norms (see <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-advanced-scripting.html" target="_top">Text scoring in scripts</a>).</p><p>That said, scripts can have a performance impact.  If you do find that your
scripts are not quite fast enough, you have three options:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Try to precalculate as much information as possible and include it in each
  document.
</li><li class="listitem">
Groovy is fast, but not quite as fast as Java.<a id="id-1.5.8.20.16.3.2.1.1" class="indexterm"></a>
<a id="id-1.5.8.20.16.3.2.1.2" class="indexterm"></a>  You could reimplement your
  script as a native Java script. (See
  <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-scripting.html#native-java-scripts" target="_top">Native Java Scripts</a>).
</li><li class="listitem">
Use the <code class="literal">rescore</code> functionality<a id="id-1.5.8.20.16.3.3.1.2" class="indexterm"></a> described in <a class="xref" href="proximity-matching.html#rescore-api" title="Rescoring Results">Rescoring Results</a> to apply
  your script to only the best-scoring documents.
</li></ul></div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="pluggable-similarites"></a>Pluggable Similarity Algorithms</h2></div></div></div><p>Before we move on from relevance and scoring, we will finish this chapter with
a more advanced subject: pluggable similarity algorithms.<a id="id-1.5.8.21.2.1" class="indexterm"></a>
<a id="id-1.5.8.21.2.2" class="indexterm"></a><a id="id-1.5.8.21.2.3" class="indexterm"></a>
<a id="id-1.5.8.21.2.4" class="indexterm"></a>
<a id="id-1.5.8.21.2.5" class="indexterm"></a> While Elasticsearch
uses the <a class="xref" href="controlling-relevance.html#practical-scoring-function" title="Lucene’s Practical Scoring Function">Lucene’s Practical Scoring Function</a> as its default similarity algorithm,
it supports other algorithms out of the box, which are listed
in the <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index-modules-similarity.html#configuration" target="_top">Similarity Modules</a> documentation.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="bm25"></a>Okapi BM25</h3></div></div></div><p>The most interesting competitor to TF/IDF and the vector space model is called
<a class="ulink" href="http://en.wikipedia.org/wiki/Okapi_BM25" target="_top"><span class="emphasis"><em>Okapi BM25</em></span></a>, which is considered to
be a <span class="emphasis"><em>state-of-the-art</em></span> ranking function.<a id="id-1.5.8.21.3.2.3" class="indexterm"></a><a id="id-1.5.8.21.3.2.4" class="indexterm"></a> BM25 originates from the
<a class="ulink" href="http://en.wikipedia.org/wiki/Probabilistic_relevance_model" target="_top">probabilistic relevance model</a>,
rather than the vector space model, yet<a id="id-1.5.8.21.3.2.6" class="indexterm"></a> the algorithm has a lot in common with
Lucene’s practical scoring function.</p><p>Both use term frequency, inverse document frequency, and field-length
normalization, but the definition of each of these factors is a little
different.  Rather than explaining the BM25 formula in detail, we will focus
on the practical advantages that BM25 offers.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="bm25-saturation"></a>Term-frequency saturation</h4></div></div></div><p>Both TF/IDF and BM25 use <a class="link" href="controlling-relevance.html#idf" title="Inverse document frequency">inverse document frequency</a> to distinguish
between common (low value) words and uncommon (high value) words.<a id="id-1.5.8.21.3.4.2.2" class="indexterm"></a>
<a id="id-1.5.8.21.3.4.2.3" class="indexterm"></a>  Both also
recognize (see <a class="xref" href="controlling-relevance.html#tf" title="Term frequency">Term frequency</a>) that the more often a word appears in a document, the
more likely is it that the document is relevant for that word.</p><p>However, common words occur commonly. <a id="id-1.5.8.21.3.4.3.1" class="indexterm"></a>
<a id="id-1.5.8.21.3.4.3.2" class="indexterm"></a> The fact that a common word appears
many times in one document is offset by the fact that the word appears many
times in <span class="emphasis"><em>all</em></span> documents.</p><p>However, TF/IDF was designed in an era when it was standard practice to
remove the <span class="emphasis"><em>most</em></span> common words (or <span class="emphasis"><em>stopwords</em></span>, see <a class="xref" href="stopwords.html" title="Stopwords: Performance Versus Precision"><em>Stopwords: Performance Versus Precision</em></a>) from the
index altogether.<a id="id-1.5.8.21.3.4.4.4" class="indexterm"></a>
<a id="id-1.5.8.21.3.4.4.5" class="indexterm"></a> The algorithm didn’t need to worry about an upper limit for
term frequency because the most frequent terms had already been removed.</p><p>In Elasticsearch, the <code class="literal">standard</code> analyzer—the default for <code class="literal">string</code> fields—doesn’t remove stopwords because, even though they are words of little
value, they do still have some value.  The result is that, for very long
documents, the sheer number of occurrences of words like <code class="literal">the</code> and <code class="literal">and</code> can
artificially boost their weight.</p><p>BM25, on the other hand, does have an upper limit.  Terms that appear 5 to 10
times in a document have a significantly larger impact on relevance than terms
that appear just once or twice.  However, as can be seen in <a class="xref" href="controlling-relevance.html#img-bm25-saturation" title="Figure 34. Term frequency saturation for TF/IDF and BM25">Figure 34, “Term frequency saturation for TF/IDF and BM25”</a>, terms that appear 20 times in a
document have almost the same impact as terms that appear a thousand times or
more.</p><p>This is known as <span class="emphasis"><em>nonlinear term-frequency saturation</em></span>.</p><div class="figure"><a id="img-bm25-saturation"></a><p class="title"><strong>Figure 34. Term frequency saturation for TF/IDF and BM25</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/elas_1706.png" alt="Term frequency saturation for TF/IDF and BM25" /></div></div></div><br class="figure-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="bm25-normalization"></a>Field-length normalization</h4></div></div></div><p>In <a class="xref" href="controlling-relevance.html#field-norm" title="Field-length norm">Field-length norm</a>, we said that Lucene considers shorter fields to have
more weight than longer fields: the frequency of a term in a field is offset
by the length of the field.  However, the practical scoring function treats
all fields in the same way.  It will treat all <code class="literal">title</code> fields (because they
are short) as more important than all <code class="literal">body</code> fields (because they are long).</p><p>BM25 also considers shorter fields to have more weight than longer fields, but
it considers each field separately by taking the average length of the field
into account. It can distinguish between a short <code class="literal">title</code> field and a <code class="literal">long</code>
title field.</p><div class="caution admon"><div class="icon"><img alt="Caution" src="images/icons/caution.png" /></div><div class="admon_content"><p>In <a class="xref" href="controlling-relevance.html#query-time-boosting" title="Query-Time Boosting">Query-Time Boosting</a>, we said that the <code class="literal">title</code> field has a
<span class="emphasis"><em>natural</em></span> boost over the <code class="literal">body</code> field because of its length.  This natural
boost disappears with BM25 as differences in field length apply only within a
single field.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="bm25-tunability"></a>Tuning BM25</h4></div></div></div><p>One of the nice features of BM25 is that, unlike TF/IDF, it has two parameters
that allow it to be tuned:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">k1</code>
</span></dt><dd>
    This parameter controls how quickly an increase in term frequency results
    in term-frequency saturation.  The default value is <code class="literal">1.2</code>. Lower values
    result in quicker saturation, and higher values in slower saturation.
</dd><dt><span class="term">
<code class="literal">b</code>
</span></dt><dd>
    This parameter controls how much effect field-length normalization should
    have. A value of <code class="literal">0.0</code> disables normalization completely, and a value of
    <code class="literal">1.0</code> normalizes fully. The default is <code class="literal">0.75</code>.
</dd></dl></div><p>The practicalities of tuning BM25 are another matter. The default values for
<code class="literal">k1</code> and <code class="literal">b</code> should be suitable for most document collections, but the
optimal values really depend on the collection.  Finding good values for your
collection is a matter of adjusting, checking, and adjusting again.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="changing-similarities"></a>Changing Similarities</h2></div></div></div><p>The similarity algorithm can be set on a per-field basis.<a id="id-1.5.8.22.2.1" class="indexterm"></a>
<a id="id-1.5.8.22.2.2" class="indexterm"></a>
<a id="id-1.5.8.22.2.3" class="indexterm"></a><a id="id-1.5.8.22.2.4" class="indexterm"></a>
<a id="id-1.5.8.22.2.5" class="indexterm"></a>  It’s just a matter
of specifying the chosen algorithm <a id="id-1.5.8.22.2.6" class="indexterm"></a>
<a id="id-1.5.8.22.2.7" class="indexterm"></a>in the field’s mapping:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">PUT /my_index
{
  "mappings": {
    "doc": {
      "properties": {
        "title": {
          "type":       "string",
          "similarity": "BM25" <a id="CO122-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
        },
        "body": {
          "type":       "string",
          "similarity": "default" <a id="CO122-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
        }
      }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO122-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">title</code> field uses BM25 similarity.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO122-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">body</code> field uses the default similarity (see <a class="xref" href="controlling-relevance.html#practical-scoring-function" title="Lucene’s Practical Scoring Function">Lucene’s Practical Scoring Function</a>).
</p></td></tr></table></div><p>Currently, it is not possible to change the <code class="literal">similarity</code> mapping for an
existing field.  You would need to reindex your data in order to do that.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_configuring_bm25"></a>Configuring BM25</h3></div></div></div><p>Configuring a similarity is much <a id="id-1.5.8.22.6.2.1" class="indexterm"></a>
<a id="id-1.5.8.22.6.2.2" class="indexterm"></a><a id="id-1.5.8.22.6.2.3" class="indexterm"></a>
<a id="id-1.5.8.22.6.2.4" class="indexterm"></a>like configuring an analyzer. Custom
similarities can be specified when creating an index. For instance:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">PUT /my_index
{
  "settings": {
    "similarity": {
      "my_bm25": { <a id="CO123-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
        "type": "BM25",
        "b":    0 <a id="CO123-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
      }
    }
  },
  "mappings": {
    "doc": {
      "properties": {
        "title": {
          "type":       "string",
          "similarity": "my_bm25" <a id="CO123-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
        },
        "body": {
          "type":       "string",
          "similarity": "BM25" <a id="CO123-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>
        }
      }
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO123-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Create a custom similarity called <code class="literal">my_bm25</code>, based on the built-in <code class="literal">BM25</code> similarity.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO123-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Disable field-length normalization. See <a class="xref" href="controlling-relevance.html#bm25-tunability" title="Tuning BM25">Tuning BM25</a>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO123-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Field <code class="literal">title</code> uses the custom similarity <code class="literal">my_bm25</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO123-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Field <code class="literal">body</code> uses the built-in similarity <code class="literal">BM25</code>.
</p></td></tr></table></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>A custom similarity can be updated by closing the index, updating the index settings,
     and reopening the index.  This allows you to experiment with different configurations
     without having to reindex your documents.</p></div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="relevance-conclusion"></a>Relevance Tuning Is the Last 10%</h2></div></div></div><p>In this chapter, we looked at a how Lucene generates scores based on TF/IDF.
Understanding the score-generation process<a id="id-1.5.8.23.2.1" class="indexterm"></a>
<a id="id-1.5.8.23.2.2" class="indexterm"></a>
<a id="id-1.5.8.23.2.3" class="indexterm"></a> is critical so you can
tune, modulate, attenuate, and manipulate the score for your particular
business domain.</p><p>In practice, simple combinations of queries will get you good search results.
But to get <span class="emphasis"><em>great</em></span> search results, you’ll often have to start tinkering with
the previously mentioned tuning methods.</p><p>Often, applying a boost on a strategic field or rearranging a query to
emphasize a particular clause will be sufficient to make your results great.
Sometimes you’ll need more-invasive changes.  This is usually the case if your
scoring requirements diverge heavily from Lucene’s word-based TF/IDF model (for example, you
want to score based on time or distance).</p><p>With that said, relevancy tuning is a rabbit hole that you can easily fall into
and never emerge.  The concept of <span class="emphasis"><em>most relevant</em></span> is a nebulous target to hit, and
different people often have different ideas about document ranking.  It is easy
to get into a cycle of constant fiddling without any apparent progress.</p><p>We encourage you to avoid this (very tempting) behavior and instead properly
instrument your search results.  Monitor how often your users click the top
result, the top 10, and the first page; how often they execute a secondary query
without selecting a result first; how often they click a result and immediately
go back to the search results, and so forth.</p><p>These are all indicators of how relevant your search results are to the user.
If your query is returning highly relevant results, users will select one of
the top-five results, find what they want, and leave.  Irrelevant results cause
users to click around and try new search queries.</p><p>Once you have instrumentation in place, tuning your query is simple.  Make a change,
monitor its effect on your users, and repeat as necessary.  The tools outlined in this
chapter are just that: tools.  You have to use them appropriately to propel
your search results into the <span class="emphasis"><em>great</em></span> category, and the only way to do that is with
strong measurement of user behavior.</p></div></div><div class="navfooter"><span class="prev"><a href="partial-matching.html">
              « 
              Partial Matching</a>
           
        </span><span class="next">
           
          <a href="languages.html">인간의 언어를 다루어보자 
               »
            </a></span></div>
<!-- end body -->

            </section>

            <div id="rtpcontainer"
        >
	<h3>Top Videos</h3>
	<ul class="lists">
		<li><a href="https://www.elastic.co/webinars/get-started-with-elasticsearch/?baymax=default&elektra=docs&storm=top-video">Getting Started</a></li>
		<li><a href="http://www.elastic.co/webinars/elasticsearch-performance-optimization-tale-two-tickets/?elektra=docs">Scaling</a></li>
		<li><a href="http://www.elastic.co/webinars/shield-securing-your-data-in-elasticsearch/?elektra=docs">Security</a></li>
	</ul>
</div>


	  	




<script src="//app-lon02.marketo.com/js/forms2/js/forms2.min.js"></script>
	<!-- subscribe-newsletter -->
	<div id="subscribe-newsletter">
		<div class="container">
			<div class="row">
				<div class="12u">
					<div class="subscribe-wrapper" id="rtp-newsletter">
						<header>
							<h3>Subscribe to our newsletter</h3>
						</header>
						<div class="subscribe-form">
							<form id="mktoForm_1398" class="container"></form>
							<div class="form_thanks hide">
								
									<p>Thanks for subscribing! We'll keep you updated with new releases.</p>
								
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

  	<!-- Footer -->
	<div id="footer-wrapper">
		<section id="footer" class="container">
			<div class="row">
				<div class="12u">
					<!-- Copyright -->
					<div id="copyright">
	<p>
		© 2016. All Rights Reserved - Elasticsearch
	</p>
	<ul class="links">
		<li>Elasticsearch is a trademark of Elasticsearch BV, registered in the U.S. and in other countries</li>
		<li><a href="/legal/trademarks" id="footer_trademarks">Trademarks</a></li>
		<li><a href="/legal/terms-of-use" id="footer_terms">Terms</a></li>
		<li><a href="/legal/privacy-policy" id="footer_privacy">Privacy</a></li>
	</ul>
	<p>
		Apache, Apache Lucene, Apache Hadoop, Hadoop, HDFS and the yellow elephant logo are trademarks of the <a href="http://www.apache.org/" target="_blank">Apache Software Foundation</a> in the United States and/or other&nbsp;countries.
	</p>
</div><!--<div class="row">
{replace4}
</div>-->
				</div>
			</div>					
		</section>
	</div>
			
	<!-- Social Media -->
	<div id="socialmedia-wrapper">
		<section id="socialmedia" class="container">
			<!-- social icons -->
			<div id="social">
				<ul class="links">
					
						<li class="facebook grayscale"><a href="http://www.facebook.com/elastic.co" target="_blank" id="footer_facebook"></a></li>
					
						<li class="twitter grayscale"><a href="https://www.twitter.com/elastic" target="_blank" id="footer_twitter"></a></li>
					
						<li class="linkedin grayscale"><a href="https://www.linkedin.com/company/elastic-co" target="_blank" id="footer_linkedin"></a></li>
					
						<li class="xing grayscale"><a href="https://www.xing.com/companies/elastic.co" target="_blank" id="footer_xing"></a></li>
					
						<li class="youtube grayscale"><a href="https://www.youtube.com/user/elasticsearch" target="_blank" id="footer_youtube"></a></li>
					
				</ul>
			</div>
		</section>
	</div>


<style type="text/css">
	
		.facebook{background:url("https://static-www.elastic.co/assets/bltda40eebd7c7cae9a/facebook.svg?q=100") no-repeat;}		
	
		.twitter{background:url("https://static-www.elastic.co/assets/bltfd3b1511512f4632/twitter.svg?q=100") no-repeat;}		
	
		.linkedin{background:url("https://static-www.elastic.co/assets/blt6b4f6f8d6b96f814/linkedin.svg?q=100") no-repeat;}		
	
		.xing{background:url("https://static-www.elastic.co/assets/blta76b2ae2b2f10a98/xing.svg?q=100") no-repeat;}		
	
		.youtube{background:url("https://static-www.elastic.co/assets/blt5761648c9581fb53/youtube.svg?q=100") no-repeat;}		
	
</style>

<script>
MktoForms2.loadForm("//app-lon02.marketo.com", "813-MAM-392", 1398,function(form){
	form.onSuccess(function(form){
		$('#mktoForm_1398').css('display','none');
		$('#subscribe-newsletter header').hide();
		$('#mktoForm_1398').siblings('.form_thanks').removeClass('hide')
		dataLayer.push({'event': 'mktoFormSubmit'});
	    return false;
  	});
});
</script>	

  	</div>
  	<!-- <div class="preloader">
    	<div class="status"></div>
	</div> -->
  	<style></style>
   	<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";	
</script>
<script src="https://static-www.elastic.co/static/js/jquery.autocomplete.js?q=100"></script>
<script src="https://static-www.elastic.co/static/js/script.js?q=100"></script>


   	
   	
   	
   	<script type="application/ld+json">
	
		
	
	{
	  	"@context": "http://schema.org",
	  	"@type": "Organization",
	  	"name" : "Elastic",
	  	"url": "https://www.elastic.co/",
	  	"logo": "https://www.elastic.co/static/img/elastic-logo-200.png",
		"sameAs" : [ "https://www.facebook.com/elastic.co",
			"https://twitter.com/elastic",
			"https://plus.google.com/105178019064686397293",
			"https://www.youtube.com/user/elasticsearch",
			"https://www.linkedin.com/company/elasticsearch"
		],
	  	"potentialAction": {
	    	"@type": "SearchAction",
	    	"target": "https://www.elastic.co/search?q={query_string}",
	    	"query-input": "required name=query_string"
	  	}
	}
</script>	

            <script type="text/javascript" src="docs.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script type='text/javascript' src='https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js'></script>

            </body>
        

